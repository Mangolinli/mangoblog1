<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


/* 字体引入：鸿蒙字体 */

html {
  font-size: 16px;
  font-family: "HarmonyOS_Sans_SC";
}

/* 打印页面设置 */

@media print {
  * {
    -webkit-print-color-adjust: exact; /*确保打印颜色一致*/
    print-color-adjust: exact;
  }
  body {
    width: 21cm; /* 设置页面宽度为A4宽度 */
    height: 29.7cm; /* 设置页面高度为A4高度 */
    margin: 1cm; /* 设置页面边距 */
  }
  p {
    line-height: 1.5rem; /*设置打印内容的行高*/
  }
  ol,ul,figure,pre {  /*设置一些元素不会被分页截断对应有序列表、无序列表、图片(表格)、代码块*/
    page-break-inside: avoid;
    break-inside: avoid;
  }
}

/* 软件内部Markdown样式 */
#write {
  max-width: 950px;
  margin: 0 auto;
  padding: 15px;
  line-height: 2.25;
  color: #000;
  letter-spacing: 1.1px;
  word-break: break-word;
  word-wrap: break-word;
  text-align: left;
}

#write p {
  color: #333;
  margin: 10px 10px;
  font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light,
    "PingFang SC", Cambria, Cochin, Georgia, Times, "Times New Roman", serif;

  font-size: 1rem;
  word-spacing: 2px;
}
#write h3:after,
h4:after,
h5:after,
h6:after {
  content: "";
  display: inline-block;
  margin-left: 0.2em;
  height: 2em;
  width: 1.2em;
  vertical-align: top;
}

#write h3:after {
  background: var(--h3-r-graphic);
}
#write h4:after {
  background: var(--h4-r-graphic);
}
#write h5:after {
  background: var(--h5-r-graphic);
}
#write h6:after {
  background: var(--h6-r-graphic);
}

/* 一级标题 */
#write h1:after {
  font-size: 1.8rem;
  text-align: center;
  font-weight: bold;
  color: #000;
  border-bottom: none;
}

#write h1 {
  text-align: center;
}

/* 二级标题 */
#write h2 {
  font-size: 1.5rem;
  line-height: 1.6;
  width: fit-content;
  font-weight: bold;
  margin: 20px 0;
  padding: 1px 12.5px;
  border-radius: 4px;
  background: var(--head-title-h2-background);
  background-size: 200% 100%;
  background-position: 0% 0%;
  transition: all ease-in-out 0.1s;
}
#write h2.md-heading a {
  text-decoration: underline;
  border-bottom: 0;
  text-decoration-thickness: 1.2px;
  text-underline-offset: 2px;
}
#write h2:hover {
  background-position: -100% -100%;
  transition: all ease-in-out 0.1s;
}

/* 三级标题 */
#write h3 {
  width: fit-content;
  margin: 20px 0;
  font-size: 1.3rem;
  text-align: left;
  padding-left: 10px;
  border-left: 5px solid var(--head-title-color);
}

/* 三级标题内容 */
#write h3 span {
  border-bottom: 2px hidden var(--head-title-color);
}

#write h3 span:hover {
  border-bottom: 2px solid var(--head-title-color);
  transition: all linear 0.1s;
}
#write h4 {
  margin: 20px 0;
  font-size: 1.15rem;
  text-align: left;
}

#write h4::before {
  content: "";
  margin-right: 7px;
  display: inline-block;
  background-color: var(--head-title-color);
  width: 10px;
  height: 10px;
  border-radius: 100%;
  border: var(--head-title-color) 1px solid;
  vertical-align: inherit;
}

#write h5 {
  margin: 23px 0;
  font-size: 1.1rem;
  text-align: left;
}

#write h5::before {
  content: "";
  margin-right: 7px;
  display: inline-block;
  background-color: #ffffff;
  width: 10px;
  height: 10px;
  border-radius: 100%;
  border: var(--head-title-color) 2px solid;
  vertical-align: inherit;
}

#write h6 {
  margin: 23px 0;
  font-size: 1.1rem;
  text-align: left;
}

#write h6::before {
  content: "-";
  color: var(--head-title-color);
  margin-right: 7px;
  display: inline-block;
  vertical-align: inherit;
}

/* 列表 */
::marker {
  color: #626161;
}

li.md-list-item {
  margin: 0.4rem 0;
}

#write ul,
#write ol {
  margin-top: 0px;
  margin-left: 16px;
  margin-bottom: 8px;
  padding-left: 13px;
}

#write em {
  padding: 0 3px 0 0;
}

#write ul {
  list-style-type: disc;
}

#write ul ul {
  list-style-type: circle;
}

#write ul ul ul {
  list-style-type: square;
}

#write ol {
  list-style-type: decimal;
}
#write ol ol {
  list-style-type: lower-alpha;
}
#write ol ol ol {
  list-style-type: lower-roman;
}

#write li section {
  margin-top: 5px;
  margin-bottom: 5px;
  line-height: 1.7rem;
  text-align: justify;
  color: #000000;
  font-weight: 500;
}

#write li:before {
  content: "";
  height: calc(100% - 50px);
  top: 35px;
  position: absolute;
  border-left: 0.5px solid #d6d6d6;
  left: -14.5px;
}

/* 任务列表样式 */
#write .md-task-list-item:before {
  content: none;
}

#write .md-task-list-item > input {
  margin: 0px;
  padding: 0px;
  width: 0px;
  height: 0px;
  line-height: 1.2rem;
}
#write .md-task-list-item > input:before {
  display: inline-block;
  content: "";
  width: 1.1rem;
  height: 1.1rem;
  text-align: center;
  vertical-align: middle;
  background-color: #fff;
  border: 1px solid var(--element-color);
  border-radius: 30%;
}

#write .md-task-list-item > input[checked]:before {
  content: "✔";
  color: var(--element-color-deep);
  -webkit-text-stroke: 1px var(--element-color-deep);
  width: 1.1rem;
  height: 1.1rem;
  background-color: #ffffff;
  border: 2px solid var(--element-color);
  border-radius: 30%;
  font-size: 0.75rem;
  line-height: 0.8rem;
}

#write input[type="checkbox"] {
  position: absolute;
  top: 7px;
  left: -3px;
}

#write .md-task-list-item p {
  margin: 0px 1.8rem;
}

/* 引用 */

#write blockquote {
  margin-left: 12px;
  padding: 12px;
  border: 1px solid var(--element-color);
  border-left-color: var(--element-color);
  border-left-width: 4px;
  border-radius: 4px;
  line-height: 26px;
}

#write blockquote p {
  color: #000;
}

/* 超链接 */
#write a {
  color: #000;
}

#write a:visited {
  color: var(--element-color-deep);
}

#write a:not(.md-toc-inner) {
  font-weight: bolder;
  text-decoration: none;
  transform: all linear 0.1s;
}

#write a:hover:not(.md-toc-inner) {
  font-weight: bold;
  color: var(--element-color-deep);
  border-bottom: 1px solid var(--element-color-deep);
  transform: all linear 0.1s;
}

#write p a:not(.md-toc-inner)::before {
  content: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1024 1024'%3E%3Cpath  d='M477.934459 330.486594A50.844091 50.844091 0 0 1 406.752731 258.796425L512 152.532274a254.220457 254.220457 0 0 1 359.467726 359.467726L762.66137 618.772592a50.844091 50.844091 0 1 1-71.690168-71.690169l106.772591-106.772592a152.532274 152.532274 0 0 0-215.578947-215.578947z m70.164846 361.501489A50.844091 50.844091 0 1 1 619.789474 762.66137l-107.281033 107.281033A254.220457 254.220457 0 0 1 152.532274 512L259.813307 406.752731a50.844091 50.844091 0 1 1 72.19861 69.656405l-107.789474 107.281033a152.532274 152.532274 0 0 0 215.578947 215.578947z m-126.601788-16.77855a50.844091 50.844091 0 1 1-71.690168-71.690169l251.678252-251.678252a50.844091 50.844091 0 0 1 71.690169 71.690169z'/%3E%3C/svg%3E");
  color: #f68800;
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  vertical-align: sub;
}

#write a.md-toc-inner:hover {
  color: var(--element-color-deep);
  font-weight: 700;
  text-decoration: none;
}

#write sup a::before {
  content: none;
}

/* 加粗 */
#write strong {
  color: #000;
  font-weight: bold;
}

/* 斜体 */
#write em {
  font-style: italic;
  color: #000;
}
/* 高亮 */
#write mark {
  font-weight: bolder;
  color: #000;
  background: var(--element-color-so-shallow);
}

/* 删除线 */
#write del {
  text-decoration-color: var(--element-color-deep);
}

/* 分隔线*/
#write hr {
  height: 1px;
  padding: 0;
  border: none;
  border-top: 2px solid var(--head-title-color);
}

/* 图片*/
#write img {
  border-radius: 6px;
  display: block;
  margin: 20px auto;
  object-fit: contain;
}

/* 图片描述文字 */
#write figcaption {
  display: block;
  font-size: 13px;
  color: #595959;
}

/* Yaml */
pre.md-meta-block {
  padding: 8px 15px;
  border: 2px dotted var(--element-color);
  background-color: var(--element-color-soo-shallow);
}

/* 行内代码 */
#write p code {
  padding: 0px 3px 0px 7px;
  color: var(--element-color-linecode);
  background: var(--element-color-linecode-background);
  border-radius: 3px;
  font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;
  letter-spacing: 0.5px;
}

#write li code {
  color: var(--element-color-linecode);
}

/* 代码块 */
.md-fences:not([lang="mermaid"])::before {
  content: attr(lang);
  text-align: right;
  padding-right: 15px;
  color: #7e7e7e;
  display: block;
  background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iNDUwcHgiIGhlaWdodD0iMTMwcHgiPgogIDxlbGxpcHNlIGN4PSI2NSIgY3k9IjY1IiByeD0iNTAiIHJ5PSI1MiIgc3Ryb2tlPSJyZ2IoMjIwLDYwLDU0KSIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJyZ2IoMjM3LDEwOCw5NikiLz4KICA8ZWxsaXBzZSBjeD0iMjI1IiBjeT0iNjUiIHJ4PSI1MCIgcnk9IjUyIiAgc3Ryb2tlPSJyZ2IoMjE4LDE1MSwzMykiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0icmdiKDI0NywxOTMsODEpIi8+CiAgPGVsbGlwc2UgY3g9IjM4NSIgY3k9IjY1IiByeD0iNTAiIHJ5PSI1MiIgIHN0cm9rZT0icmdiKDI3LDE2MSwzNykiIHN0cm9rZS13aWR0aD0iMiIgZmlsbD0icmdiKDEwMCwyMDAsODYpIi8+Cjwvc3ZnPg==);
  height: 30px;
  width: 100%;
  background-size: 40px;
  background-repeat: no-repeat;
  background-color: #f8f8f8;
  border-radius: 5px 5px 0 0;
  background-position: 6px 10px;
}

.CodeMirror-wrap .CodeMirror-scroll {
  overflow-x: auto;
}

.md-fences .cm-s-inner.CodeMirror {
  margin-top: -0.5rem;
}

.cm-s-inner.CodeMirror {
  padding: 1.2rem 0.8rem;
  color: #4f5467;
  font-family: "JetBrainsMono";
  border-radius: 10px;
  background-color: #fa0303;
  /* border: 1px solid #eef2f5;*/
  line-height: 1.6rem;
}

.CodeMirror-gutters {
  border-right: 1px solid #9d9d9d52;
  background: inherit;
  white-space: nowrap;
}

pre.CodeMirror-line {
  padding: 0 1.2rem;
}

.CodeMirror-linenumber {
  padding: 0 3px 0 5px;
  text-align: right;
  color: #a3a3a3;
}

.cm-s-inner.CodeMirror {
  background: #f8f8f8;
  border-radius: 0 0 5px 5px;
  padding: 20px 10px 20px 10px;
  page-break-before: auto;
  line-height: 1.8rem;
}

.md-rawblock .md-rawblock-tooltip {
  inset: auto 0.3rem auto auto;
  transform: translateY(-120%);
}

/* 代码块颜色 */
.cm-keyword {
  color: #a626a4 !important;
  font-weight: 700 !important;
}

.cm-variable {
  color: #b92121 !important;
}

.cm-tag {
  color: var(--color-cm-keyword) !important;
  font-weight: 700 !important;
}

.cm-variable-3,
.cm-variable-2 {
  color: #7aadad !important;
  font-weight: 700 !important;
}

.cm-def {
  color: #c18401 !important;
}

.cm-attribute {
  color: #8f6aa8 !important;
}

.cm-comment,
.md-comment,
.md-meta {
  color: #9a9a9a !important;
}

.cm-string {
  color: #50a14f !important;
  font-variant-ligatures: common-ligatures !important;
}

.cm-link {
  color: #e46918 !important;
}

.cm-type {
  color: #626161;
}

.cm-property {
  color: #800a84 !important;
}

.cm-tag:not(.cm-bracket) {
  font-weight: 700;
}

.cm-operator {
  color: #0abe00 !important;
}

.cm-number {
  color: #1694b6 !important;
}

.cm-meta {
  color: #4078f2 !important;
  font-weight: 700 !important;
}

.cm-builtin {
  color: #fa6060 !important;
}

/** 表格内的单元格*/
#write table tr th,
#write table tr td {
  font-size: 14px;
  color: #000;
}

#write .footnotes {
  padding: 10px;
  font-size: 14px;
  border-radius: 6px;
  border: 0.8px solid var(--element-color-deep);
}

#write table.md-table {
  overflow: hidden;
}
#write table thead {
  border-top: 1px solid #dedddd;
  border-bottom: 1px solid #dedddd;
}
#write table tbody {
  border-bottom: 1px solid #dedddd;
}

/* 脚注文字 */
#write .footnote-word {
  font-weight: normal;
  color: #595959;
}

/* 脚注上标 */
#write .footnote-ref {
  font-weight: normal;
  color: #595959;
}

/*脚注链接样式*/
#write .footnote-item em {
  font-size: 14px;
  color: #595959;
  display: block;
  background: none;
}

/* 目录 */

.md-toc * {
  font-family: "HarmonyOS_Sans_SC";
}
.md-tooltip-hide > span {
  display: none;
}
.md-toc:before {
  position: relative;
  display: inline-block;
  width: 100%;
  text-align: center;
  content: "目录";
  font-size: 20px;
  font-weight: 700;
  color: #000;
}
.md-toc {
  padding: 20px 0;
  margin: 0 20px;
  background-color: var(--element-color-soo-shallow);
  border: 2px solid var(--element-color);
  border-radius: 5px;
}
.md-toc-item {
  line-height: 1.8em;
  display: block;
  color: #333;
}

/* 程序UI */

/* 侧边栏 */

#typora-sidebar {
  height: 100%;
  color: var(--appui-color-text);
  font-size: 0.92rem;
  background-color: #fff;
}

/* 滑块 */

#outline-content::-webkit-scrollbar {
  width: 5px;
}

#file-library::-webkit-scrollbar {
  width:5px;
}

::-webkit-scrollbar-track {
  border-radius: 10px;
}

::-webkit-scrollbar-thumb {
  border-radius: 10px;
  background: rgba(179, 179, 179, 0.425);
}

::-webkit-scrollbar {
  width: 5px;
}

/* 侧边栏 文件 */

.active-tab-files #info-panel-tab-file .info-panel-tab-border,
.active-tab-outline #info-panel-tab-outline .info-panel-tab-border,
.ty-show-search #info-panel-tab-search .info-panel-tab-border {
  border-radius: 10px;
  height: 4px;
  background-color: var(--appui-color);
}

.file-node-content {
  line-height: 1.2rem;
}

.file-tree-node.active > .file-node-content {
  color: var(--appui-color);
}

span.file-node-title {
  color: var(--appui-color-text);
}

.file-node-icon {
  color: var(--appui-color-icon);
  padding-right: 0.2rem;
}

.file-tree-node.active > .file-node-background {
  font-weight: bolder;
  border-left: 4px solid var(--appui-color);
  border-color: var(--appui-color);
}

.info-panel-tab-title {
  font-weight: bolder;
  color: var(--appui-color-text);
}

/* 侧边栏 搜索 */

#file-library-search-panel {
  background-color: #fff;
}

#file-library-search-input {
  border-radius: 3px;
  border-color: var(--appui-color);
}
#file-library-search-input:focus {
  border-width: 2px;
}

/* 侧边栏 大纲 */
#outline-content .outline-h1 > .outline-item {
  font-size: larger;
  font-weight: bold;
  color: var(--element-color-deep);
}

#outline-content .outline-h1:not(:first-of-type) > .outline-item {
  margin-top: 10px;
}

#outline-content .outline-h2 > .outline-item::before {
  content: "";
  width: 12px;
  height: 12px;
  background: var(--element-color);
  vertical-align: middle;
  float: left;
  margin-top: -2px;
  margin-right: 11px;
  margin-left: -24px;
  border-radius: 100%;
  border: 3px solid #fff;
  z-index: 100;
  position: relative;
  top: 8px;
  left: 8px;
}

#outline-content .outline-h2::after {
  content: "";
  height: calc(100% - 24px);
  width: 1px;
  background: var(--element-color);
  position: absolute;
  left: 3px;
  top: 21px;
}

#outline-content .outline-h2 > .outline-item:last-child:after {
  display: none;
}

#outline-content .outline-h2 > .outline-item > .outline-label {
  line-height: 1.65rem;
  margin: 0;
}
#outline-content .outline-h2 > .outline-item {
  margin-bottom: -3px;
}

#outline-content .outline-h3 > .outline-item > .outline-label {
  border-left: 2px solid var(--element-color);
  padding-left: 8px;
}

.outline-item-active:not(.outline-item-wrapper)::after {
  content: "";
  position: relative;
  width: 11px;
  height: 8px;
  background: var(--element-color-deep);
  float: right;
  top: -12px;
  z-index: 100;
  border-radius: 40% 20% 20% 40%;
}

/* 导出HTML的样式 */
body.typora-export {
  padding-left: 0px;
}
.typora-export-content .outline-content::before {
  content: "目录";
  font-size: 20px;
  font-weight: bold;
  position: absolute;
  top: 22px;
  left: 15px;
  border-radius: 5px;
  box-sizing: border-box;
  z-index: -1;
}

.typora-export-sidebar .outline-content {
  height: 100%;
  padding-left: 15px;
  border-right: 1px solid #d2d2d2;
}

.typora-export-content .typora-export-content {
  padding-left: 0px;
}

.typora-export-content .outline-expander {
  width: 0;
}

.typora-export-content .outline-item-active > .outline-item::after {
  content: "";
  position: relative;
  width: 11px;
  height: 8px;
  background: var(--element-color-deep);
  float: right;
  right: 5px;
  top: -14px;
  z-index: 100;
  border-radius: 40% 20% 20% 40%;
}
.typora-export-content .outline-label {
  max-width: 250px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.outline-content .outline-h1 > .outline-item {
  font-size: larger;
  font-weight: bold;
  color: var(--element-color-deep);
}

.outline-content .outline-h1:not(:first-of-type) > .outline-item {
  margin-top: 10px;
}

.outline-content .outline-h2 > .outline-item::before {
  content: "";
  width: 12px;
  height: 12px;
  background: var(--element-color-deep);
  vertical-align: middle;
  float: left;
  margin-top: -2px;
  margin-right: 11px;
  margin-left: -24px;
  border-radius: 100%;
  border: 3px solid #fff;
  z-index: 100;
  position: relative;
  top: 8px;
  left: 8px;
}

.outline-content .outline-h2::after {
  content: "";
  height: calc(100% - 24px);
  width: 1px;
  background: var(--element-color);
  position: absolute;
  left: 3px;
  top: 21px;
}

.outline-content .outline-h2 > .outline-item:last-child:after {
  display: none;
}

.outline-content .outline-h2 > .outline-item > .outline-label {
  line-height: 1.65rem;
  margin: 0;
}
.outline-content .outline-h2 > .outline-item {
  margin-bottom: -3px;
}

.outline-content .outline-h3 > .outline-item > .outline-label {
  border-left: 2px solid var(--element-color);
  padding-left: 8px;
}
@import url();

:root {
  /* 标题后小图标，借鉴自思源笔记主题——Savor */
  --h1-r-graphic: url("data:image/svg+xml;utf8,<svg fill='rgba(74, 200, 141, 0.5)' height='24' viewBox='0 0 32 32' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M4.8 29.714v0c-1.371 0-2.514-1.143-2.514-2.514v0c0-1.371 1.143-2.514 2.514-2.514v0c1.371 0 2.514 1.143 2.514 2.514v0c0.114 1.371-1.029 2.514-2.514 2.514z'/></svg>")
    no-repeat center;
  --h2-r-graphic: url("data:image/svg+xml;utf8,<svg fill='rgba(74, 200, 141, 0.5)' height='24' viewBox='0 0 32 32' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M11.429 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM4.571 18.286c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286z'/></svg>")
    no-repeat center;
  --h3-r-graphic: url("data:image/svg+xml;utf8,<svg fill='rgba(74, 200, 141, 0.5)' height='28' viewBox='0 0 32 32' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M4.571 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM4.571 18.286c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286z'/></svg>")
    no-repeat center;
  --h4-r-graphic: url("data:image/svg+xml;utf8,<svg fill='rgba(74, 200, 141, 0.5)' height='24' viewBox='0 0 32 32' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M4.571 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM4.571 18.286c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 22.857c1.257 0 2.286-1.029 2.286-2.286s-1.029-2.286-2.286-2.286-2.286 1.029-2.286 2.286 1.029 2.286 2.286 2.286z'/></svg>")
    no-repeat center;
  --h5-r-graphic: url("data:image/svg+xml;utf8,<svg fill='rgba(74, 200, 141, 0.5)' height='24' viewBox='0 0 32 32' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M4.571 18.286c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 22.857c1.257 0 2.286-1.029 2.286-2.286s-1.029-2.286-2.286-2.286-2.286 1.029-2.286 2.286 1.029 2.286 2.286 2.286zM4.571 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM4.571 11.429c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286z'/></svg>")
    no-repeat center;
  --h6-r-graphic: url("data:image/svg+xml;utf8,<svg fill='rgba(74, 200, 141, 0.5)' height='24' viewBox='0 0 32 32' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M4.571 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM4.571 18.286c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM4.571 11.429c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 18.286c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 25.143c-1.257 0-2.286 1.029-2.286 2.286s1.029 2.286 2.286 2.286 2.286-1.029 2.286-2.286-1.029-2.286-2.286-2.286zM11.429 16c1.257 0 2.286-1.029 2.286-2.286s-1.029-2.286-2.286-2.286-2.286 1.029-2.286 2.286 1.029 2.286 2.286 2.286z'/></svg>")
    no-repeat center;

  /* 主题颜色 */

  --head-title-color: #11aa63; /* 标题主色 */
  --head-title-h2-background: linear-gradient(
    to right,
    #43bd84,
    #68eaad
  ); /* 二级标题主色，因为二级标题是背景色的，所以单独设置 */

  --element-color: #11aa63; /* 元素主色 */
  --element-color-deep: #009a52; /* 元素深色 */
  --element-color-shallow: #80c3a4; /* 元素浅色 */
  --element-color-so-shallow: #43bd8499; /* 元素很浅色 */
  --element-color-soo-shallow: #6cb19125; /* 元素非常浅色 */

  --element-color-linecode: #143526; /* 行内代码文字色 */
  --element-color-linecode-background: #80c3a495; /* 行内代码背景色 */

  /* 程序本体UI */
  --appui-color: #008145; /* 程序UI主题色 */
  --appui-color-icon: #0e874f; /* 程序UI图标颜色 */
  --appui-color-text: #333; /* 程序UI文字色 */
}

.avatar {
  width: 150px; /* 可以根据需要调整大小 */
  height: 150px; 
  border-radius: 50%; /* 将头像裁剪成圆形 */
  object-fit: cover; /* 保持图像的长宽比 */
  border: 2px solid #ccc; /* 可选：为头像加一个边框 */
}
h3.artistic {
  font-family: 'Arial', sans-serif; /* 设置字体 */
  font-size: 48px; /* 设置字体大小 */
  font-weight: bold; /* 加粗字体 */
  color: #ff6347; /* 设置文字颜色 */
  background: linear-gradient(45deg, #ff6347, #ffa07a); /* 线性渐变背景 */
  -webkit-background-clip: text; /* 剪裁背景到文字 */
  color: transparent; /* 文字颜色透明，显示背景色 */
  text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.3); /* 添加阴影 */
  letter-spacing: 2px; /* 增加字母间距 */
  text-transform: uppercase; /* 将文本转换为大写 */
  transition: all 0.3s ease; /* 添加动画过渡效果 */
}

h3.artistic:hover {
  color: #ffa07a; /* 悬停时的文字颜色 */
  text-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5); /* 悬停时的阴影效果 */
  transform: scale(1.1); /* 悬停时的缩放效果 */
}
.container {
  display: flex;
  flex-direction: column;
  align-items: center; /* 水平居中 */
  text-align: center; /* 使文本水平居中 */
}      

</style><title>操作系统</title>
</head>
<body class='typora-export os-windows typora-export-show-outline typora-export-collapse-outline'><div class='typora-export-content'>
<div class="typora-export-sidebar"><div class="outline-content"><div class="container"><img src="img\79d90bac55f3b9d301c0da96f0828a7.jpg" alt="头像" class="avatar" ><h3 class="artistic"><a href="./home.html">mango</a></h3></div><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#一基本概念">一，基本概念</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#11-概念功能">1.1 概念功能</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#12特征发展和分类">1.2特征，发展和分类</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1特征">1.特征</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-发展">2. 发展</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-分类">3. 分类</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#13-运行机制">1.3 运行机制</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-特权指令和非特权指令">1. 特权指令和非特权指令</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2处理器状态核心态与用户态">2.处理器状态：核心态与用户态</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-内核程序和应用程序">3. 内核程序和应用程序</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#14-中断和异常">1.4 中断和异常</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1中断的作用">1.中断的作用：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2异常的作用">2.异常的作用：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3中断的类型">3.中断的类型：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4中断机制的基本原理">4.中断机制的基本原理：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#15-系统调用">1.5 系统调用</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1什么是系统调用">1.什么是系统调用：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2系统调用和库函数的区别">2.系统调用和库函数的区别：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3为什么系统调用是必须的">3.为什么系统调用是必须的：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4什么功能要用系统调用实现">4.什么功能要用系统调用实现：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5系统调用的过程">5.系统调用的过程：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#16-操作系统体系结构">1.6 操作系统体系结构</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1大内核monolithic-kernel）">1.大内核（Monolithic Kernel）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2微内核microkernel）">2.微内核（Microkernel）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3分层结构layered-structure）">3.分层结构（Layered Structure）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4模块化modular-kernel）">4.模块化（Modular Kernel）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5外核exokernel）">5.外核（Exokernel）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#6-内核">6. 内核</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#17-操作系统引导boot">1.7 操作系统引导boot</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-引导过程基本步骤">1. 引导过程基本步骤：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-磁盘相关数据">2. 磁盘相关数据：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-引导过程详细描述">3. 引导过程详细描述：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#18-虚拟机">1.8 虚拟机</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第二章进程">第二章进程</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#21-概念组成特征">2.1 概念，组成，特征</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1进程的概念">1.进程的概念</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2进程的组成">2.进程的组成</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3进程的特征">3.进程的特征</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#22-进程的状态与转换">2.2 进程的状态与转换</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1进程的状态">1.进程的状态</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2状态间的转换">2.状态间的转换</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3进程的组织方式">3.进程的组织方式</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#23-进程控制">2.3 进程控制</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1进程控制的基本概念">1.进程控制的基本概念</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2进程控制相关的原语">2.进程控制相关的原语</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#24-进程通信">2.4 进程通信</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1共享存储">1.共享存储</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2消息传递">2.消息传递</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3管道通信">3.管道通信</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第三章-线程">第三章 线程</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#31-线程的基本概念">3.1 线程的基本概念</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1什么是线程为什么要引入线程">1.什么是线程？为什么要引入线程？</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2引入线程机制后有什么变化">2.引入线程机制后，有什么变化？</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3线程有哪些重要的属性">3.线程有哪些重要的属性？</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#32-线程的实现方式和多线程模型">3.2 线程的实现方式和多线程模型</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1线程的实现方式">1.线程的实现方式</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2多线程模型">2.多线程模型</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#33-线程的状态与转换">3.3 线程的状态与转换</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#线程的状态与转换">线程的状态与转换</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#线程的组织与控制">线程的组织与控制</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第四章调度">第四章调度</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#41-调度的概念层次">4.1 调度的概念、层次</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1高级调度作业调度）">1.高级调度（作业调度）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2中级调度内存调度）">2.中级调度（内存调度）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3低级调度进程调度）">3.低级调度（进程调度）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4三层调度的联系">4.三层调度的联系</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5三层调度的对比">5.三层调度的对比</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#6进程的挂起状态">6.进程的挂起状态</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#7进程的七状态模型">7.进程的七状态模型</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#8引起进程状态转换的具体原因">8.引起进程状态转换的具体原因</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#42-进程调度的时机进程的切换和过程方式">4.2 进程调度的时机，进程的切换和过程，方式</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1进程调度的时机">1.进程调度的时机</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2进程的切换和过程">2.进程的切换和过程</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3进程调度的方式">3.进程调度的方式</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#43-调度器和闲逛进程">4.3 调度器和闲逛进程</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1调度器">1.调度器</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2闲逛进程">2.闲逛进程</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#44-调度算法的性能评价">4.4 调度算法的性能评价</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1cpu利用率">1.CPU利用率</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2系统吞吐量">2.系统吞吐量</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3周转时间">3.周转时间</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4等待时间">4.等待时间</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5响应时间">5.响应时间</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#45-调度算法1）">4.5 调度算法（1）</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1先来先服务fcfs）">1.先来先服务（FCFS）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2短作业优先sjf）">2.短作业优先（SJF）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3高响应比优先hrrn）">3.高响应比优先（HRRN）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#46-调度算法2）">4.6 调度算法（2）</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1时间片轮转round-robin-rr）">1.时间片轮转（Round Robin, RR）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2优先级调度priority-scheduling）">2.优先级调度（Priority Scheduling）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3多级反馈队列multilevel-feedback-queue-mfq）">3.多级反馈队列（Multilevel Feedback Queue, MFQ）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#47-调度算法3）">4.7 调度算法（3）</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1基本原理">1.基本原理</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2特点">2.特点</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3调度过程">3.调度过程</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4性能分析">4.性能分析</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5缺点">5.缺点</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#6应用场景">6.应用场景</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第五章-同步和互斥">第五章 同步和互斥</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#51-进程同步和进程互斥">5.1 进程同步和进程互斥</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1进程同步process-synchronization）">1.进程同步（Process Synchronization）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2进程互斥process-mutual-exclusion）">2.进程互斥（Process Mutual Exclusion）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3举例说明">3.举例说明</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4总结">4.总结</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#52进程互斥的软件实现方法">5.2进程互斥的软件实现方法</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1单标志法single-flag-method）">1.单标志法（Single Flag Method）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2双标志先检查double-flag-with-preemption）">2.双标志先检查（Double Flag with Preemption）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3双标志后检查double-flag-with-postemption）">3.双标志后检查（Double Flag with Postemption）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4peterson算法petersons-algorithm）">4.Peterson算法（Peterson’s Algorithm）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#53-进程互斥的硬件实现方法">5.3 进程互斥的硬件实现方法</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1中断屏蔽方法interrupt-masking）">1.中断屏蔽方法（Interrupt Masking）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2testandset指令test-and-set-lock）">2.TestAndSet指令（Test-and-Set Lock）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3swap指令exchange-or-swap-lock）">3.Swap指令（Exchange or Swap Lock）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#54互斥锁">5.4互斥锁</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1基本概念-1">1.基本概念</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2互斥锁的操作">2.互斥锁的操作</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3示例代码">3.示例代码</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4注意事项">4.注意事项</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#55-信号量机制">5.5 信号量机制</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#56-生产者-消费者问题">5.6 生产者-消费者问题</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#57-吸烟者问题">5.7 吸烟者问题</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#57-读者写者问题">5.7 读者写者问题</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1问题描述">1.问题描述</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2目标">2.目标</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3解决方案">3.解决方案</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-读者优先">1. 读者优先</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-写者优先">2. 写者优先</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-读写公平">3. 读写公平</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#58-哲学家进餐问题">5.8 哲学家进餐问题</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#问题描述">问题描述</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#目标">目标</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#解决方案">解决方案</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-资源分级法">1. 资源分级法</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-服务员方法">2. 服务员方法</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-超时放弃法">3. 超时放弃法</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#59-管程">5.9 管程</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#管程的主要特性">管程的主要特性</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#管程的基本组成">管程的基本组成</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#管程的操作">管程的操作</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#示例">示例</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5-10死锁">5. 10死锁</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1死锁的四个必要条件">1.死锁的四个必要条件</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2死锁示例">2.死锁示例</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3死锁的处理方法">3.死锁的处理方法</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4死锁的解除策略">4.死锁的解除策略</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#5避免死锁的策略">5.避免死锁的策略</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第六章-内存">第六章 内存</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#61-内存的基本知识">6.1 内存的基本知识</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1什么是内存有什么作用">1.什么是内存，有什么作用？</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-进程运行的基本原理">2. 进程运行的基本原理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#指令的工作原理">指令的工作原理</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#逻辑地址vs物理地址">逻辑地址VS物理地址</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#如何实现地址转换">如何实现地址转换</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#从写程序到程序运行的过程">从写程序到程序运行的过程</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#62-内存管理的概念">6.2 内存管理的概念</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1内存空间的分配与回收">1.内存空间的分配与回收</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#分配">分配</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#连续分配管理方式">连续分配管理方式</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#非连续分配管理方式">非连续分配管理方式</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#回收">回收</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2内存空间的扩充">2.内存空间的扩充</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#覆盖技术一般不用了）">覆盖技术（一般不用了）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#虚拟内存">虚拟内存</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#硬件扩充">硬件扩充</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-地址转换">3. 地址转换</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#存储保护">存储保护</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#两种方式">两种方式</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#访问控制-1">访问控制</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#地址空间隔离">地址空间隔离</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#异常处理">异常处理</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#63-动态分区分配算法">6.3 动态分区分配算法</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1首次适应算法first-fit）">1.首次适应算法（First Fit）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2最佳适应算法best-fit）">2.最佳适应算法（Best Fit）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3最坏适应算法worst-fit）">3.最坏适应算法（Worst Fit）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4临近适应算法next-fit）">4.临近适应算法（Next Fit）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#64-虚拟内存">6.4 虚拟内存</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1基本概念-2">1.基本概念</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#传统存储管理方式的特征和缺点">传统存储管理方式的特征和缺点</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#特征-1">特征</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#缺点">缺点</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#局部性原理">局部性原理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#时间局部性">时间局部性</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#空间局部性">空间局部性</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#高速缓存技术">高速缓存技术</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#虚拟内存的定义和特征">虚拟内存的定义和特征</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#定义">定义</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#特征-2">特征</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h4 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#如何实现虚拟内存技术">如何实现虚拟内存技术</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#分页paging）">分页（Paging）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#段页式segmented-paging）">段页式（Segmented Paging）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#页面置换page-replacement）">页面置换（Page Replacement）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#硬件支持">硬件支持</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-页面置换算法">2. 页面置换算法</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#opt最优页面置换算法optimal-page-replacement）">OPT（最优页面置换算法，Optimal Page Replacement）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#fifo先进先出页面置换算法first-in-first-out）">FIFO（先进先出页面置换算法，First In, First Out）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#lru最近最少使用页面置换算法least-recently-used）">LRU（最近最少使用页面置换算法，Least Recently Used）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#clock时钟页面置换算法）">CLOCK（时钟页面置换算法）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#改进型的时钟置换算法">改进型的时钟置换算法</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3页面分配策略">3.页面分配策略</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#驻留集resident-set）">驻留集（Resident Set）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#页面分配置换策略">页面分配、置换策略</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#固定分配局部置换fixed-allocation-with-local-replacement）">固定分配局部置换（Fixed Allocation with Local Replacement）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#可变分配全局置换variable-allocation-with-global-replacement）">可变分配全局置换（Variable Allocation with Global Replacement）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h5 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#可变分配局部置换variable-allocation-with-local-replacement）">可变分配局部置换（Variable Allocation with Local Replacement）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#调入页面的时机">调入页面的时机</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#从何处调页">从何处调页</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#抖动现象thrashing）">抖动现象（Thrashing）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#工作集working-set）">工作集（Working Set）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4内存映射文件">4.内存映射文件</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第七章-文件管理">第七章 文件管理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#71基本概念">7.1基本概念</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1文件的属性">1.文件的属性</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2文件的存储逻辑结构">2.文件的存储逻辑结构</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#72文件目录">7.2.文件目录</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#文件目录的实现">文件目录的实现</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#目录结构">目录结构</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#索引节点">索引节点</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#73物理结构">7.3.物理结构</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-连续分配contiguous-allocation）">1. 连续分配（Contiguous Allocation）</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#特点-1">特点：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#实现方式-1">实现方式：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-链式分配linked-allocation）">2. 链式分配（Linked Allocation）</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#特点-2">特点：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#实现方式-2">实现方式：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3 outline-item-open"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-索引分配indexed-allocation）">3. 索引分配（Indexed Allocation）</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#特点-3">特点：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#实现方式-3">实现方式：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4对比总结">4.对比总结：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#74文件存储空间管理">7.4文件存储空间管理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#存储空间的划分与初始化">存储空间的划分与初始化</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#存储空间的管理方法">存储空间的管理方法</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#75-文件的基本操作">7.5 文件的基本操作</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#76-文件共享和保护">7.6 文件共享和保护</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#文件共享">文件共享</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#基于索引节点硬链接）">基于索引节点（硬链接）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#基于符号链软连接）">基于符号链（软连接）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h3"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#文件保护">文件保护</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#口令保护">口令保护</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#加密保护">加密保护</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h4 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#访问控制-2">访问控制</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#77-文件层次结构全局结构">7.7 文件层次结构，全局结构</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#物理格式化">物理格式化</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#逻辑格式化">逻辑格式化</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#虚拟文件系统vfs）">虚拟文件系统（VFS）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#文件系统挂载">文件系统挂载</a></div><ul class="outline-children"></ul></li></ul></li></ul></li><li class="outline-item-wrapper outline-h1"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#第八章-设备管理">第八章 设备管理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#81-io设备的概念和分类">8.1 I/O设备的概念和分类</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#什么是io设备">什么是I/O设备？</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#按使用特性分类">按使用特性分类</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#按传输速率分类">按传输速率分类</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#按信息交换的单位分类">按信息交换的单位分类</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#82-io控制方式">8.2 I/O控制方式</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#1-程序直接控制programmed-io）">1. 程序直接控制（Programmed I/O）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#2-中断驱动iointerrupt-driven-io）">2. 中断驱动I/O（Interrupt-driven I/O）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#3-直接内存访问dmadirect-memory-access）">3. 直接内存访问（DMA，Direct Memory Access）</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#4-通道方式channel-io）">4. 通道方式（Channel I/O）</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#83-假脱机技术">8.3 假脱机技术</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#什么是假脱机技术及解决的问题">什么是假脱机技术及解决的问题：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#实现原理">实现原理：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#共享打印机原理">共享打印机原理：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#84-设备管理与回收">8.4 设备管理与回收</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#设备分配">设备分配：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#设备分配的过程">设备分配的过程：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#设备回收">设备回收：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#设备分配与回收的策略">设备分配与回收的策略：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#85-缓冲区管理">8.5 缓冲区管理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#基本概念">基本概念：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#目的">目的：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#策略">策略：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#实现方式-4">实现方式：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#缓冲区管理的挑战">缓冲区管理的挑战：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#8-6-磁盘结构调度算法和管理">8. 6 磁盘结构、调度算法和管理</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#磁盘结构">磁盘结构：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#磁盘调度算法">磁盘调度算法：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#磁盘管理">磁盘管理：</a></div><ul class="outline-children"></ul></li></ul></li><li class="outline-item-wrapper outline-h2"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#87-固态硬盘">8.7 固态硬盘</a></div><ul class="outline-children"><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ssd的结构">SSD的结构：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ssd的优点">SSD的优点：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ssd的缺点">SSD的缺点：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ssd的类型">SSD的类型：</a></div><ul class="outline-children"></ul></li><li class="outline-item-wrapper outline-h3 outline-item-single"><div class="outline-item"><span class="outline-expander"></span><a class="outline-label" href="#ssd的管理">SSD的管理：</a></div><ul class="outline-children"></ul></li></ul></li></ul></li></div></div><div id='write'  class=''><h1 id='一基本概念'><span>一，基本概念</span></h1><h2 id='11-概念功能'><span>1.1 概念功能</span></h2><ul><li><p><strong><span>操作系统（Operating System，OS）</span></strong><span>:是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配；以提供给用户和其他的软件方便的接口和环境；它是计算机系统中最基本的系统软件。</span></p></li><li><p><strong><span>系统资源的管理者</span></strong><span>：</span></p><ul><li><p><span>提供功能</span></p><ul><li><span>处理机管理</span></li><li><span>存储器管理</span></li><li><span>文件管理</span></li><li><span>设备管理</span></li></ul></li><li><p><span>目标</span></p><ul><li><span>安全，高效</span></li><li><span>向上层提供方便易用的服务：用户无需关心底层硬件的原理。</span></li><li><span>实现对硬件机器的拓展，通常把覆盖了软件的机器称为扩展机器（虚拟机）。</span></li></ul></li><li><p><span>GUI：图形化用户接口（Graphical User Interface）</span></p></li><li><p><span>联机命令接口=交互式命令接口（人一句，机器一句）</span></p><ul><li><span>windows ：win+R，输入cmd</span></li></ul></li><li><p><span>脱机命令接口=批处理命令接口</span></p><ul><li><span>windows ：C盘中的*.bat文件</span></li></ul></li><li><p><span>程序接口</span></p><ul><li><span>可以在程序中进行系统调用来使用程序接口。普通用户不能直接使用程序接口，只能通过程序代码间接使用。</span></li></ul></li></ul></li></ul><h2 id='12特征发展和分类'><span>1.2特征，发展和分类</span></h2><h3 id='1特征'><span>1.特征</span></h3><ul><li><p><span>并发</span></p><ul><li><p><span>定义：指两个或多个事件在同一时间间隔内发送。这些事件宏观上是同时发生的，但微观上是交替发生的。</span></p></li><li><p><span>并行：指两个或多个事件在同一时刻同时发生。</span></p></li><li><p><strong><span>操作系统的并发性：</span></strong><span>指计算机系统中”同时“运行着多个程序，这些程序宏观上看是同时运行着的，二微观上看是交替运行的。</span></p></li><li><p><span>操作系统就是伴随着”多道程序技术“而出现，因此，操作系统和程序并发是一起诞生的。</span></p></li><li><p><span>注意</span></p><ul><li><span>单核CPU同一时刻只能执行一个程序，各个程序只能并发地执行</span></li><li><span>多核CPU同一时刻可以同时执行多个程序，多个程序可以并行地执行。</span></li></ul></li></ul></li><li><p><span>共享</span></p><ul><li><p><span>互斥共享</span></p><ul><li><span>系统中的某些资源，虽然可以提供给多个进程试题，但一个事件段内只允许一个进程访问该资源。</span></li></ul></li><li><p><span>同时共享方式</span></p><ul><li><span>系统中的某些资源，允许一个时间段内由多个进程”同时“对他们进行访问。</span></li></ul></li></ul></li><li><p><span>虚拟</span></p><ul><li><span>是指把一个物理上的实体变成若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物是用户感受到的。</span></li><li><span>一个程序需要放入内存并给它分配CPU才能执行。</span></li><li><span>空分复用技术（虚拟存储器技术）和时分复用技术（虚拟处理器）。</span></li><li><span>并发是虚拟的基础。</span></li></ul></li><li><p><span>异步</span></p><ul><li><span>在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。</span></li></ul></li></ul><h3 id='2-发展'><span>2. 发展</span></h3><ol start='' ><li><p><strong><span>手工操作阶段（1940年代-1950年代）</span></strong></p><ul><li><span>早期计算机没有操作系统，所有的操作都是通过手工进行的。</span></li></ul></li><li><p><strong><span>单任务操作系统（1950年代-1960年代）</span></strong></p><ul><li><span>早期操作系统如IBM的OS/360，可以管理批处理任务。</span></li></ul></li><li><p><strong><span>多道程序与分时系统（1960年代）</span></strong></p><ul><li><span>多道程序设计使得计算机可以同时运行多个程序。</span></li><li><span>分时系统允许多个用户通过终端同时使用一台计算机。</span></li></ul></li><li><p><strong><span>个人计算机操作系统（1970年代-1980年代）</span></strong></p><ul><li><span>如CP/M、MS-DOS等，它们是单用户、单任务的操作系统。</span></li></ul></li><li><p><strong><span>图形用户界面（GUI）操作系统（1980年代）</span></strong></p><ul><li><span>苹果的Mac OS和微软的Windows操作系统将图形用户界面推向普及。</span></li></ul></li><li><p><strong><span>现代操作系统（1990年代至今）</span></strong></p><ul><li><span>如Windows、Linux、macOS等，提供了多任务、多用户、网络功能和安全机制。</span></li></ul></li></ol><h3 id='3-分类'><span>3. 分类</span></h3><ol start='' ><li><p><strong><span>根据用户数量分类</span></strong></p><ul><li><span>单用户操作系统：一次只能由一个用户使用，如MS-DOS、早期版本的Mac OS。</span></li><li><span>多用户操作系统：允许多个用户同时使用，如Unix、Linux。</span></li></ul></li><li><p><strong><span>根据任务处理方式分类</span></strong></p><ul><li><span>单任务操作系统：一次只能运行一个任务，如早期的操作系统。</span></li><li><span>多任务操作系统：可以同时运行多个任务，如Windows、Linux。</span></li></ul></li><li><p><strong><span>根据指令处理方式分类</span></strong></p><ul><li><span>批处理操作系统：批量处理任务，用户不直接与计算机交互。</span></li><li><span>交互式操作系统：用户可以与计算机进行交互，如现代的GUI操作系统。</span></li></ul></li><li><p><strong><span>根据硬件架构分类</span></strong></p><ul><li><span>大型机操作系统：如IBM的MVS。</span></li><li><span>小型机操作系统：如Unix。</span></li><li><span>个人计算机操作系统：如Windows、macOS。</span></li><li><span>嵌入式操作系统：如Android、iOS。</span></li></ul></li><li><p><strong><span>根据源代码的开放性分类</span></strong></p><ul><li><span>开源操作系统：源代码公开，如Linux。</span></li><li><span>闭源操作系统：源代码不公开，如Windows。</span></li></ul></li><li><p><strong><span>根据操作系统的用途分类</span></strong></p><ul><li><span>通用操作系统：适用于多种用途，如Windows、Linux。</span></li><li><span>实时操作系统：用于需要及时响应的系统中，如航空控制系统。</span></li><li><span>网络操作系统：专为网络环境设计，如Novell NetWare。</span></li></ul></li></ol><h2 id='13-运行机制'><span>1.3 运行机制</span></h2><h3 id='1-特权指令和非特权指令'><span>1. 特权指令和非特权指令</span></h3><p><strong><span>特权指令</span></strong><span>：</span></p><ul><li><span>特权指令是只能由操作系统在核心态执行的一类指令。</span></li><li><span>这类指令可以执行硬件相关的操作，如设置中断、访问硬件状态寄存器、启动I/O操作等。</span></li><li><span>它们对系统的稳定和安全至关重要，因此不能在用户态执行，以防止用户程序破坏系统的稳定。</span></li></ul><p><strong><span>非特权指令</span></strong><span>：</span></p><ul><li><span>非特权指令是用户程序在用户态可以执行的指令。</span></li><li><span>这类指令通常涉及数据处理，如算术运算、逻辑运算、数据传输等，不直接与硬件打交道。</span></li><li><span>它们不会直接影响到系统的稳定性和安全性。</span></li></ul><h3 id='2处理器状态核心态与用户态'><span>2.处理器状态：核心态与用户态</span></h3><p><strong><span>核心态（也称为系统态或特权态）</span></strong><span>：</span></p><ul><li><span>当处理器处于核心态时，它可以执行所有的机器指令，包括特权指令和非特权指令。</span></li><li><span>操作系统在核心态运行，可以完全控制硬件资源。</span></li><li><span>在发生中断或系统调用时，处理器会从用户态切换到核心态。</span></li></ul><p><strong><span>用户态</span></strong><span>：</span></p><ul><li><span>用户态是一种限制模式，处理器在这种状态下不能执行特权指令。</span></li><li><span>大多数应用程序在用户态运行，这样可以防止它们执行可能破坏系统操作或安全性的操作。</span></li><li><span>当应用程序需要执行特权操作时，它必须通过系统调用请求操作系统以核心态代为执行。</span></li></ul><p><strong><span>拓展：</span></strong></p><ul><li><span>CPU中有一个寄存器叫：程序状态字寄存器（PSW），其中有个二进制，1表示”内核态“，0表示”用户态“。</span></li><li><span>别名：内核态=核心态=管态，用户态=目态。</span></li></ul><h3 id='3-内核程序和应用程序'><span>3. 内核程序和应用程序</span></h3><p><strong><span>内核程序</span></strong><span>：</span></p><ul><li><span>内核程序是操作系统的一部分，它们运行在核心态。</span></li><li><span>它们负责管理系统资源，如内存管理、进程调度、文件系统操作等。</span></li><li><span>内核程序通常具有最高的执行优先级，并且直接与硬件交互。</span></li></ul><p><strong><span>应用程序</span></strong><span>：</span></p><ul><li><span>应用程序是用户在计算机上执行的各种程序，如文字处理软件、游戏、网页浏览器等。</span></li><li><span>它们在用户态下运行，并通过系统调用与操作系统交互，以执行需要特权权限的操作。</span></li><li><span>应用程序不能直接访问硬件资源，必须通过操作系统提供的服务来间接访问。</span></li></ul><h2 id='14-中断和异常'><span>1.4 中断和异常</span></h2><h3 id='1中断的作用'><span>1.中断的作用：</span></h3><ol start='' ><li><strong><span>响应外部设备请求</span></strong><span>：当外部设备如硬盘、网络适配器等完成操作需要CPU介入时，会通过中断信号通知CPU。</span></li><li><strong><span>协调多任务处理</span></strong><span>：操作系统利用中断机制实现任务切换，合理分配处理器时间给不同的任务。</span></li><li><strong><span>错误处理</span></strong><span>：当硬件故障或软件运行出错时，系统可以通过中断来处理这些异常情况。</span></li><li><strong><span>系统调用</span></strong><span>：在用户态程序需要操作系统服务时，可以通过中断触发系统调用。</span></li></ol><ul><li><strong><span>中断</span></strong><span>是让操作系统内核夺回CPU使用权的唯一途径。</span></li></ul><h3 id='2异常的作用'><span>2.异常的作用：</span></h3><ol start='' ><li><strong><span>错误处理</span></strong><span>：异常用于处理程序中的错误，如除以零、地址越界等。</span></li><li><strong><span>资源分配</span></strong><span>：某些异常用于处理资源请求，如缺页异常。</span></li><li><strong><span>程序控制</span></strong><span>：异常可以用于改变程序的控制流程，如软件中断指令。</span></li></ol><h3 id='3中断的类型'><span>3.中断的类型：</span></h3><ol start='' ><li><strong><span>硬件中断</span></strong><span>：由硬件设备产生，如I/O请求、时钟中断等。（外中断）</span></li><li><strong><span>软件中断</span></strong><span>：由执行中断指令（INT）产生，如系统调用。（内中断）</span></li><li><strong><span>异常</span></strong><span>：在处理器执行指令时产生的错误，如溢出、页错误等。</span></li><li><strong><span>陷阱</span></strong><span>（也是一种异常）：由程序故意引发的，如调试中断。</span></li><li><strong><span>故障</span></strong><span>（也是一种异常）：可能被故障处理程序修正的错误。</span></li><li><strong><span>终止</span></strong><span>（也是一种异常）：不可恢复的错误，通常会导致程序终止。</span></li></ol><ul><li><strong><span>陷入指令不是特权指令。</span></strong></li></ul><h3 id='4中断机制的基本原理'><span>4.中断机制的基本原理：</span></h3><ol start='' ><li><strong><span>中断请求</span></strong><span>：当事件发生时，中断源会向CPU发送中断请求（IRQ）。</span></li><li><strong><span>中断识别</span></strong><span>：CPU在每条指令执行完毕后检查是否有中断请求。</span></li><li><strong><span>中断响应</span></strong><span>：如果检测到中断请求，CPU会完成当前指令的执行，然后暂停当前程序的执行，保存当前处理器的状态（如程序计数器、寄存器等），这个过程称为中断响应。</span></li><li><strong><span>中断处理</span></strong><span>：CPU根据中断向量表中的信息，跳转到对应的中断服务例程（ISR）执行，以处理中断。</span></li><li><strong><span>恢复执行</span></strong><span>：中断服务完成后，CPU恢复之前保存的处理状态，继续执行被中断的程序。</span></li></ol><h2 id='15-系统调用'><span>1.5 系统调用</span></h2><h3 id='1什么是系统调用'><span>1.什么是系统调用：</span></h3><p><span>系统调用（System Call）是应用程序请求操作系统提供服务的唯一方式。在Unix、Linux、Windows等操作系统中，系统调用是应用程序与操作系统内核之间的接口。通过系统调用，应用程序可以执行文件I/O、进程管理、网络通信等操作，这些操作通常需要更高级别的权限，普通应用程序无法直接执行。</span></p><h3 id='2系统调用和库函数的区别'><span>2.系统调用和库函数的区别：</span></h3><ol start='' ><li><p><strong><span>来源</span></strong><span>：</span></p><ul><li><strong><span>系统调用</span></strong><span>：由操作系统提供，是操作系统内核的一部分。</span></li><li><strong><span>库函数</span></strong><span>：由标准库或第三方库提供，是用户空间的应用程序代码。</span></li></ul></li><li><p><strong><span>执行</span></strong><span>：</span></p><ul><li><strong><span>系统调用</span></strong><span>：直接在内核态执行，可以执行特权操作。</span></li><li><strong><span>库函数</span></strong><span>：在用户态执行，通常是对系统调用的封装，不能执行特权操作。（也会有涉及系统调用的库函数）</span></li></ul></li><li><p><strong><span>性能</span></strong><span>：</span></p><ul><li><strong><span>系统调用</span></strong><span>：通常比库函数慢，因为它涉及到从用户态到内核态的切换。</span></li><li><strong><span>库函数</span></strong><span>：通常更快，因为它们在用户空间执行，避免了上下文切换。</span></li></ul></li><li><p><strong><span>功能</span></strong><span>：</span></p><ul><li><strong><span>系统调用</span></strong><span>：提供了对硬件和系统资源的直接访问。</span></li><li><strong><span>库函数</span></strong><span>：提供了更高级别的抽象，简化了编程。</span></li></ul></li></ol><h3 id='3为什么系统调用是必须的'><span>3.为什么系统调用是必须的：</span></h3><ol start='' ><li><strong><span>权限管理</span></strong><span>：系统调用允许应用程序在受控的方式下执行特权操作，如访问硬件资源、创建和销毁进程等。</span></li><li><strong><span>资源共享</span></strong><span>：系统调用确保多个应用程序可以安全地共享系统资源，如内存、文件等。</span></li><li><strong><span>抽象和封装</span></strong><span>：系统调用为应用程序提供了操作系统服务的抽象，使得应用程序不必关心底层硬件细节。</span></li><li><strong><span>稳定性和安全性</span></strong><span>：通过系统调用，操作系统可以控制对系统资源的访问，防止恶意或错误的应用程序破坏系统。</span></li></ol><h3 id='4什么功能要用系统调用实现'><span>4.什么功能要用系统调用实现：</span></h3><ol start='' ><li><strong><span>文件操作</span></strong><span>：如打开、读取、写入、关闭文件。</span></li><li><strong><span>进程管理</span></strong><span>：如创建、终止进程，以及进程间通信。</span></li><li><strong><span>内存管理</span></strong><span>：如分配和释放内存。</span></li><li><strong><span>设备控制</span></strong><span>：如操作硬件设备。</span></li><li><strong><span>网络通信</span></strong><span>：如建立网络连接、发送和接收数据。</span></li><li><strong><span>权限控制</span></strong><span>：如更改文件权限或用户身份。</span></li></ol><h3 id='5系统调用的过程'><span>5.系统调用的过程：</span></h3><ol start='' ><li><strong><span>应用程序请求</span></strong><span>：应用程序执行一条特殊的指令（如x86架构的</span><code>int 0x80</code><span>或</span><code>sysenter</code><span>指令）或使用特定的函数调用（如在POSIX系统中使用</span><code>syscall</code><span>指令），请求系统调用。</span></li><li><strong><span>用户态到内核态</span></strong><span>：处理器从用户态切换到内核态，以便执行特权操作。</span></li><li><strong><span>参数传递</span></strong><span>：应用程序将系统调用的编号和参数传递给内核。</span></li><li><strong><span>系统调用处理</span></strong><span>：内核根据系统调用编号找到对应的处理程序，并执行它。</span></li><li><strong><span>执行操作</span></strong><span>：系统调用处理程序在内核空间执行请求的操作。</span></li><li><strong><span>返回结果</span></strong><span>：操作完成后，系统调用将结果返回给应用程序，并可能返回一个状态码表示操作的成功或失败。</span></li><li><strong><span>恢复用户态</span></strong><span>：处理器从内核态切换回用户态，应用程序继续执行。</span></li></ol><h2 id='16-操作系统体系结构'><span>1.6 操作系统体系结构</span></h2><h3 id='1大内核monolithic-kernel）'><span>1.大内核（Monolithic Kernel）</span></h3><ul><li><p><strong><span>定义</span></strong><span>：大内核体系结构将操作系统的所有核心服务（如进程管理、文件系统、设备驱动程序、内存管理等）都集成在单一的内核空间中。</span></p></li><li><p><span>特点：</span></p><ul><li><strong><span>效率</span></strong><span>：由于所有服务都在内核空间运行，它们之间的通信非常快速。</span></li><li><strong><span>复杂性</span></strong><span>：随着功能的增加，内核的大小和复杂度也会增加，导致维护和更新困难。</span></li><li><strong><span>稳定性</span></strong><span>：一个组件的故障可能会影响整个系统的稳定性。</span></li></ul></li></ul><h3 id='2微内核microkernel）'><span>2.微内核（Microkernel）</span></h3><ul><li><p><strong><span>定义</span></strong><span>：微内核体系结构只将最基本的操作系统服务（如进程和通信管理）保留在内核中，其他服务（如文件系统、设备驱动程序）则作为用户空间的进程运行。</span></p></li><li><p><span>特点：</span></p><ul><li><strong><span>安全性</span></strong><span>：由于内核较小，潜在的攻击面减少，系统更安全。</span></li><li><strong><span>灵活性</span></strong><span>：更容易添加或修改系统服务，因为它们运行在用户空间。</span></li><li><strong><span>性能</span></strong><span>：由于许多服务在用户空间运行，可能存在性能开销，因为需要频繁地在用户态和内核态之间切换。</span></li></ul></li></ul><h3 id='3分层结构layered-structure）'><span>3.分层结构（Layered Structure）</span></h3><ul><li><p><strong><span>定义</span></strong><span>：分层结构体系结构将操作系统服务分为多个层次，每一层只与它下面的层次交互。</span></p></li><li><p><span>特点：</span></p><ul><li><strong><span>模块化</span></strong><span>：每个层次都可以独立开发和测试。</span></li><li><strong><span>易于理解</span></strong><span>：层次分明，便于理解系统的结构和功能。</span></li><li><strong><span>性能影响</span></strong><span>：过多的层次可能导致性能下降，因为每一层都可能引入额外的开销。</span></li></ul></li></ul><h3 id='4模块化modular-kernel）'><span>4.模块化（Modular Kernel）</span></h3><ul><li><p><strong><span>定义</span></strong><span>：模块化体系结构允许在系统运行时动态地加载和卸载内核模块。</span></p></li><li><p><span>特点：</span></p><ul><li><strong><span>可扩展性</span></strong><span>：可以轻松添加或删除功能，而无需重新编译内核。</span></li><li><strong><span>可定制性</span></strong><span>：可以根据需要定制内核，减少资源占用。</span></li><li><strong><span>稳定性</span></strong><span>：模块化可以减少内核的大小，从而可能提高稳定性。</span></li></ul></li></ul><h3 id='5外核exokernel）'><span>5.外核（Exokernel）</span></h3><ul><li><p><strong><span>定义</span></strong><span>：外核体系结构将硬件资源的管理与操作系统的其他服务分开，为应用程序提供直接控制硬件的能力。</span></p></li><li><p><span>特点：</span></p><ul><li><strong><span>性能</span></strong><span>：应用程序可以直接访问硬件资源，可以优化性能。</span></li><li><strong><span>灵活性</span></strong><span>：允许应用程序根据需要定制资源管理策略。</span></li><li><strong><span>复杂性</span></strong><span>：增加了应用程序开发的复杂性，因为它们需要直接处理硬件资源。</span></li></ul></li></ul><p><span>每种体系结构都有其优势和劣势，它们的设计选择通常取决于操作系统的目标应用场景，如桌面、服务器、嵌入式系统等。例如，Linux采用了大内核体系结构，而Minix和QNX则采用了微内核体系结构。</span></p><h3 id='6-内核'><span>6. 内核</span></h3><ul><li><p><span>时钟管理：实现计时功能</span></p></li><li><p><span>中断处理：负责实现中断机制</span></p></li><li><p><span>原语：</span></p><ul><li><span>是一种特殊的程序</span></li><li><span>处于操作系统最底层，是最接近硬件的部分。</span></li><li><span>这种程序的运行具有原子性--其运行只能一气呵成，不可中断。</span></li><li><span>运行事件较短，调用频繁。</span></li></ul></li><li><p><span>对系统资源进行管理的功能</span></p><ul><li><span>进程管理</span></li><li><span>存储器管理</span></li><li><span>设备管理</span></li><li><span>这些管理工作更多的是对数据结构的操作，不会直接涉及硬件。</span></li></ul></li></ul><h2 id='17-操作系统引导boot'><span>1.7 操作系统引导boot</span></h2><ul><li><span>操作系统的引导（Bootstrapping）是指计算机启动时，操作系统内核加载到内存并开始执行的过程。这个过程涉及到计算机硬件和软件的多个组件，以下是其基本步骤和相关数据：</span></li></ul><h3 id='1-引导过程基本步骤'><span>1. 引导过程基本步骤：</span></h3><ol start='' ><li><p><strong><span>加电自检（POST）</span></strong><span>：</span></p><ul><li><span>当计算机加电时，首先进行的是加电自检（Power-On Self-Test），由主板上的BIOS（基本输入输出系统）执行。</span></li><li><span>POST检查计算机硬件是否正常，如内存、硬盘、显卡等。</span></li></ul></li><li><p><strong><span>BIOS初始化</span></strong><span>：</span></p><ul><li><span>BIOS会初始化硬件设备，并按照CMOS设置中的顺序搜索可引导设备。</span></li></ul></li><li><p><strong><span>引导设备</span></strong><span>：</span></p><ul><li><span>BIOS找到可引导设备后，会从该设备的引导扇区读取引导记录（MBR或EBR）。</span></li></ul></li><li><p><strong><span>引导记录（MBR/EBR）</span></strong><span>：</span></p><ul><li><span>主引导记录（Master Boot Record，MBR）位于硬盘的第一个扇区，包含引导程序和分区表。</span></li><li><span>扩展引导记录（Extended Boot Record，EBR）用于扩展分区的引导。</span></li></ul></li><li><p><strong><span>引导加载器</span></strong><span>：</span></p><ul><li><span>MBR中的引导程序通常是引导加载器（如GRUB、LILO等）的一部分，它会加载操作系统的内核到内存中。</span></li></ul></li><li><p><strong><span>操作系统内核</span></strong><span>：</span></p><ul><li><span>内核加载后，开始接管计算机的引导过程，完成硬件的初始化，并启动操作系统。</span></li></ul></li></ol><h3 id='2-磁盘相关数据'><span>2. 磁盘相关数据：</span></h3><ol start='' ><li><p><strong><span>主引导记录（MBR）</span></strong><span>：</span></p><ul><li><span>位于硬盘的第一个扇区，包含引导代码和磁盘分区表。</span></li></ul></li><li><p><strong><span>分区表</span></strong><span>：</span></p><ul><li><span>记录了磁盘上分区的位置和大小信息。</span></li></ul></li><li><p><strong><span>引导扇区</span></strong><span>：</span></p><ul><li><span>每个分区的第一个扇区也称为引导扇区，对于可引导分区，它包含引导加载器代码。</span></li></ul></li><li><p><strong><span>文件系统</span></strong><span>：</span></p><ul><li><span>磁盘上的文件系统提供了数据存储和组织的方法，操作系统通过文件系统来读写数据</span></li></ul></li></ol><h3 id='3-引导过程详细描述'><span>3. 引导过程详细描述：</span></h3><ol start='' ><li><p><strong><span>开机</span></strong><span>：</span></p><ul><li><span>用户打开计算机电源。</span></li></ul></li><li><p><strong><span>POST</span></strong><span>：</span></p><ul><li><span>计算机执行POST检查硬件。</span></li></ul></li><li><p><strong><span>BIOS执行</span></strong><span>：</span></p><ul><li><span>BIOS执行，初始化硬件，并按照CMOS设置中的引导顺序查找引导设备。</span></li></ul></li><li><p><strong><span>读取MBR</span></strong><span>：</span></p><ul><li><span>BIOS从引导设备的第一个扇区（MBR）读取引导记录。</span></li></ul></li><li><p><strong><span>执行引导加载器</span></strong><span>：</span></p><ul><li><span>MBR中的引导加载器代码被执行，它负责加载操作系统的内核。</span></li></ul></li><li><p><strong><span>加载内核</span></strong><span>：</span></p><ul><li><span>引导加载器将操作系统的内核加载到内存。</span></li></ul></li><li><p><strong><span>内核初始化</span></strong><span>：</span></p><ul><li><span>内核开始执行，初始化硬件和设备驱动程序。</span></li></ul></li><li><p><strong><span>启动操作系统</span></strong><span>：</span></p><ul><li><span>内核完成初始化后，操作系统完全接管计算机，启动完成。</span></li></ul></li></ol><h2 id='18-虚拟机'><span>1.8 虚拟机</span></h2><ul><li><p><span>定义：使用虚拟化技术，将一台物理机器虚拟化为多肽虚拟机器（Virtual Machine, VM），每个虚拟机器都可以独立运行一个操作系统。</span></p></li><li><p><span>同义术语：虚拟机管理程序，虚拟机监控程序。</span></p></li><li><p><span>第一类虚拟机</span><img src="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20241023185730603.png" alt="image-20241023185730603" style="zoom:50%;" /></p><ul><li><span>对于物理资源的控制权：直接运行在硬件之上，能直接控制和分配物理资源。</span></li><li><span>资源分配方式：在安装Guest OS时，VMM要在原本的硬盘上行分配存储空间，类似于“外核”的分配方式，分配未经抽象的物理硬件。</span></li><li><span>性能：性能更好</span></li><li><span>可支持的虚拟机数量：更多，不需要和Host OS竞争资源，相同的硬件资源可以支持更多的虚拟机</span></li><li><span>虚拟机的可迁移性：更差</span></li><li><span>运行模式：第一类VMM运行在最高特权级（Ring 0），可以执行最高特权的指令。</span></li></ul></li><li><p><span>第二类虚拟机</span><img src="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20241023185827054.png" alt="image-20241023185827054" style="zoom:50%;" /></p><p>&nbsp;</p><ul><li><span>对于物理资源的控制权：运行在Host OS之上，依赖于Host OS为其分配物理资源</span></li><li><span>资源分配方式：GuestOS拥有自己的虚拟硬盘，该硬盘实际上时Host OS文件系统中的一个大文件。GuestOS分配到的内存时虚拟内存。</span></li><li><span>性能：性能更差，需要HostOS作为“中介”</span></li><li><span>可支持的虚拟机数量：更少，Host OS本身需要使用物理资源，Host OS上运行的其他进程也需要物理资源。</span></li><li><span>虚拟机的可迁移性：更好，只需要导出虚拟机镜像文件即可迁移到另一台HostOS上，商业化应用更广泛。</span></li><li><span>运行模式：第二类VMM部分运行在用户态，部分运行在内核态。GuestOS发出的系统调用会被VMM截获，并转化为VMM对HostOS的系统调用。</span></li></ul></li></ul><p>&nbsp;</p><h1 id='第二章进程'><span>第二章进程</span></h1><h2 id='21-概念组成特征'><span>2.1 概念，组成，特征</span></h2><h3 id='1进程的概念'><span>1.进程的概念</span></h3><p><span>进程可以被理解为程序的一次执行过程。在操作系统中，它是资源分配和调度的基本单位。每个进程都拥有独立的虚拟地址空间、执行堆栈、程序计数器等，能够确保程序在多任务环境中稳定运行。</span></p><ul><li><span>程序：是静态的，就是个存放在磁盘里的可执行文件，就是一系列的指令集合。</span></li><li><span>进程（Process）：是动态的，是程序的一次执行过程。</span></li></ul><h3 id='2进程的组成'><span>2.进程的组成</span></h3><p><span>一个进程通常由以下几部分组成：</span></p><ol start='' ><li><p><strong><span>程序代码</span></strong><span>：程序执行所需的指令集合。</span></p></li><li><p><strong><span>数据集合</span></strong><span>：程序在执行过程中需要处理的数据。</span></p></li><li><p><strong><span>进程控制块（PCB，Process Control Block）</span></strong><span>：包含进程的描述信息和控制信息，是进程存在的唯一标志。</span></p><ol start='' ><li><span>操作系统要记录PID，进程所属用户ID（UID），（当进程被创建时，操作系统会为改进程分配一个唯一的，不重复的“身份证号”--PID（Process ID，进程ID）。</span></li><li><span>记录给进程分配了，那些资源（分配了多少内存，正在使用那些I/O设备，正在使用那些文件）。</span></li><li><span>记录进程的运行情况（CPU使用时间，磁盘使用情况，网络流量使用情况等）。</span></li></ol></li><li><p><strong><span>栈空间</span></strong><span>：用于存放函数调用时的局部变量、返回地址等。</span></p></li><li><p><strong><span>堆空间</span></strong><span>：用于动态分配的内存空间。</span></p></li></ol><h3 id='3进程的特征'><span>3.进程的特征</span></h3><ol start='' ><li><strong><span>动态性</span></strong><span>：进程的实质是程序在多道程序系统中的一次执行过程，它是动态产生、动态消亡的。</span></li><li><strong><span>并发性</span></strong><span>：多个进程可以在单个处理器上交替执行，也可以在多处理器系统上并行执行。</span></li><li><strong><span>独立性</span></strong><span>：每个进程都拥有自己的地址空间和执行状态，不会受到其他进程的直接影响。</span></li><li><strong><span>异步性</span></strong><span>：由于进程间的相互制约，每个进程的执行顺序和速度都是不可预测的。</span></li><li><strong><span>交互性</span></strong><span>：进程在执行过程中可能需要与其他进程进行通信和同步。</span></li><li><strong><span>结构性：</span></strong><span>每个进程都会配置PCB。结构上看，进程由程序段，数据段，PCB组成。</span></li></ol><p><span>操作系统通过进程管理，实现了对计算机系统中各种资源的有效调度和使用，从而提高了计算机系统的效率和用户满意度。</span></p><h2 id='22-进程的状态与转换'><span>2.2 进程的状态与转换</span></h2><h3 id='1进程的状态'><span>1.进程的状态</span></h3><p><span>进程在其生命周期中可以处于以下几种状态：</span></p><ol start='' ><li><strong><span>运行状态（Running）</span></strong><span>：进程正在处理器（CPU）上执行。</span></li><li><strong><span>就绪状态（Ready）</span></strong><span>：进程已具备运行条件，但由于处理器忙，暂时不能运行，等待系统调度。</span></li><li><strong><span>阻塞状态（Blocked）</span></strong><span>：进程因等待某个事件（如I/O操作完成、信号量、网络数据到达等）的发生而暂时停止运行。</span></li><li><strong><span>创建状态（New）</span></strong><span>：进程正在被创建，尚未进入就绪状态。（进程分配资源，初始化PCB）</span></li><li><strong><span>终止状态（Terminated）</span></strong><span>：进程执行完毕，等待系统回收其资源。</span></li></ol><h3 id='2状态间的转换'><span>2.状态间的转换</span></h3><p><span>以下是进程状态之间的一些常见转换：</span></p><ol start='' ><li><strong><span>就绪 -&gt; 运行</span></strong><span>：当处理器空闲时，操作系统调度器会选择一个就绪状态的进程来执行，使其进入运行状态。</span></li><li><strong><span>运行 -&gt; 就绪</span></strong><span>：在分时系统中，运行时间片到期的进程会被系统调度器暂停，状态转换为就绪；或者当有更高优先级的进程变为就绪状态时，当前运行的进程也会转换为就绪状态。</span></li><li><strong><span>运行 -&gt; 阻塞</span></strong><span>：当进程执行到某个操作需要等待（如等待I/O）时，它将从运行状态转换为阻塞状态。</span></li><li><strong><span>阻塞 -&gt; 就绪</span></strong><span>：当进程等待的事件发生（如I/O完成），它将从阻塞状态转换为就绪状态，等待调度器调度。</span></li></ol><h3 id='3进程的组织方式'><span>3.进程的组织方式</span></h3><p><span>进程控制块（PCB）是进程存在的唯一标志，操作系统通过PCB来管理和控制进程。以下是几种常见的进程组织方式：</span></p><ol start='' ><li><p><strong><span>链表</span></strong><span>：操作系统可以维护一个或多个链表来组织PCB。例如，可以有一个就绪链表、一个阻塞链表和一个运行链表。</span></p><ul><li><strong><span>单链表</span></strong><span>：所有PCB都链接在一个链表中。</span></li><li><strong><span>双链表</span></strong><span>：每个PCB有两个指针，分别指向前一个和后一个PCB，便于双向遍历。</span></li><li><strong><span>索引表</span></strong><span>：结合链表和数组，使用数组索引来快速定位到不同的链表。</span></li></ul></li><li><p><strong><span>索引数组</span></strong><span>：使用数组来存储指向PCB的指针，通过索引可以快速访问任何一个进程的PCB。</span></p></li><li><p><strong><span>散列表（哈希表）</span></strong><span>：根据进程ID或其他关键字通过哈希函数计算得到散列地址，将PCB存储在散列表中，可以快速查找和访问。</span></p></li><li><p><strong><span>树结构</span></strong><span>：例如，可以使用树结构来表示进程的层次关系，如进程的父子关系。</span></p></li></ol><p><span>操作系统根据具体的实现和需求选择最合适的组织方式，以优化进程的创建、终止、调度和同步等操作的性能。</span></p><h2 id='23-进程控制'><span>2.3 进程控制</span></h2><h3 id='1进程控制的基本概念'><span>1.进程控制的基本概念</span></h3><p><strong><span>什么是进程控制：</span></strong><span> 进程控制是指操作系统对进程的创建、调度、同步、通信和终止等活动的管理。进程控制确保了进程能够正确、高效地在系统中执行，并且能够合理地使用系统资源。</span></p><p><strong><span>如何实现进程控制：</span></strong><span> 进程控制主要通过以下几个步骤实现：</span></p><ol start='' ><li><strong><span>进程控制块（PCB）</span></strong><span>：操作系统为每个进程创建一个PCB，用于存储进程的状态信息、控制信息和管理信息。</span></li><li><strong><span>进程状态转换</span></strong><span>：操作系统通过状态转换机制来控制进程的执行流程。</span></li><li><strong><span>进程调度</span></strong><span>：操作系统根据一定的调度算法，从就绪队列中选择一个进程来执行。</span></li><li><strong><span>同步与通信</span></strong><span>：操作系统提供同步机制（如信号量、互斥量）和通信机制（如消息队列、共享内存）来控制进程间的协作。</span></li></ol><h3 id='2进程控制相关的原语'><span>2.进程控制相关的原语</span></h3><p><span>进程控制原语是操作系统提供的一组原子操作，用于实现进程控制。这些</span><strong><span>原语在执行过程中不会被中断</span></strong><span>，保证了操作的完整性和正确性。以下是常见的进程控制原语：</span></p><ul><li><strong><span>通过关中断和开中断指令实现，一般没执行完条指令都会检查是否有中断信号，但是关中断以后不在检查中断信号，开中断以后才会继续检查。</span></strong></li><li><strong><span>关开中断指令是特权指令只有内核可以调用。</span></strong></li></ul><ol start='' ><li><p><strong><span>创建原语（Create）</span></strong><span>：</span></p><ul><li><strong><span>功能</span></strong><span>：创建一个新的进程。（用户登录，作业调度，提供服务，应用请求。）</span></li><li><strong><span>实现</span></strong><span>：分配一个新的PCB，初始化PCB，将新进程置为就绪状态或运行状态。</span></li></ul></li><li><p><strong><span>终止原语（Terminate）</span></strong><span>：</span></p><ul><li><strong><span>功能</span></strong><span>：结束一个进程的执行。</span></li><li><strong><span>实现</span></strong><span>：回收进程所占用的资源，释放PCB，更新系统状态。</span></li></ul></li><li><p><strong><span>阻塞原语（Block）</span></strong><span>：</span></p><ul><li><strong><span>功能</span></strong><span>：将正在运行的进程转变为阻塞状态。</span></li><li><strong><span>实现</span></strong><span>：保存当前进程的状态，将其从运行状态转换为阻塞状态，调度另一个进程运行。</span></li></ul></li><li><p><strong><span>唤醒原语（Wake Up）</span></strong><span>：</span></p><ul><li><strong><span>功能</span></strong><span>：将阻塞状态的进程唤醒，转变为就绪状态。</span></li><li><strong><span>实现</span></strong><span>：将进程从阻塞队列移至就绪队列，等待调度器调度。</span></li></ul></li><li><p><strong><span>切换原语（Switch）</span></strong><span>：</span></p><ul><li><strong><span>功能</span></strong><span>：在处理器上从一个进程切换到另一个进程。</span></li><li><strong><span>实现</span></strong><span>：保存当前进程的上下文（如程序计数器、寄存器等），加载新进程的上下文，并开始执行新进程。</span></li></ul></li><li><p><strong><span>撤销原语（Abort）：</span></strong></p><ul><li><strong><span>功能：</span></strong><span>终止一个进程的执行。回收进程所占用的资源，包括内存、打开的文件、网络连接等。从系统的进程表中移除该进程的进程控制块（PCB）。如果有必要，通知父进程或其他相关进程关于被终止进程的状态。</span></li><li><strong><span>实现：</span></strong><span>保存上下文，资源回收（内存回收：释放进程所占用的内存空间。文件关闭：关闭进程打开的所有文件。设备释放：释放进程所占用的设备资源。网络资源释放：断开进程的所有网络连接。）更新进程表：从进程表中移除被撤销进程的PCB。通知相关进程：如果系统支持进程间通信，可能需要通知父进程或其他相关进程该进程已被撤销。调度决策：如果被撤销的进程是正在运行的进程，操作系统需要调度另一个进程来运行。</span></li></ul></li></ol><p><span>这些原语通常由操作系统的内核提供，并且它们的执行是受到保护的，以确保系统的一致性和稳定性。在多任务操作系统中，进程控制原语是管理进程执行的基础。</span></p><h2 id='24-进程通信'><span>2.4 进程通信</span></h2><h3 id='1共享存储'><span>1.共享存储</span></h3><p><span>共享存储是进程通信的一种方式，分为两种基本形式：</span></p><ol start='' ><li><p><strong><span>基于数据结构的共享</span></strong><span>：</span></p><ul><li><span>允许多个进程共享特定的数据结构，如数组、列表、树等。</span></li><li><span>为了同步对共享数据结构的访问，通常需要使用同步原语，如互斥锁（mutexes）、信号量（semaphores）等。</span></li><li><span>这种方式要求共享的数据结构在设计时就要考虑并发访问的问题。</span></li></ul></li><li><p><strong><span>基于存储区的共享</span></strong><span>：</span></p><ul><li><span>提供一个共享的存储区域，如共享内存页面，供多个进程读写。</span></li><li><span>进程可以通过映射同一块物理内存到它们的虚拟地址空间来实现共享。</span></li><li><span>同样需要同步机制来防止竞态条件。</span></li></ul></li></ol><h3 id='2消息传递'><span>2.消息传递</span></h3><p><span>消息传递是另一种进程通信方式，分为直接通信方式和间接通信方式：</span></p><ul><li><span>进程间的数据交换以格式化的消息（Message）为单位。进程通过操作系统提供的：”发送消息/接收消息“两个原语进行数据交换。</span></li></ul><ol start='' ><li><p><strong><span>直接通信方式</span></strong><span>：</span></p><ul><li><span>进程通过发送和接收消息直接与另一个进程通信。</span></li><li><span>操作系统提供发送（send）和接收（receive）原语。</span></li><li><span>常见的通信模式包括同步通信（发送方阻塞直到接收方接收消息）和异步通信（发送方发送后立即继续执行）。</span></li></ul></li><li><p><strong><span>间接通信方式</span></strong><span>：</span></p><ul><li><span>进程通过一个中间实体（如消息队列）进行通信。</span></li><li><span>任何进程都可以向队列发送消息，也可以从队列接收消息。</span></li><li><span>消息队列充当了消息的暂存区，允许发送方和接收方不必同时活跃。</span></li></ul></li></ol><h3 id='3管道通信'><span>3.管道通信</span></h3><p><span>管道是用于连接两个进程之间的一个单向数据流，通常用于父子进程间的通信：</span></p><ul><li><p><strong><span>无名管道</span></strong><span>：</span></p><ul><li><span>只能在具有亲缘关系的进程之间进行通信。</span></li><li><span>数据在管道中的流动是先进先出的。</span></li><li><span>一旦数据被读出，它就从管道中被抛弃，无法再次读取。</span></li></ul></li><li><p><strong><span>有名管道（FIFO）</span></strong><span>：</span></p><ul><li><span>可以在任意两个进程之间进行通信，只要它们知道对方创建的管道名称。</span></li><li><span>FIFO在文件系统中作为特殊文件存在，即使没有亲缘关系的进程也可以通过它进行通信。</span></li></ul></li><li><p><span>注意点</span></p><ul><li><span>管道只能采用半双工通信，某一段时间段内只能实现单向的传输。如果要实现双向同时通信，则需要设置两个管道。</span></li><li><span>各进程要互斥地访问管道（由操作系统实现）</span></li><li><span>当管道写满时，写进程将阻塞，直到读进程将管道中的数据取走，即可唤醒写进程。</span></li><li><span>当管道读空时，读进程将阻塞，直到写进程网管道中写入数据，即可唤醒读进程。</span></li><li><span>管道中的数据一旦被读出，久彻底消失。因此，当多个进程读同一个管道时，可能会错乱。对此，通常有俩种解决方案：（1）一个管道允许多个写进程，一个读进程；（2）允许有多个写进程，多个读进程，但系统会让各个读进程轮流从管道中读数据。</span></li></ul></li></ul><p><span>每种通信机制都有其适用场景和优缺点。共享存储通常用于需要快速通信的场合，但需要复杂的同步机制；消息传递提供了更清晰的接口，但可能比共享存储慢；管道通信是最简单的方式，但它的通信范围和灵活性相对有限。操作系统通常提供了这些机制的不同实现，以便开发者根据具体需求选择合适的通信方式。</span></p><h1 id='第三章-线程'><span>第三章 线程</span></h1><h2 id='31-线程的基本概念'><span>3.1 线程的基本概念</span></h2><h3 id='1什么是线程为什么要引入线程'><span>1.什么是线程？为什么要引入线程？</span></h3><p><span>线程是操作系统能够进行运算调度的最小单位，它被包含在进程之中，是进程中的实际运作单位。引入线程的原因包括：</span></p><ol start='' ><li><strong><span>提高并发性</span></strong><span>：线程可以独立执行，使得一个程序可以同时执行多个任务，提高程序的并发性能。</span></li><li><strong><span>资源共享</span></strong><span>：同一进程内的线程共享进程的资源，如内存和文件描述符，这减少了资源管理的开销。</span></li><li><strong><span>响应性</span></strong><span>：线程的创建、切换和销毁比进程更快，可以提供更快的响应时间。</span></li><li><strong><span>简化编程模型</span></strong><span>：线程简化了并发编程的模型，使得程序设计更加模块化。</span></li></ol><h3 id='2引入线程机制后有什么变化'><span>2.引入线程机制后，有什么变化？</span></h3><ol start='' ><li><strong><span>资源管理</span></strong><span>：线程共享进程资源，减少了资源分配和管理的复杂性。</span></li><li><strong><span>调度</span></strong><span>：线程的调度通常比进程调度更加频繁，操作系统需要更高效的调度算法。</span></li><li><strong><span>同步</span></strong><span>：线程间的同步和通信机制需要更加精细，以避免竞态条件和死锁。</span></li><li><strong><span>上下文切换</span></strong><span>：线程的上下文切换比进程的上下文切换开销小。</span></li><li><strong><span>调度单位：</span></strong><span>线程是一个基本的CPU执行单元，也是程序执行流的最小单位。进程只作为除CPU之外的系统资源的分配单位。（如打印机，内存地址空间等）</span></li></ol><h3 id='3线程有哪些重要的属性'><span>3.线程有哪些重要的属性？</span></h3><ol start='' ><li><strong><span>线程ID</span></strong><span>：唯一标识一个线程。</span></li><li><strong><span>程序计数器</span></strong><span>：记录下一条要执行的指令。</span></li><li><strong><span>寄存器集合</span></strong><span>：保存线程的当前工作状态。</span></li><li><strong><span>堆栈</span></strong><span>：用于存放局部变量和执行函数调用。</span></li><li><strong><span>状态</span></strong><span>：线程可以处于不同的状态，如新建、就绪、运行、阻塞、终止等。</span></li></ol><h2 id='32-线程的实现方式和多线程模型'><span>3.2 线程的实现方式和多线程模型</span></h2><h3 id='1线程的实现方式'><span>1.线程的实现方式</span></h3><ol start='' ><li><p><strong><span>用户级线程（User-Level Threads，ULTs）</span></strong><span>：</span></p><ul><li><span>由用户空间的线程库管理，不依赖于操作系统的内核。</span></li><li><span>调度算法由线程库实现。</span></li><li><span>上下文切换快，不涉及内核态与用户态的切换。</span></li></ul></li><li><p><strong><span>内核级线程（Kernel-Level Threads，KLTs）</span></strong><span>：</span></p><ul><li><span>由操作系统内核管理。</span></li><li><span>调度由操作系统负责。</span></li><li><span>可以利用多处理器，但上下文切换开销较大。</span></li></ul></li></ol><h3 id='2多线程模型'><span>2.多线程模型</span></h3><ol start='' ><li><p><strong><span>多对一模型（Many-to-One）</span></strong><span>：</span></p><ul><li><span>多个用户级线程映射到一个内核级线程。</span></li><li><span>优点是线程管理简单，上下文切换快。</span></li><li><span>缺点是如果一个线程执行系统调用阻塞，整个进程都会被阻塞。</span></li></ul></li><li><p><strong><span>一对一模型（One-to-One）</span></strong><span>：</span></p><ul><li><span>每个用户级线程映射到一个内核级线程。</span></li><li><span>可以利用多处理器，一个线程的阻塞不会影响其他线程。</span></li><li><span>缺点是创建和管理的开销大。</span></li></ul></li><li><p><strong><span>多对多模型（Many-to-Many）</span></strong><span>：</span></p><ul><li><span>多个用户级线程映射到多个内核级线程。</span></li><li><span>结合了多对一和一对一的优点，提供了更好的并发性和响应性。</span></li><li><span>管理复杂，需要线程库和内核之间良好的协作。</span></li></ul></li></ol><p><span>线程和多线程模型的选择取决于应用程序的需求、目标平台和操作系统的支持。</span></p><h2 id='33-线程的状态与转换'><span>3.3 线程的状态与转换</span></h2><h3 id='线程的状态与转换'><span>线程的状态与转换</span></h3><p><span>线程在其生命周期内可以处于以下几种状态，并且可以在一定条件下相互转换：</span></p><ol start='' ><li><p><strong><span>新建（New）</span></strong><span>：</span></p><ul><li><span>状态描述：当使用 new 关键字创建一个线程后，直到调用 start() 方法之前，线程处于新建状态。</span></li><li><span>转换条件：调用 start() 方法。</span></li></ul></li><li><p><strong><span>就绪（Runnable）</span></strong><span>：</span></p><ul><li><span>状态描述：线程调用 start() 方法后，进入就绪状态。就绪状态的线程位于可运行池中，等待被线程调度器选中获取CPU的执行时间。</span></li><li><span>转换条件：线程调度器选中该线程。</span></li></ul></li><li><p><strong><span>运行（Running）</span></strong><span>：</span></p><ul><li><span>状态描述：线程获得CPU时间，执行程序代码。</span></li><li><span>转换条件：时间片用完；更高优先级的线程需要运行；线程自己调用 yield() 方法；线程被调度器终止。</span></li></ul></li><li><p><strong><span>阻塞（Blocked）</span></strong><span>：</span></p><ul><li><span>状态描述：线程因为某些原因放弃CPU，暂时停止运行。阻塞状态是线程阻塞在进入同步代码块/方法或等待某个条件发生。</span></li><li><span>转换条件：获取锁；等待的条件成立。</span></li></ul></li><li><p><strong><span>等待（Waiting）</span></strong><span>：</span></p><ul><li><span>状态描述：线程等待其他线程执行特定操作（通知）。</span></li><li><span>转换条件：其他线程发出通知。</span></li></ul></li><li><p><strong><span>超时等待（Timed Waiting）</span></strong><span>：</span></p><ul><li><span>状态描述：线程在一定时间内等待另一个线程的通知。</span></li><li><span>转换条件：时间到达；其他线程发出通知。</span></li></ul></li><li><p><strong><span>终止（Terminated）</span></strong><span>：</span></p><ul><li><span>状态描述：线程的 run() 方法执行完成，或者线程调用了 stop() 方法，或者因为一个未捕获的异常导致线程终止。</span></li><li><span>转换条件：线程执行结束。</span></li></ul></li></ol><h3 id='线程的组织与控制'><span>线程的组织与控制</span></h3><p><span>线程的组织与控制主要涉及以下几个方面：</span></p><ul><li><p><span>线程控制块（TCP）：</span></p><ul><li><span>线程标识符：TID</span></li><li><span>程序计数器PC：线程目前执行到哪里</span></li><li><span>其他寄存器：线程运行的中间结果</span></li><li><span>堆栈指针：堆栈保存函数调用信息，局部变量等</span></li><li><span>线程运行状态：运行/就绪/阻塞</span></li><li><span>优先级：线程调度，资源分配参考</span></li></ul></li></ul><ol start='' ><li><p><strong><span>线程的创建</span></strong><span>：</span></p><ul><li><span>继承 Thread 类并重写 run() 方法。</span></li><li><span>实现 Runnable 接口的 run() 方法。</span></li><li><span>使用 Executor 框架创建线程池。</span></li></ul></li><li><p><strong><span>线程的调度</span></strong><span>：</span></p><ul><li><span>分时调度：所有线程轮流使用 CPU 的使用权，平均分配每个线程占用 CPU 的时间。</span></li><li><span>抢占式调度：优先让优先级高的线程使用 CPU，如果线程的优先级相同，那么会随机选择一个，Java 默认采用抢占式调度。</span></li></ul></li><li><p><strong><span>线程的控制</span></strong><span>：</span></p><ul><li><strong><span>线程睡眠</span></strong><span>：Thread.sleep(long millis)，让线程暂停执行指定的时间。</span></li><li><strong><span>线程让步</span></strong><span>：Thread.yield()，暂停当前正在执行的线程对象，并执行其他线程。</span></li><li><strong><span>线程加入</span></strong><span>：join()，等待其他线程终止。</span></li><li><strong><span>线程中断</span></strong><span>：interrupt()，中断线程的阻塞状态。</span></li></ul></li><li><p><strong><span>线程同步</span></strong><span>：</span></p><ul><li><span>使用 synchronized 关键字实现同步方法或同步代码块。</span></li><li><span>使用 Lock 显示锁控制临界区。</span></li></ul></li><li><p><strong><span>线程通信</span></strong><span>：</span></p><ul><li><span>使用 Object 类的 wait()、notify()、notifyAll() 方法进行线程通信。</span></li></ul></li><li><p><strong><span>线程池管理</span></strong><span>：</span></p><ul><li><span>通过 Executors 工厂类创建不同类型的线程池。</span></li><li><span>使用 ThreadPoolExecutor 自定义线程池。</span></li></ul></li></ol><p><span>线程的正确使用和管理对于提高程序的性能和稳定性至关重要。在多线程编程中，需要注意线程安全、资源共享和合理利用系统资源。</span></p><h1 id='第四章调度'><span>第四章调度</span></h1><h2 id='41-调度的概念层次'><span>4.1 调度的概念、层次</span></h2><p><span>处理机调度（Processor Scheduling）是操作系统中的一个重要概念，它涉及到如何合理地分配CPU时间给各个进程，以提高系统资源利用率和系统吞吐量，同时确保进程的公平性和响应时间。处理机调度可以分为三个层次：高级调度（作业调度）、中级调度（内存调度）和低级调度（进程调度）。下面分别介绍这三个层次的基本概念以及它们之间的联系和对比。</span></p><h3 id='1高级调度作业调度）'><span>1.高级调度（作业调度）</span></h3><p><strong><span>基本概念：</span></strong><span> 作业调度是最高级别的调度，它发生在批处理系统中。作业调度的主要任务是决定哪些作业应该被加载到内存中，以便转换成进程进行执行。作业调度通常在作业进入系统时进行，并且只在作业之间进行。</span></p><p><strong><span>主要功能：</span></strong></p><ul><li><span>决定作业的执行顺序。</span></li><li><span>从外存调入内存。</span></li><li><span>作业的资源分配。</span></li></ul><h3 id='2中级调度内存调度）'><span>2.中级调度（内存调度）</span></h3><p><strong><span>基本概念：</span></strong><span> 中级调度，也称为内存调度，主要发生在具有虚拟内存的系统中。中级调度负责决定哪些进程应该被调入或调出内存，以便为其他进程腾出空间。</span></p><p><strong><span>主要功能：</span></strong></p><ul><li><span>管理内存中的进程数量。</span></li><li><span>通过挂起和唤醒进程来动态调整内存中的进程数量。</span></li><li><span>配合虚拟内存管理，提高内存利用率。</span></li></ul><h3 id='3低级调度进程调度）'><span>3.低级调度（进程调度）</span></h3><p><strong><span>基本概念：</span></strong><span> 低级调度，也称为进程调度，是最频繁发生的调度。它负责决定哪个就绪状态下的进程应该获得CPU并执行。</span></p><p><strong><span>主要功能：</span></strong></p><ul><li><span>决定进程的执行顺序。</span></li><li><span>进程的上下文切换。</span></li><li><span>进程的创建和终止。</span></li></ul><h3 id='4三层调度的联系'><span>4.三层调度的联系</span></h3><ol start='' ><li><strong><span>层次性：</span></strong><span> 高级调度、中级调度和低级调度构成了操作系统调度的层次结构，每个层次解决不同的问题，并且相互配合以提高系统效率。</span></li><li><strong><span>资源共享：</span></strong><span> 三个层次的调度共同管理CPU、内存等资源，确保资源的合理分配和有效利用。</span></li><li><strong><span>调度策略：</span></strong><span> 各层次调度策略的选择和实施需要相互协调，以确保整个系统的调度策略一致性和有效性。</span></li></ol><h3 id='5三层调度的对比'><span>5.三层调度的对比</span></h3><ol start='' ><li><strong><span>调度频率：</span></strong><span> 低级调度最频繁，中级调度次之，高级调度频率最低。</span></li><li><strong><span>调度范围：</span></strong><span> 高级调度涉及作业，中级调度涉及进程，低级调度涉及进程的具体执行。</span></li><li><strong><span>调度目的：</span></strong><span> 高级调度主要为了提高作业吞吐量，中级调度为了提高内存利用率，低级调度为了提高CPU利用率。</span></li><li><strong><span>调度开销：</span></strong><span> 高级调度和中级调度的开销相对较大，因为它们涉及到作业或进程的调入调出，而低级调度开销较小，主要涉及上下文切换。</span></li><li><strong><span>调度时间：</span></strong><span> 高级调度和中级调度的决策时间较长，因为它们需要更多的信息来做出决策，而低级调度的决策时间较短。</span></li></ol><p><span>通过这三个层次的调度，操作系统能够更有效地管理资源，提高系统性能，满足不同用户和应用的需求。</span></p><h3 id='6进程的挂起状态'><span>6.进程的挂起状态</span></h3><p><span>进程的挂起状态是指进程暂时被调到外存等待的状态，这种状态可以进一步细分为就绪挂起和阻塞挂起两种状态。挂起状态的引入，使得传统的五状态模型扩展为七状态模型，更细致地描述了进程在操作系统中的各种状态和转换。</span></p><h3 id='7进程的七状态模型'><span>7.进程的七状态模型</span></h3><p><span>在七状态模型中，除了传统的五种状态（新建态、就绪态、运行态、阻塞态、终止态）之外，还包括了两种挂起状态：</span></p><ol start='' ><li><strong><span>挂起就绪态（Ready Suspend）</span></strong><span>：进程具备运行条件，但目前在外存中，只有当它被对换到内存时才能被调度执行。</span></li><li><strong><span>挂起等待态（挂起阻塞态）（Blocked Suspend）</span></strong><span>：进程正在等待某个事件发生且在外存中。</span></li></ol><h3 id='8引起进程状态转换的具体原因'><span>8.引起进程状态转换的具体原因</span></h3><ul><li><strong><span>等待态→挂起等待态</span></strong><span>：如果当前不存在就绪进程，那么至少有一个等待态进程将被对换出去成为挂起等待态。</span></li><li><strong><span>挂起等待态→挂起就绪态</span></strong><span>：引起进程等待的事件发生之后，相应的挂起等待态进程将转换为挂起就绪态。</span></li><li><strong><span>挂起就绪态→就绪态</span></strong><span>：当内存中没有就绪态进程，或者挂起就绪态进程具有比就绪态进程更高的优先级，系统将把挂起就绪态进程转换成就绪态。</span></li><li><strong><span>就绪态→挂起就绪态</span></strong><span>：操作系统根据当前资源状况和性能要求，也可以决定把就绪态进程对换出去成为挂起就绪态。</span></li><li><strong><span>挂起等待态→等待态</span></strong><span>：当一个进程退出后，主存已经有了一大块自由空间，而某个挂起等待态进程具有较高的优先级并且操作系统已经得知导致它阻塞的事件即将结束，此时便发生了这一状态变化。</span></li></ul><p><span>挂起状态的引入主要是为了优化系统资源的利用，特别是内存资源。当内存资源不足时，可以将一些暂时不需要执行的进程挂起，释放内存空间给其他进程使用。当这些进程需要继续执行时，再将它们从外存调回内存，并恢复到相应的状态。</span></p><h2 id='42-进程调度的时机进程的切换和过程方式'><span>4.2 进程调度的时机，进程的切换和过程，方式</span></h2><p><span>进程调度是操作系统中用于决定哪个进程获得CPU时间的过程。以下是关于进程调度的时机、进程的切换和过程以及调度方式的详细说明：</span></p><h3 id='1进程调度的时机'><span>1.进程调度的时机</span></h3><ol start='' ><li><strong><span>进程执行完毕</span></strong><span>：当一个进程执行完毕或因错误而结束时，需要调度其他进程运行。</span></li><li><strong><span>进程请求等待</span></strong><span>：进程可能需要等待I/O操作或同步事件，这时会放弃CPU，调度其他进程。</span></li><li><strong><span>进程优先级改变</span></strong><span>：当进程的优先级改变时，可能会触发调度。</span></li><li><strong><span>时间片用尽</span></strong><span>：在时间片轮转调度算法中，进程使用完其分配的时间片后，将CPU让给其他进程。</span></li><li><strong><span>I/O中断</span></strong><span>：硬件I/O操作完成时，可能会触发调度器选择新进程运行。</span></li><li><strong><span>系统调用</span></strong><span>：进程执行系统调用后可能会离开CPU，调度器将选择其他进程运行。</span></li></ol><h3 id='2进程的切换和过程'><span>2.进程的切换和过程</span></h3><p><span>进程切换（上下文切换）涉及保存当前进程的状态（上下文），并加载下一个要执行进程的状态。这个过程通常包括以下步骤：</span></p><ol start='' ><li><strong><span>保存当前进程的上下文</span></strong><span>：这包括寄存器值、程序计数器、状态寄存器等。</span></li><li><strong><span>更新进程控制块（PCB）</span></strong><span>：将当前进程的状态信息更新到其PCB中。</span></li><li><strong><span>选择下一个进程</span></strong><span>：根据调度算法选择下一个要运行的进程。</span></li><li><strong><span>加载下一个进程的上下文</span></strong><span>：将所选进程的上下文从其PCB加载到寄存器中。</span></li><li><strong><span>跳转到新进程的代码</span></strong><span>：更新程序计数器，开始执行新进程的指令。</span></li></ol><h3 id='3进程调度的方式'><span>3.进程调度的方式</span></h3><ol start='' ><li><p><strong><span>非抢占式调度</span></strong><span>：也称为协作式调度，当前进程必须主动放弃CPU，如执行完毕或等待I/O。</span></p><ul><li><strong><span>先来先服务（FCFS）</span></strong><span>：按照请求CPU的顺序调度进程。</span></li><li><strong><span>短作业优先（SJF）</span></strong><span>：优先调度预计运行时间最短的进程。</span></li></ul></li><li><p><strong><span>抢占式调度</span></strong><span>：调度器可以强制暂停当前进程，将CPU分配给更高优先级的进程。</span></p><ul><li><strong><span>优先级调度</span></strong><span>：每个进程都有一个优先级，调度器根据优先级来分配CPU。</span></li><li><strong><span>时间片轮转（Round Robin, RR）</span></strong><span>：每个进程分配一个时间片，轮流执行。</span></li><li><strong><span>多级反馈队列（Multilevel Feedback Queue, MFQ）</span></strong><span>：结合了优先级和时间片轮转，具有多个队列，根据进程的行为动态调整优先级。</span></li></ul></li></ol><p><span>操作系统的进程调度策略是多样化的，不同的调度算法适用于不同的场景和需求。调度策略的选择直接影响到系统的性能，包括响应时间、吞吐量和CPU利用率。在设计调度策略时，还需要考虑公平性、系统的稳定性和实现的复杂性。 </span></p><h2 id='43-调度器和闲逛进程'><span>4.3 调度器和闲逛进程</span></h2><h3 id='1调度器'><span>1.调度器</span></h3><p><span>调度器的主要职责是确保CPU始终在执行有用的任务，并尽可能地提高系统的整体性能。调度器的工作可以细分为以下几个部分：</span></p><ol start='' ><li><strong><span>选择策略</span></strong><span>：调度器根据预定的策略来选择下一个要运行的进程。这些策略可能包括先来先服务（FCFS）、短作业优先（SJF）、优先级调度、时间片轮转（RR）或多级反馈队列（MFQ）等。</span></li><li><strong><span>上下文切换</span></strong><span>：当调度器决定运行另一个进程时，它会执行上下文切换，保存当前进程的状态并加载新进程的状态。</span></li><li><strong><span>资源分配</span></strong><span>：调度器不仅要分配CPU时间，还可能涉及内存、I/O设备等其他资源的分配。</span></li><li><strong><span>性能优化</span></strong><span>：调度器尝试最大化系统的吞吐量、响应时间、CPU利用率和公平性。</span></li></ol><h3 id='2闲逛进程'><span>2.闲逛进程</span></h3><p><span>闲逛进程（Idle Process）是一个特殊的系统进程，其行为如下：</span></p><ol start='' ><li><strong><span>低优先级</span></strong><span>：闲逛进程通常具有最低的优先级，这样在系统中存在其他可运行的进程时，它们会优先获得CPU时间。</span></li><li><strong><span>系统空闲时运行</span></strong><span>：当没有其他进程需要CPU资源时，调度器将选择闲逛进程运行。这保证了CPU不会无所事事，同时也提供了一个默认的执行路径。</span></li><li><strong><span>节能模式</span></strong><span>：在闲逛进程运行期间，CPU可能会进入一种节能模式，降低功耗，因为此时没有用户进程需要处理。</span></li><li><strong><span>执行指令</span></strong><span>：闲逛进程通常执行一些简单的循环指令或者直接进入休眠状态，这些操作几乎不消耗系统资源。</span></li><li><strong><span>触发调度</span></strong><span>：当新的进程变为可运行状态时，闲逛进程会被抢占，新的进程将获得CPU时间。</span></li></ol><p><span>闲逛进程的存在对于操作系统来说是非常重要的，因为它确保了CPU不会执行无意义的操作，并且在系统空闲时，调度器可以随时响应新的任务。在多核系统中，每个CPU核心可能都有自己的闲逛进程。</span></p><p><span>总结来说，调度器和闲逛进程都是操作系统中的重要组件，它们共同确保了系统的稳定运行和资源的高效利用。</span></p><h2 id='44-调度算法的性能评价'><span>4.4 调度算法的性能评价</span></h2><p><span>下面是对调度算法性能指标的详细解释，包括CPU利用率、系统吞吐量、周转时间（及其变体）、等待时间和响应时间的定义和计算方法。</span></p><h3 id='1cpu利用率'><span>1.CPU利用率</span></h3><ul><li><strong><span>定义</span></strong><span>：CPU利用率是指CPU在一段时间内执行进程的时间占总时间的比例。</span></li><li><strong><span>计算</span></strong><span>：CPU利用率 = (CPU执行时间 / 总时间) * 100%</span></li></ul><h3 id='2系统吞吐量'><span>2.系统吞吐量</span></h3><ul><li><strong><span>定义</span></strong><span>：系统吞吐量是指在单位时间内系统完成的进程数量。</span></li><li><strong><span>计算</span></strong><span>：系统吞吐量 = 完成的进程数 / 总时间</span></li></ul><h3 id='3周转时间'><span>3.周转时间</span></h3><ul><li><p><span>周转时间：</span></p><ul><li><strong><span>定义</span></strong><span>：从进程到达系统到进程完成所经过的时间。</span></li><li><strong><span>计算</span></strong><span>：周转时间 = 完成时间 - 到达时间</span></li></ul></li><li><p><span>平均周转时间：</span></p><ul><li><strong><span>定义</span></strong><span>：所有进程的周转时间之和除以进程数量。</span></li><li><strong><span>计算</span></strong><span>：平均周转时间 = (周转时间1 + 周转时间2 + … + 周转时间n) / 进程数</span></li></ul></li><li><p><span>带权周转时间：</span></p><ul><li><strong><span>定义</span></strong><span>：周转时间与实际运行时间的比率，用于考虑进程的实际运行时间。</span></li><li><strong><span>计算</span></strong><span>：带权周转时间 = 周转时间 / 运行时间</span></li></ul></li><li><p><span>平均带权周转时间：</span></p><ul><li><strong><span>定义</span></strong><span>：所有进程的带权周转时间之和除以进程数量。</span></li><li><strong><span>计算</span></strong><span>：平均带权周转时间 = (带权周转时间1 + 带权周转时间2 + … + 带权周转时间n) / 进程数</span></li></ul></li></ul><h3 id='4等待时间'><span>4.等待时间</span></h3><ul><li><strong><span>定义</span></strong><span>：等待时间是指进程在就绪队列中等待执行的时间总和。</span></li><li><strong><span>计算</span></strong><span>：等待时间 = 周转时间 - 运行时间</span></li></ul><h3 id='5响应时间'><span>5.响应时间</span></h3><ul><li><strong><span>定义</span></strong><span>：响应时间是指从提交请求到系统首次产生响应的时间。</span></li><li><strong><span>计算</span></strong><span>：响应时间 = 首次响应时间 - 请求提交时间</span></li></ul><p><span>在不同的调度算法中，这些指标的表现会有所不同：</span></p><ul><li><p><strong><span>先来先服务（FCFS）</span></strong><span>：</span></p><ul><li><span>CPU利用率：通常较高</span></li><li><span>系统吞吐量：中等</span></li><li><span>周转时间：可能较长，取决于作业到达顺序</span></li><li><span>平均周转时间：取决于作业到达顺序</span></li><li><span>带权周转时间：可能较高，特别是对于短作业</span></li><li><span>平均带权周转时间：可能较高</span></li><li><span>等待时间：可能较长，存在“饥饿”现象</span></li><li><span>响应时间：取决于请求到达的顺序</span></li></ul></li><li><p><strong><span>短作业优先（SJF）</span></strong><span>：</span></p><ul><li><span>CPU利用率：通常较高</span></li><li><span>系统吞吐量：较高</span></li><li><span>周转时间：较短</span></li><li><span>平均周转时间：较短</span></li><li><span>带权周转时间：较低</span></li><li><span>平均带权周转时间：较低</span></li><li><span>等待时间：较短</span></li><li><span>响应时间：可能较长，特别是对于长作业</span></li></ul></li><li><p><strong><span>优先级调度</span></strong><span>：</span></p><ul><li><span>CPU利用率：通常较高</span></li><li><span>系统吞吐量：取决于优先级分配</span></li><li><span>周转时间：取决于优先级</span></li><li><span>平均周转时间：取决于优先级</span></li><li><span>带权周转时间：取决于优先级</span></li><li><span>平均带权周转时间：取决于优先级</span></li><li><span>等待时间：可能较长，低优先级作业可能长时间等待</span></li><li><span>响应时间：取决于优先级</span></li></ul></li><li><p><strong><span>时间片轮转（RR）</span></strong><span>：</span></p><ul><li><span>CPU利用率：通常较高</span></li><li><span>系统吞吐量：较高</span></li><li><span>周转时间：中等</span></li><li><span>平均周转时间：中等</span></li><li><span>带权周转时间：中等</span></li><li><span>平均带权周转时间：中等</span></li><li><span>等待时间：较短</span></li><li><span>响应时间：较短，适合交互式系统</span></li></ul></li><li><p><strong><span>多级反馈队列（MFQ）</span></strong><span>：</span></p><ul><li><span>CPU利用率：通常较高</span></li><li><span>系统吞吐量：较高</span></li><li><span>周转时间：中等</span></li><li><span>平均周转时间：中等</span></li><li><span>带权周转时间：较低</span></li><li><span>平均带权周转时间：较低</span></li><li><span>等待时间：较短</span></li><li><span>响应时间：较短，适合各种类型的作业</span></li></ul></li></ul><p><span>调度算法的选择应该基于系统的特定需求和目标，不同的应用场景可能需要不同的性能权衡。</span></p><h2 id='45-调度算法1）'><span>4.5 调度算法（1）</span></h2><h3 id='1先来先服务fcfs）'><span>1.先来先服务（FCFS）</span></h3><ul><li><p><strong><span>基本原理</span></strong><span>：按照作业到达的顺序进行调度，先到的作业先执行。</span></p></li><li><p><strong><span>特点</span></strong><span>：</span></p><ul><li><span>简单易实现。</span></li><li><span>公平，因为每个作业都会按照到达顺序得到服务。</span></li></ul></li><li><p><strong><span>性能分析</span></strong><span>：</span></p><ul><li><strong><span>CPU利用率</span></strong><span>：较高，尤其是在作业连续到达时。</span></li><li><strong><span>系统吞吐量</span></strong><span>：中等，因为可能会因为长作业阻塞短作业。</span></li><li><strong><span>周转时间</span></strong><span>：可能较长，特别是如果长作业先到达。</span></li><li><strong><span>平均周转时间</span></strong><span>：取决于作业到达的顺序和作业长度。</span></li><li><strong><span>等待时间</span></strong><span>：可能较长，特别是短作业跟随长作业时。</span></li><li><strong><span>响应时间</span></strong><span>：与作业到达顺序一致。</span></li></ul></li><li><p><strong><span>缺点</span></strong><span>：存在“饥饿”现象，即短作业可能需要等待很长时间才能执行（称为“凸现”问题）。</span></p></li></ul><h3 id='2短作业优先sjf）'><span>2.短作业优先（SJF）</span></h3><ul><li><p><strong><span>基本原理</span></strong><span>：优先调度预计运行时间最短的作业。</span></p></li><li><p><strong><span>特点</span></strong><span>：</span></p><ul><li><span>需要知道作业的运行时间。</span></li><li><span>可以是非抢占式的，也可以是抢占式的（称为SJF抢占式调度）。</span></li></ul></li><li><p><strong><span>性能分析</span></strong><span>：</span></p><ul><li><strong><span>CPU利用率</span></strong><span>：较高，因为减少了作业等待时间。</span></li><li><strong><span>系统吞吐量</span></strong><span>：较高，因为可以快速完成多个短作业。</span></li><li><strong><span>周转时间</span></strong><span>：较短，特别是对于短作业。</span></li><li><strong><span>平均周转时间</span></strong><span>：较短，因为优先执行短作业。</span></li><li><strong><span>等待时间</span></strong><span>：较短，因为作业通常不需要等待很久。</span></li><li><strong><span>响应时间</span></strong><span>：对于抢占式SJF，响应时间较短。</span></li></ul></li><li><p><strong><span>缺点</span></strong><span>：可能导致长作业饥饿，即如果不断有新的短作业到达，长作业可能永远无法执行。</span></p></li></ul><h3 id='3高响应比优先hrrn）'><span>3.高响应比优先（HRRN）</span></h3><ul><li><p><strong><span>基本原理</span></strong><span>：根据响应比来调度作业，响应比 = (等待时间 + 运行时间) / 运行时间。</span></p></li><li><p><strong><span>特点</span></strong><span>：</span></p><ul><li><span>结合了FCFS和SJF的优点，考虑了作业的等待时间。</span></li><li><span>随着等待时间的增加，作业的优先级提高。</span></li></ul></li><li><p><strong><span>性能分析</span></strong><span>：</span></p><ul><li><strong><span>CPU利用率</span></strong><span>：较高，因为作业的响应比随着等待时间增加而提高。</span></li><li><strong><span>系统吞吐量</span></strong><span>：较高，因为能够平衡作业的等待和执行。</span></li><li><strong><span>周转时间</span></strong><span>：中等，因为长作业最终会获得较高的优先级。</span></li><li><strong><span>平均周转时间</span></strong><span>：中等，因为综合考虑了等待时间和运行时间。</span></li><li><strong><span>等待时间</span></strong><span>：中等，因为等待时间长的作业最终会得到执行。</span></li><li><strong><span>响应时间</span></strong><span>：中等，因为作业的响应比会随着等待时间增加而提高。</span></li></ul></li><li><p><strong><span>缺点</span></strong><span>：计算响应比需要额外的开销，可能不适合实时系统。</span></p></li></ul><p><span>每种调度算法都有其适用的场景。FCFS适合作业长度相差不大的情况，SJF适合作业长度差异大且能够预知作业长度的情况，而HRRN适合需要平衡作业等待时间和执行时间的情况。在选择调度算法时，应根据具体的应用需求和系统特性来决定。</span></p><h2 id='46-调度算法2）'><span>4.6 调度算法（2）</span></h2><h3 id='1时间片轮转round-robin-rr）'><span>1.时间片轮转（Round Robin, RR）</span></h3><ul><li><p><strong><span>基本原理</span></strong><span>：每个进程被分配一个固定的时间片（quantum），CPU按照顺序轮流执行进程，如果一个进程在其时间片内没有执行完，它将被挂起，放回就绪队列的末尾，然后CPU选择下一个进程执行。</span></p></li><li><p><strong><span>特点</span></strong><span>：</span></p><ul><li><span>公平性较高，因为每个进程都有机会在短时间内执行。</span></li><li><span>适用于分时系统，可以保证交互式任务的响应时间。</span></li></ul></li><li><p><strong><span>性能分析</span></strong><span>：</span></p><ul><li><strong><span>CPU利用率</span></strong><span>：较高，因为减少了进程切换的开销。</span></li><li><strong><span>系统吞吐量</span></strong><span>：较高，特别是在进程数量较多时。</span></li><li><strong><span>周转时间</span></strong><span>：取决于时间片的大小和进程数量。</span></li><li><strong><span>平均周转时间</span></strong><span>：中等，因为所有进程都有机会被快速执行。</span></li><li><strong><span>等待时间</span></strong><span>：中等，取决于时间片和进程数量。</span></li><li><strong><span>响应时间</span></strong><span>：较短，适用于交互式系统。</span></li></ul></li><li><p><strong><span>缺点</span></strong><span>：时间片的大小对性能有显著影响，太小会导致频繁的进程切换，太大则可能降低响应时间。</span></p></li></ul><h3 id='2优先级调度priority-scheduling）'><span>2.优先级调度（Priority Scheduling）</span></h3><ul><li><p><strong><span>基本原理</span></strong><span>：每个进程被赋予一个优先级，CPU按照优先级高的进程先执行。如果优先级相同，可以采用FCFS策略。</span></p></li><li><p><strong><span>特点</span></strong><span>：</span></p><ul><li><span>可以是抢占式的，也可以是非抢占式的。</span></li><li><span>适用于需要区分任务重要性的系统。</span></li></ul></li><li><p><strong><span>性能分析</span></strong><span>：</span></p><ul><li><strong><span>CPU利用率</span></strong><span>：较高，特别是抢占式优先级调度。</span></li><li><strong><span>系统吞吐量</span></strong><span>：取决于进程优先级分配。</span></li><li><strong><span>周转时间</span></strong><span>：可能较长，低优先级进程可能长时间得不到执行。</span></li><li><strong><span>平均周转时间</span></strong><span>：取决于优先级分配。</span></li><li><strong><span>等待时间</span></strong><span>：可能较长，特别是对于低优先级进程。</span></li><li><strong><span>响应时间</span></strong><span>：对于高优先级进程较短。</span></li></ul></li><li><p><strong><span>缺点</span></strong><span>：可能导致低优先级进程饥饿，即如果高优先级进程不断到来，低优先级进程可能永远无法执行。</span></p></li></ul><h3 id='3多级反馈队列multilevel-feedback-queue-mfq）'><span>3.多级反馈队列（Multilevel Feedback Queue, MFQ）</span></h3><ul><li><p><strong><span>基本原理</span></strong><span>：系统设置多个就绪队列，每个队列有不同的优先级。进程可以在队列之间移动，通常是随着等待时间的增加而提高优先级。时间片的大小可以随着队列优先级的降低而增大。</span></p></li><li><p><strong><span>特点</span></strong><span>：</span></p><ul><li><span>结合了RR和优先级调度的优点。</span></li><li><span>根据进程的行为动态调整优先级。</span></li></ul></li><li><p><strong><span>性能分析</span></strong><span>：</span></p><ul><li><strong><span>CPU利用率</span></strong><span>：较高，因为可以动态调整进程优先级。</span></li><li><strong><span>系统吞吐量</span></strong><span>：较高，因为能够平衡不同类型的进程需求。</span></li><li><strong><span>周转时间</span></strong><span>：中等，因为可以动态调整优先级。</span></li><li><strong><span>平均周转时间</span></strong><span>：中等，取决于进程的行为和系统设置。</span></li><li><strong><span>等待时间</span></strong><span>：中等，因为等待时间长的进程会提高优先级。</span></li><li><strong><span>响应时间</span></strong><span>：较短，特别是对于交互式任务。</span></li></ul></li><li><p><strong><span>缺点</span></strong><span>：算法复杂，需要维护多个队列和动态调整优先级，可能增加系统开销。</span></p></li></ul><p><span>每种调度算法都有其适用的场景。时间片轮转适用于分时系统和交互式任务，优先级调度适用于需要区分任务重要性的系统，而多级反馈队列适用于需要动态调整进程优先级的复杂系统。在选择调度算法时，应根据系统的具体需求和特性来决定。</span></p><h2 id='47-调度算法3）'><span>4.7 调度算法（3）</span></h2><p><span>多级队列调度（Multilevel Queue Scheduling）是一种进程调度算法，它将就绪队列分为多个不同的队列，每个队列有不同的优先级。这种调度策略通常用于满足不同类型进程的需求，并且可以根据队列的特性来调整调度策略。以下是多级队列调度的详细说明：</span></p><h3 id='1基本原理'><span>1.基本原理</span></h3><ol start='' ><li><strong><span>队列划分</span></strong><span>：系统根据进程的特性（如进程类型、优先级等）将它们分配到不同的队列中。通常，队列的数量和优先级是固定的。</span></li><li><strong><span>优先级</span></strong><span>：每个队列被赋予一个优先级，较高优先级的队列中的进程会优先获得CPU时间。</span></li><li><strong><span>调度策略</span></strong><span>：每个队列可以采用不同的调度算法。例如，高优先级队列可能采用抢占式优先级调度，而低优先级队列可能采用时间片轮转调度。</span></li><li><strong><span>队列间迁移</span></strong><span>：进程可以在队列之间迁移。这通常基于某些条件，如进程等待时间过长、进程行为改变等。</span></li></ol><h3 id='2特点'><span>2.特点</span></h3><ul><li><strong><span>灵活性</span></strong><span>：可以为不同类型的进程设置不同的调度策略。</span></li><li><strong><span>优先级</span></strong><span>：确保了某些关键进程能够得到及时处理。</span></li><li><strong><span>隔离性</span></strong><span>：不同队列的进程相对独立，减少了相互干扰。</span></li></ul><h3 id='3调度过程'><span>3.调度过程</span></h3><ol start='' ><li><strong><span>CPU分配</span></strong><span>：CPU首先服务于最高优先级的队列，直到该队列为空或达到某种条件（如时间片用完）。</span></li><li><strong><span>队列内部调度</span></strong><span>：每个队列内部可以采用不同的调度算法，如FCFS、RR或优先级调度。</span></li><li><strong><span>队列间迁移</span></strong><span>：进程可能会因为某些条件（如执行时间过长、I/O密集型操作等）而被迁移到其他队列。</span></li></ol><h3 id='4性能分析'><span>4.性能分析</span></h3><ul><li><strong><span>CPU利用率</span></strong><span>：较高，尤其是当高优先级队列中的进程频繁被调度时。</span></li><li><strong><span>系统吞吐量</span></strong><span>：取决于队列的设置和进程的特性。</span></li><li><strong><span>周转时间</span></strong><span>：可能因队列设置而异，高优先级队列中的进程通常有更短的周转时间。</span></li><li><strong><span>等待时间</span></strong><span>：不同队列的进程等待时间不同，高优先级队列的等待时间通常较短。</span></li><li><strong><span>响应时间</span></strong><span>：对于交互式任务，如果它们被分配到高优先级队列，响应时间会较短。</span></li></ul><h3 id='5缺点'><span>5.缺点</span></h3><ul><li><strong><span>复杂性</span></strong><span>：管理多个队列和调度策略增加了系统的复杂性。</span></li><li><strong><span>饥饿问题</span></strong><span>：如果低优先级队列中的进程长时间得不到CPU时间，可能会发生饥饿现象。</span></li><li><strong><span>静态队列</span></strong><span>：在某些实现中，队列的设置是静态的，不适应动态变化的系统需求。</span></li></ul><h3 id='6应用场景'><span>6.应用场景</span></h3><p><span>多级队列调度适用于需要区分不同类型进程的系统和环境，例如，实时系统、分时系统、混合负载系统等。</span></p><p><span>总之，多级队列调度是一种有效的进程调度策略，它通过将进程分配到不同的队列并赋予不同的优先级，来满足不同类型进程的需求，从而提高系统的整体性能。</span></p><h1 id='第五章-同步和互斥'><span>第五章 同步和互斥</span></h1><h2 id='51-进程同步和进程互斥'><span>5.1 进程同步和进程互斥</span></h2><p><span>进程同步和进程互斥是操作系统中处理多进程或多线程时非常重要的概念，它们用于控制多个进程或线程对共享资源的访问，以保证数据的一致性和系统的稳定性。</span></p><h3 id='1进程同步process-synchronization）'><span>1.进程同步（Process Synchronization）</span></h3><p><span>进程同步是指两个或多个进程在执行过程中，通过某些机制协调它们的工作次序，以实现正确的执行结果。在多道程序环境中，由于进程执行的并发性，可能会出现多个进程竞争同一资源的情况，如果没有适当的同步机制，可能会导致数据不一致或错误的结果。</span></p><p><span>进程同步的目的是：</span></p><ul><li><span>防止多个进程同时访问共享资源而造成数据不一致。</span></li><li><span>控制不同进程之间的执行顺序，确保某些操作按照预定的顺序执行。</span></li></ul><p><span>同步机制包括：</span></p><ul><li><span>互斥锁（Mutex Locks）</span></li><li><span>信号量（Semaphores）</span></li><li><span>事件（Events）</span></li><li><span>条件变量（Condition Variables）</span></li></ul><h3 id='2进程互斥process-mutual-exclusion）'><span>2.进程互斥（Process Mutual Exclusion）</span></h3><p><span>进程互斥是指当多个进程访问共享资源时，通过某种机制保证每次只有一个进程能够访问该资源。互斥是进程同步的一个特例，它关注的是如何防止多个进程同时进入临界区（Critical Section），即访问共享资源的代码段。</span></p><p><span>进程互斥的目的是：</span></p><ul><li><span>保证每次只有一个进程能够访问共享资源。</span></li><li><span>避免竞争条件（Race Conditions），即多个进程因执行顺序的不确定性而导致的错误结果。</span></li></ul><p><span>实现互斥的常用方法有：</span></p><ul><li><strong><span>软件方法</span></strong><span>：Peterson算法、Dekker算法等。</span></li><li><strong><span>硬件方法</span></strong><span>：通过特殊的硬件指令，如测试并设置（Test-and-Set）、交换（Swap）等。</span></li></ul><h3 id='3举例说明'><span>3.举例说明</span></h3><p><span>假设有两个进程P1和P2，它们都需要访问一个共享变量count，用于计数。</span></p><ul><li><strong><span>进程同步</span></strong><span>：如果需要P1在P2之前执行，或者在P2开始之前P1必须完成某些操作，那么就需要进程同步机制来协调它们的执行顺序。</span></li><li><strong><span>进程互斥</span></strong><span>：当P1和P2都需要修改count时，为了避免它们同时修改导致count的值不正确，需要使用互斥机制确保在任一时刻只有一个进程能够修改count。</span></li></ul><h3 id='4总结'><span>4.总结</span></h3><p><span>进程同步和进程互斥是确保多进程或多线程程序正确执行的关键技术。同步机制确保了进程按照一定的顺序执行，而互斥机制则保证了在某一时刻只有一个进程能够访问共享资源。在多任务操作系统中，这两种机制都是必不可少的，以防止数据竞争和保证系统的一致性。</span></p><h2 id='52进程互斥的软件实现方法'><span>5.2进程互斥的软件实现方法</span></h2><h3 id='1单标志法single-flag-method）'><span>1.单标志法（Single Flag Method）</span></h3><p><span>单标志法是最简单的互斥算法。在这种方法中，使用一个共享的变量作为标志，该标志用来指示临界区是否被占用。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><span>设置一个共享变量</span><code>turn</code><span>，初始化为0。</span></li><li><span>进程在进入临界区之前，首先检查</span><code>turn</code><span>的值。</span></li><li><span>如果</span><code>turn</code><span>的值为0，则进程可以进入临界区，并将</span><code>turn</code><span>设置为1。</span></li><li><span>进程执行完临界区代码后，将</span><code>turn</code><span>重新设置为0。</span></li></ol><p><span>缺点：这种方法只允许一个进程访问临界区，而另一个进程永远无法进入。</span></p><h3 id='2双标志先检查double-flag-with-preemption）'><span>2.双标志先检查（Double Flag with Preemption）</span></h3><p><span>双标志先检查方法使用两个共享的标志变量，分别表示两个进程是否想要进入临界区。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><span>设置两个共享变量</span><code>flag[0]</code><span>和</span><code>flag[1]</code><span>，分别初始化为FALSE。</span></li><li><span>进程在尝试进入临界区之前，首先设置自己的标志为TRUE，然后检查另一个进程的标志。</span></li><li><span>如果另一个进程的标志为FALSE，则进程可以进入临界区。</span></li><li><span>进程执行完临界区代码后，将自己的标志重新设置为FALSE。</span></li></ol><p><span>缺点：这种方法存在竞态条件，因为两个进程可能同时检查对方的标志，并且都发现对方的标志为FALSE，从而同时进入临界区。</span></p><h3 id='3双标志后检查double-flag-with-postemption）'><span>3.双标志后检查（Double Flag with Postemption）</span></h3><p><span>双标志后检查是对双标志先检查的改进，它要求进程在退出临界区时再次检查另一个进程的标志。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><span>设置两个共享变量</span><code>flag[0]</code><span>和</span><code>flag[1]</code><span>，分别初始化为FALSE。</span></li><li><span>进程在尝试进入临界区之前，首先设置自己的标志为TRUE。</span></li><li><span>进程检查另一个进程的标志，如果为FALSE，则可以进入临界区；否则，等待。</span></li><li><span>进程在临界区执行完毕后，将自己的标志设置为FALSE，并检查另一个进程的标志。如果另一个进程正在等待，则通知它。</span></li></ol><p><span>缺点：这种方法可能导致饥饿，因为一个进程可能反复进入临界区，而另一个进程永远无法进入。</span></p><h3 id='4peterson算法petersons-algorithm）'><span>4.Peterson算法（Peterson’s Algorithm）</span></h3><p><span>Peterson算法是一个经典的互斥算法，它使用两个标志变量和一个turn变量来实现互斥。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><span>设置两个共享变量</span><code>flag[0]</code><span>和</span><code>flag[1]</code><span>，分别初始化为FALSE，表示两个进程都不想进入临界区。</span></li><li><span>设置一个共享变量</span><code>turn</code><span>，用来指示是哪个进程的轮次。</span></li><li><span>进程在尝试进入临界区之前，首先设置自己的标志为TRUE，并设置</span><code>turn</code><span>为另一个进程的编号。</span></li><li><span>进程检查另一个进程的标志，如果为FALSE，则可以进入临界区；否则，等待直到另一个进程的标志变为FALSE。</span></li><li><span>进程在临界区执行完毕后，将自己的标志设置为FALSE。</span></li></ol><p><span>Peterson算法解决了双标志先检查和双标志后检查的竞态条件问题，并且能够保证两个进程都不会饥饿。这是因为它确保了当一个进程想要进入临界区时，如果另一个进程已经在临界区或者也想要进入，那么它将等待，直到另一个进程完成并释放临界区。</span></p><p>&nbsp;</p><h2 id='53-进程互斥的硬件实现方法'><span>5.3 进程互斥的硬件实现方法</span></h2><h3 id='1中断屏蔽方法interrupt-masking）'><span>1.中断屏蔽方法（Interrupt Masking）</span></h3><p><span>中断屏蔽是一种硬件支持的互斥技术，它通过屏蔽中断来防止在执行临界区代码时发生上下文切换。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><span>当一个进程想要进入临界区时，它首先执行一个硬件指令来屏蔽所有中断。</span></li><li><span>进程执行临界区代码。</span></li><li><span>当进程离开临界区时，它执行另一个硬件指令来允许中断。</span></li></ol><p><span>优点：这种方法简单且易于实现。</span></p><p><span>缺点：中断屏蔽可能会延迟对高优先级中断的响应，这在实时系统中可能是不可接受的。此外，如果多个处理器共享内存，这种方法可能不适用。</span></p><h3 id='2testandset指令test-and-set-lock）'><span>2.TestAndSet指令（Test-and-Set Lock）</span></h3><p><span>TestAndSet是一种原子操作，通常由一个硬件指令实现，它同时测试一个标志的值并将其设置为TRUE。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><p><span>设置一个共享的标志变量lock，初始化为FALSE。</span></p></li><li><p><span>进程通过执行TestAndSet指令尝试进入临界区：</span></p><ul><li><span>TestAndSet(&amp;lock)会返回lock的旧值，并将lock设置为TRUE。</span></li></ul></li><li><p><span>如果TestAndSet返回FALSE，表示临界区空闲，进程可以进入。</span></p></li><li><p><span>如果TestAndSet返回TRUE，表示临界区被占用，进程需要等待并重复执行TestAndSet。</span></p></li><li><p><span>进程执行完临界区代码后，将lock设置为FALSE以释放临界区。</span></p></li></ol><p><span>优点：这种方法能够有效地实现互斥，并且适用于多处理器系统。</span></p><p><span>缺点：可能导致忙等（busy waiting），这在单处理器系统中会降低效率。</span></p><h3 id='3swap指令exchange-or-swap-lock）'><span>3.Swap指令（Exchange or Swap Lock）</span></h3><p><span>Swap指令是一种原子操作，它交换两个变量的值。在互斥中，Swap通常用于交换一个进程的标志和共享锁变量的值。</span></p><p><span>算法步骤如下：</span></p><ol start='' ><li><p><span>设置一个共享的标志变量lock，初始化为FALSE，以及一个局部变量key，初始化为TRUE。</span></p></li><li><p><span>进程通过执行Swap指令尝试进入临界区：</span></p><ul><li><span>Swap(&amp;lock, &amp;key)会原子地交换lock和key的值。</span></li></ul></li><li><p><span>如果key的值在Swap之后变为FALSE，表示进程获得锁并可以进入临界区。</span></p></li><li><p><span>如果key的值在Swap之后仍为TRUE，表示临界区被占用，进程需要等待并重复执行Swap。</span></p></li><li><p><span>进程执行完临界区代码后，将lock设置为FALSE以释放临界区。</span></p></li></ol><p><span>优点：与TestAndSet类似，Swap也能有效地实现互斥，并适用于多处理器系统。</span></p><p><span>缺点：同样可能导致忙等，且在某些情况下可能比TestAndSet更复杂。</span></p><p>&nbsp;</p><h2 id='54互斥锁'><span>5.4互斥锁</span></h2><p><span>互斥锁（Mutex）是计算机科学中用于同步的一种常见机制，它确保多个线程或进程不会同时访问共享资源。互斥锁提供了一种在多线程环境中控制对共享资源的访问的方法，从而防止竞争条件（race conditions）的发生。</span></p><p><span>以下是互斥锁的基本概念和操作：</span></p><h3 id='1基本概念-1'><span>1.基本概念</span></h3><ul><li><strong><span>临界区</span></strong><span>：一个访问共享资源的代码段，这些资源不能被多个线程同时访问。</span></li><li><strong><span>互斥</span></strong><span>：一种保证同一时刻只有一个线程可以进入临界区的机制。</span></li></ul><h3 id='2互斥锁的操作'><span>2.互斥锁的操作</span></h3><p><span>互斥锁通常具有以下操作：</span></p><ul><li><strong><span>初始化（Initialization）</span></strong><span>：在程序开始时创建并初始化互斥锁。</span></li><li><strong><span>锁定（Lock）</span></strong><span>：当一个线程想要进入临界区时，它必须先锁定互斥锁。如果互斥锁已经被另一个线程锁定，则当前线程将被阻塞，直到互斥锁被解锁。</span></li><li><strong><span>尝试锁定（Try Lock）</span></strong><span>：尝试锁定互斥锁，如果锁已经被占用，则不会阻塞线程，而是立即返回。</span></li><li><strong><span>解锁（Unlock）</span></strong><span>：当线程完成对临界区的访问后，它必须解锁互斥锁，以便其他线程可以锁定并访问临界区。</span></li><li><strong><span>销毁（Destroy）</span></strong><span>：当互斥锁不再需要时，应将其销毁。</span></li></ul><h3 id='3示例代码'><span>3.示例代码</span></h3><p><span>以下是一个使用互斥锁的伪代码示例：</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;mutex&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;thread&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">std::mutex</span> <span class="cm-variable">mtx</span>; <span class="cm-comment">// 创建互斥锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">sharedResource</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-comment">// 共享资源</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">incrementSharedResource</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mtx</span>.<span class="cm-variable">lock</span>(); <span class="cm-comment">// 锁定互斥锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 开始临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sharedResource</span><span class="cm-operator">++</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Incremented sharedResource to "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">sharedResource</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 结束临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mtx</span>.<span class="cm-variable">unlock</span>(); <span class="cm-comment">// 解锁互斥锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">decrementSharedResource</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mtx</span>.<span class="cm-variable">lock</span>(); <span class="cm-comment">// 锁定互斥锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 开始临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sharedResource</span><span class="cm-operator">--</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Decremented sharedResource to "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">sharedResource</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 结束临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mtx</span>.<span class="cm-variable">unlock</span>(); <span class="cm-comment">// 解锁互斥锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::thread</span> <span class="cm-variable">t1</span>(<span class="cm-variable">incrementSharedResource</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::thread</span> <span class="cm-variable">t2</span>(<span class="cm-variable">decrementSharedResource</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t1</span>.<span class="cm-variable">join</span>(); <span class="cm-comment">// 等待线程t1完成</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t2</span>.<span class="cm-variable">join</span>(); <span class="cm-comment">// 等待线程t2完成</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 998px;"></div><div class="CodeMirror-gutters" style="height: 998px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><h3 id='4注意事项'><span>4.注意事项</span></h3><ul><li><strong><span>死锁</span></strong><span>：不当使用互斥锁可能导致死锁，即两个或多个线程永久阻塞，每个线程都在等待另一个线程释放锁。</span></li><li><strong><span>饥饿</span></strong><span>：如果线程优先级设置不当，可能导致某些线程长时间无法获得互斥锁，这种情况称为饥饿。</span></li><li><strong><span>性能</span></strong><span>：频繁的锁定和解锁操作可能会带来性能开销，特别是在高并发和多处理器系统中。</span></li></ul><p><span>互斥锁是并发编程中不可或缺的工具，正确地使用互斥锁可以确保数据的一致性和程序的正确性。在实现互斥锁时，可以使用前面提到的硬件实现方法，如TestAndSet或Swap指令，来确保操作的原子性。在许多操作系统和编程语言中，互斥锁都是通过标准库提供的。</span></p><h2 id='55-信号量机制'><span>5.5 信号量机制</span></h2><ul><li><span>在C++中，信号量（Semaphore）机制是一种同步原语，用于控制多个线程对共享资源的访问。信号量是一个整数变量，可以用来表示资源的可用数量。信号量主要有两种操作：</span><code>P</code><span>（也称为</span><code>wait</code><span>或</span><code>down</code><span>）和</span><code>V</code><span>（也称为</span><code>signal</code><span>或</span><code>up</code><span>）。</span><code>P</code><span>操作会减少信号量的值，如果信号量的值小于或等于0，则阻塞调用线程；</span><code>V</code><span>操作会增加信号量的值，并可能唤醒等待的线程。</span></li><li><span>在C++11及以后的版本中，信号量可以通过</span><code>&lt;semaphore&gt;</code><span>头文件中的</span><code>std::counting_semaphore</code><span>和</span><code>std::binary_semaphore</code><span>（C++20引入）来实现。以下是使用</span><code>std::counting_semaphore</code><span>的一个示例：</span></li></ul><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>37</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;semaphore&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;thread&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;vector&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 创建一个信号量，初始化为1，表示有一个资源可用</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">std::counting_semaphore</span> <span class="cm-def">sem</span>(<span class="cm-number">1</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">task</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">id</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// P操作，减少信号量的值，如果信号量的值为0，则阻塞</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sem</span>.<span class="cm-variable">acquire</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 开始临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Thread "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">id</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">" is in the critical section"</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 模拟执行一些任务</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::this_thread::sleep_for</span>(<span class="cm-variable">std::chrono::seconds</span>(<span class="cm-number">1</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 结束临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// V操作，增加信号量的值，如果有线程阻塞在P操作上，则唤醒其中一个线程</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sem</span>.<span class="cm-variable">release</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::thread</span><span class="cm-operator">&gt;</span> <span class="cm-variable">threads</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 创建并启动多个线程</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">threads</span>.<span class="cm-variable">emplace_back</span>(<span class="cm-variable">task</span>, <span class="cm-variable">i</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 等待所有线程完成</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span><span class="cm-operator">&amp;</span> <span class="cm-variable">t</span> : <span class="cm-variable">threads</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span>.<span class="cm-variable">join</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1055px;"></div><div class="CodeMirror-gutters" style="height: 1055px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><ul><li><span>在上面的示例中，我们定义了一个</span><code>std::counting_semaphore</code><span>对象</span><code>sem</code><span>，其初始值为1，表示只有一个线程可以进入临界区。每个线程在执行任务之前都会调用</span><code>acquire()</code><span>方法（即P操作），在完成任务之后会调用</span><code>release()</code><span>方法（即V操作）。如果信号量的值小于1，则</span><code>acquire()</code><span>调用将阻塞，直到另一个线程调用</span><code>release()</code><span>。</span></li><li><span>在C++20中，可以使用</span><code>std::binary_semaphore</code><span>，它是</span><code>std::counting_semaphore</code><span>的一个特例，其计数只能是0或1，适用于二进制信号量的场景。使用</span><code>std::binary_semaphore</code><span>的代码示例如下：</span></li></ul><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>37</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;semaphore&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;thread&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;vector&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 创建一个二进制信号量，初始值为1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">std::binary_semaphore</span> <span class="cm-def">sem</span>(<span class="cm-number">1</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">task</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">id</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// P操作，减少信号量的值，如果信号量的值为0，则阻塞</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sem</span>.<span class="cm-variable">acquire</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 开始临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Thread "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">id</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">" is in the critical section"</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 模拟执行一些任务</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::this_thread::sleep_for</span>(<span class="cm-variable">std::chrono::seconds</span>(<span class="cm-number">1</span>));</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 结束临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// V操作，增加信号量的值，如果有线程阻塞在P操作上，则唤醒其中一个线程</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sem</span>.<span class="cm-variable">release</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::vector</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::thread</span><span class="cm-operator">&gt;</span> <span class="cm-variable">threads</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 创建并启动多个线程</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">threads</span>.<span class="cm-variable">emplace_back</span>(<span class="cm-variable">task</span>, <span class="cm-variable">i</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 等待所有线程完成</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-keyword">auto</span><span class="cm-operator">&amp;</span> <span class="cm-variable">t</span> : <span class="cm-variable">threads</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">t</span>.<span class="cm-variable">join</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1055px;"></div><div class="CodeMirror-gutters" style="height: 1055px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><ul><li><span>在这个示例中，</span><code>std::binary_semaphore</code><span>的使用与</span><code>std::counting_semaphore</code><span>类似，只是它被限制为只能表示两种状态：可用（值为1）和不可用（值为0）。</span></li></ul><p>&nbsp;</p><h2 id='56-生产者-消费者问题'><span>5.6 生产者-消费者问题</span></h2><p><span>生产者-消费者问题是计算机科学中一个经典的并发问题。它描述了一个场景，其中有一组生产者线程生成数据并将数据放入缓冲区，同时有一组消费者线程从缓冲区中取出数据并处理。生产者和消费者必须同步对缓冲区的访问，以避免数据竞争和其他并发问题。</span></p><p><span>以下是使用C++11及以上版本中的</span><code>&lt;mutex&gt;</code><span>和</span><code>&lt;condition_variable&gt;</code><span>头文件实现的生产者-消费者问题的示例：</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="cpp" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="cpp"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>70</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;iostream&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;thread&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;mutex&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;condition_variable&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;queue&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;vector&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ProducerConsumerQueue</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::mutex</span> <span class="cm-variable">mtx</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::condition_variable</span> <span class="cm-variable">cond_var</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::queue</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">queue</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">size_t</span> <span class="cm-variable">max_size</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ProducerConsumerQueue</span>(<span class="cm-variable-3">size_t</span> <span class="cm-variable">size</span>) : <span class="cm-variable">max_size</span>(<span class="cm-variable">size</span>) {}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">produce</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">item</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::unique_lock</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::mutex</span><span class="cm-operator">&gt;</span> <span class="cm-variable">lock</span>(<span class="cm-variable">mtx</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cond_var</span>.<span class="cm-variable">wait</span>(<span class="cm-variable">lock</span>, [<span class="cm-keyword">this</span>] { <span class="cm-keyword">return</span> <span class="cm-variable">queue</span>.<span class="cm-variable">size</span>() <span class="cm-operator">&lt;</span> <span class="cm-variable">max_size</span>; });</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">push</span>(<span class="cm-variable">item</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Produced: "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">item</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cond_var</span>.<span class="cm-variable">notify_one</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">consume</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::unique_lock</span><span class="cm-operator">&lt;</span><span class="cm-variable">std::mutex</span><span class="cm-operator">&gt;</span> <span class="cm-variable">lock</span>(<span class="cm-variable">mtx</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cond_var</span>.<span class="cm-variable">wait</span>(<span class="cm-variable">lock</span>, [<span class="cm-keyword">this</span>] { <span class="cm-keyword">return</span> <span class="cm-operator">!</span><span class="cm-variable">queue</span>.<span class="cm-variable">empty</span>(); });</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">item</span> <span class="cm-operator">=</span> <span class="cm-variable">queue</span>.<span class="cm-variable">front</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">pop</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">std::cout</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Consumed: "</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">item</span> <span class="cm-operator">&lt;&lt;</span> <span class="cm-variable">std::endl</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">lock</span>.<span class="cm-variable">unlock</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">cond_var</span>.<span class="cm-variable">notify_one</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">item</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">producer</span>(<span class="cm-variable">ProducerConsumerQueue</span><span class="cm-operator">&amp;</span> <span class="cm-variable">queue</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">items_to_produce</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">items_to_produce</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">produce</span>(<span class="cm-variable">i</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">50</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">consumer</span>(<span class="cm-variable">ProducerConsumerQueue</span><span class="cm-operator">&amp;</span> <span class="cm-variable">queue</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">items_to_consume</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">51</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">items_to_consume</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">52</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">queue</span>.<span class="cm-variable">consume</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">53</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">54</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">55</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">56</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">57</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">size_t</span> <span class="cm-variable">queue_size</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">58</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">int</span> <span class="cm-variable">items_to_produce</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">59</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable-3">int</span> <span class="cm-variable">items_to_consume</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">60</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">61</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ProducerConsumerQueue</span> <span class="cm-variable">queue</span>(<span class="cm-variable">queue_size</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">62</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">63</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::thread</span> <span class="cm-variable">producer_thread</span>(<span class="cm-variable">producer</span>, <span class="cm-variable">std::ref</span>(<span class="cm-variable">queue</span>), <span class="cm-variable">items_to_produce</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">64</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std::thread</span> <span class="cm-variable">consumer_thread</span>(<span class="cm-variable">consumer</span>, <span class="cm-variable">std::ref</span>(<span class="cm-variable">queue</span>), <span class="cm-variable">items_to_consume</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">65</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">66</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">producer_thread</span>.<span class="cm-variable">join</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">67</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">consumer_thread</span>.<span class="cm-variable">join</span>();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">68</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">69</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">70</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1995px;"></div><div class="CodeMirror-gutters" style="height: 1995px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><p><span>在这个示例中，</span><code>ProducerConsumerQueue</code><span>类封装了一个队列和同步机制。它使用一个互斥锁</span><code>mtx</code><span>和一个条件变量</span><code>cond_var</code><span>来同步对队列的访问。</span></p><ul><li><code>produce</code><span>方法用于生产者线程，它将项目放入队列中。如果队列已满，生产者将等待直到队列中有空间。</span></li><li><code>consume</code><span>方法用于消费者线程，它从队列中取出项目。如果队列为空，消费者将等待直到队列中有项目。</span></li></ul><p><span>生产者线程通过</span><code>producer</code><span>函数创建，并尝试生产指定数量的项目。消费者线程通过</span><code>consumer</code><span>函数创建，并尝试消费指定数量的项目。</span></p><p><span>在</span><code>main</code><span>函数中，我们创建了一个</span><code>ProducerConsumerQueue</code><span>实例，并启动了生产者和消费者线程。线程通过</span><code>join</code><span>函数等待完成。</span></p><p><span>这个示例展示了如何使用C++的线程和同步机制来解决生产者-消费者问题。在实际应用中，可能需要根据具体需求调整队列的大小、生产者和消费者的数量以及它们的行为。</span></p><h2 id='57-吸烟者问题'><span>5.7 吸烟者问题</span></h2><p><span>吸烟者问题（Smokers’ Problem）是计算机科学中的一个并发算法问题，它描述了一个场景，其中三个吸烟者需要三种不同的原材料（例如烟草、纸和火柴）来制造香烟。每个吸烟者只拥有其中一种原材料，而另外两种原材料必须从外界获取。有一个供应商会轮流提供这三种原材料中的任意两种。吸烟者必须等待直到他们所缺少的那两种原材料都可用时，才能制造并抽掉香烟。</span></p><p><span>以下是吸烟者问题的基本组件：</span></p><ol start='' ><li><strong><span>供应商（Agent）</span></strong><span>：负责提供两种原材料。</span></li><li><strong><span>吸烟者（Smokers）</span></strong><span>：每个吸烟者拥有一种原材料，并等待其他两种。</span></li></ol><p><span>以下是使用伪代码来描述吸烟者问题的解决方案：</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="plaintext" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="plaintext"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>57</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 定义信号量</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Semaphore tobacco = 0;  // 烟草信号量</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Semaphore paper = 0; &nbsp;  // 纸张信号量</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Semaphore match = 0; &nbsp;  // 火柴信号量</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Semaphore agent = 1; &nbsp;  // 供应商信号量，初始为1，表示可以开始供应</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 供应商进程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">void Agent() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  while (true) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  // 随机选择两种原材料进行供应</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  int原材料1 = 随机选择{tobacco, paper, match};</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  int原材料2 = 随机选择{tobacco, paper, match}, 排除原材料1;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  // 供应原材料</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  V(原材料1);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  V(原材料2);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 吸烟者进程，拥有烟草</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">void SmokerWithTobacco() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  while (true) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  P(tobacco);  // 等待烟草</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  P(paper); &nbsp;  // 等待纸张</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  // 制造并抽掉香烟</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  吸烟();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 吸烟者进程，拥有纸张</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">void SmokerWithPaper() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  while (true) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  P(paper); &nbsp;  // 等待纸张</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  P(match); &nbsp;  // 等待火柴</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  // 制造并抽掉香烟</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  吸烟();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 吸烟者进程，拥有火柴</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">void SmokerWithMatch() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  while (true) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">43</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  P(match); &nbsp;  // 等待火柴</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">44</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  P(tobacco);  // 等待烟草</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">45</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  // 制造并抽掉香烟</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">46</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  吸烟();</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">47</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">48</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">49</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">50</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 启动进程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">51</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">main() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">52</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  // 创建并启动供应商和吸烟者进程</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">53</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  Create(Agent);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">54</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  Create(SmokerWithTobacco);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">55</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  Create(SmokerWithPaper);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">56</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  Create(SmokerWithMatch);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">57</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1625px;"></div><div class="CodeMirror-gutters" style="height: 1625px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><p><span>在这个伪代码中，</span><code>P</code><span>操作表示等待（或减少）信号量的值，如果信号量的值为0，则进程会阻塞直到信号量变为大于0。</span><code>V</code><span>操作表示信号量增加（或释放）。</span></p><p><span>每个吸烟者都在等待它们所缺少的原材料。当供应商放置了两种原材料后，相应的吸烟者可以获取这些原材料，制造香烟并抽掉它。这个过程会不断重复。</span></p><p><span>这个问题的解决方案需要确保以下条件：</span></p><ul><li><span>任何时候，供应商只能放置两种原材料。</span></li><li><span>当一个吸烟者正在吸烟时，其他吸烟者不能干扰。</span></li><li><span>不会有原材料被浪费，即每种原材料都恰好被一个吸烟者使用。</span></li></ul><p><span>这个问题的解决方案有多种变体，可以使用不同的同步机制，如互斥锁、条件变量、信号量等。在实际的操作系统课程或并发编程中，这个问题经常被用来展示如何使用同步原语来解决复杂的并发问题。</span></p><h2 id='57-读者写者问题'><span>5.7 读者写者问题</span></h2><p><span>读者写者问题是计算机科学中常见的一个并发问题，它涉及到如何允许多个读者（不修改数据的进程）和写者（可能修改数据的进程）访问同一数据资源，同时还要保持数据的一致性和完整性。</span></p><h3 id='1问题描述'><span>1.问题描述</span></h3><ul><li><strong><span>读者（Readers）</span></strong><span>：只读取数据，不会修改数据。多个读者可以同时读取数据而不会相互干扰。</span></li><li><strong><span>写者（Writers）</span></strong><span>：可能读取也可能写入数据。写者之间必须是互斥的，即同一时间只能有一个写者在写入数据。写者在写入时，不能有其他读者或写者在操作数据。</span></li></ul><h3 id='2目标'><span>2.目标</span></h3><ul><li><strong><span>允许多个读者同时读取</span></strong><span>：为了提高并发性，允许多个读者同时访问数据。</span></li><li><strong><span>写者独占访问</span></strong><span>：为了保证数据的一致性，写者在写入数据时，其他读者或写者不能访问数据。</span></li><li><strong><span>公平性</span></strong><span>：避免读者或写者饥饿，即确保所有读者和写者最终都能访问到数据。</span></li></ul><h3 id='3解决方案'><span>3.解决方案</span></h3><p><span>以下是几种常见的解决方案：</span></p><h4 id='1-读者优先'><span>1. 读者优先</span></h4><p><span>在这种策略下，读者不会因为写者而阻塞，但写者可能会因为读者而阻塞。</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>30</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 伪代码</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 信号量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">mutex</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">db</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">int</span> <span class="cm-variable">read_count</span> = <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 读者</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">reader</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 进入临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">read_count</span> += <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">read_count</span> == <span class="cm-number">1</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 第一个读者需要锁定数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 离开临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 读取操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 进入临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">read_count</span> -= <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">read_count</span> == <span class="cm-number">0</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 最后一个读者释放数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 离开临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 写者</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">writer</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 锁定数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 写入操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 释放数据库</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 855px;"></div><div class="CodeMirror-gutters" style="height: 855px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><h4 id='2-写者优先'><span>2. 写者优先</span></h4><p><span>在这种策略下，写者不会因为读者而阻塞，但读者可能会因为写者而阻塞。</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>36</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 伪代码</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 信号量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">db</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">mutex</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">write_mutex</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">int</span> <span class="cm-variable">read_count</span> = <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">int</span> <span class="cm-variable">write_count</span> = <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 读者</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">reader</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 进入临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">write_count</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 如果有写者等待，释放锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">write_mutex</span>) &nbsp;<span class="cm-comment"># 等待写者完成</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 重新获取锁</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">read_count</span> += <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 离开临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 读取操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 进入临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">read_count</span> -= <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">read_count</span> == <span class="cm-number">0</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">write_mutex</span>) &nbsp;<span class="cm-comment"># 如果没有其他读者，允许写者写入</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">mutex</span>) &nbsp;<span class="cm-comment"># 离开临界区</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 写者</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">writer</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">write_mutex</span>) &nbsp;<span class="cm-comment"># 锁定写者互斥</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 锁定数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 写入操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 释放数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">write_mutex</span>) &nbsp;<span class="cm-comment"># 释放写者互斥</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1026px;"></div><div class="CodeMirror-gutters" style="height: 1026px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><h4 id='3-读写公平'><span>3. 读写公平</span></h4><p><span>在这种策略下，尝试确保读者和写者都能公平地访问数据。</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>30</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 伪代码</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 信号量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">db</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">semaphore</span> <span class="cm-variable">read_mutex</span> = <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">int</span> <span class="cm-variable">read_count</span> = <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 读者</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">reader</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">read_mutex</span>) &nbsp;<span class="cm-comment"># 读者互斥</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">read_count</span> == <span class="cm-number">0</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 第一个读者锁定数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">read_count</span> += <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">read_mutex</span>) &nbsp;<span class="cm-comment"># 释放读者互斥</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 读取操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">read_mutex</span>) &nbsp;<span class="cm-comment"># 读者互斥</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">read_count</span> -= <span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">read_count</span> == <span class="cm-number">0</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 最后一个读者释放数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">read_mutex</span>) &nbsp;<span class="cm-comment"># 释放读者互斥</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 写者</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">writer</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 锁定数据库</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 写入操作</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">db</span>) &nbsp;<span class="cm-comment"># 释放数据库</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 855px;"></div><div class="CodeMirror-gutters" style="height: 855px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><p><span>在实际应用中，根据具体需求选择合适的策略。上述伪代码展示了使用信号量来解决读者写者问题的基本方法。在实际编程中，可能会使用更高级的同步机制，如条件变量、互斥锁、读写锁等。</span></p><h2 id='58-哲学家进餐问题'><span>5.8 哲学家进餐问题</span></h2><p><span>哲学家进餐问题（Dining Philosophers Problem）是一个经典的并发算法问题，由荷兰计算机科学家艾兹格·迪科斯彻（Edsger W. Dijkstra）在1965年提出。这个问题用来描述多个进程或线程在执行时可能发生的死锁问题。</span></p><h3 id='问题描述'><span>问题描述</span></h3><p><span>假设有五位哲学家围坐在一张圆桌旁，每位哲学家之间都有一根筷子。哲学家在思考时不需要筷子，但在进餐时需要同时拿起左右两边的筷子才能吃饭。如果每位哲学家都先拿起左边的筷子，然后再去拿右边的筷子，那么就会发生死锁，因为每位哲学家都在等待右边的那根筷子，而筷子永远不会被释放。</span></p><h3 id='目标'><span>目标</span></h3><p><span>设计一个算法，使得每位哲学家都能够交替地进行思考和进餐，同时避免死锁的发生。</span></p><h3 id='解决方案'><span>解决方案</span></h3><p><span>以下是几种解决哲学家进餐问题的方案：</span></p><h4 id='1-资源分级法'><span>1. 资源分级法</span></h4><p><span>对筷子进行编号，规定哲学家只能先拿起编号较小的筷子，然后再去拿编号较大的筷子。这样，至少会有一位哲学家能够同时拿起两根筷子进餐，从而避免死锁。</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>10</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 伪代码</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">num_of_philosophers</span> = <span class="cm-number">5</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">chopsticks</span> = [<span class="cm-variable">Semaphore</span>(<span class="cm-number">1</span>) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">num_of_philosophers</span>)]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">philosopher</span>(<span class="cm-variable">i</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">think</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pick_up</span>(<span class="cm-variable">chopsticks</span>[<span class="cm-variable">i</span>], <span class="cm-variable">chopsticks</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable">num_of_philosophers</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eat</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">put_down</span>(<span class="cm-variable">chopsticks</span>[<span class="cm-variable">i</span>], <span class="cm-variable">chopsticks</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable">num_of_philosophers</span>])</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 285px;"></div><div class="CodeMirror-gutters" style="height: 285px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><h4 id='2-服务员方法'><span>2. 服务员方法</span></h4><p><span>引入一个服务员的角色来控制筷子的分配。服务员确保在任何时候最多只有四位哲学家能够同时尝试拿起筷子。</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="python"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>13</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 伪代码</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">num_of_philosophers</span> = <span class="cm-number">5</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">chopsticks</span> = [<span class="cm-variable">Semaphore</span>(<span class="cm-number">1</span>) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">num_of_philosophers</span>)]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">waiter</span> = <span class="cm-variable">Semaphore</span>(<span class="cm-number">4</span>) &nbsp;<span class="cm-comment"># 控制最多4位哲学家同时尝试进餐</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">philosopher</span>(<span class="cm-variable">i</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">think</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">P</span>(<span class="cm-variable">waiter</span>) &nbsp;<span class="cm-comment"># 请求服务员允许</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pick_up</span>(<span class="cm-variable">chopsticks</span>[<span class="cm-variable">i</span>], <span class="cm-variable">chopsticks</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable">num_of_philosophers</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eat</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">put_down</span>(<span class="cm-variable">chopsticks</span>[<span class="cm-variable">i</span>], <span class="cm-variable">chopsticks</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable">num_of_philosophers</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span>(<span class="cm-variable">waiter</span>) &nbsp;<span class="cm-comment"># 通知服务员已完成</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 371px;"></div><div class="CodeMirror-gutters" style="height: 371px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><h4 id='3-超时放弃法'><span>3. 超时放弃法</span></h4><p><span>哲学家尝试拿起筷子，如果在一定时间内没有成功，就放弃并重新开始思考。这样可以避免无限期地等待筷子。</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>14</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># 伪代码</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">num_of_philosophers</span> = <span class="cm-number">5</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">chopsticks</span> = [<span class="cm-variable">Semaphore</span>(<span class="cm-number">1</span>) <span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-variable">num_of_philosophers</span>)]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">timeout</span> = <span class="cm-number">10</span> &nbsp;<span class="cm-comment"># 设定超时时间</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">philosopher</span>(<span class="cm-variable">i</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-keyword">True</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">think</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">pick_up_with_timeout</span>(<span class="cm-variable">chopsticks</span>[<span class="cm-variable">i</span>], <span class="cm-variable">chopsticks</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable">num_of_philosophers</span>], <span class="cm-variable">timeout</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">eat</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">put_down</span>(<span class="cm-variable">chopsticks</span>[<span class="cm-variable">i</span>], <span class="cm-variable">chopsticks</span>[(<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-variable">num_of_philosophers</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 超时，放弃并重新思考</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">continue</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 399px;"></div><div class="CodeMirror-gutters" style="height: 399px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><p><span>以上只是哲学家进餐问题的一些基本解决方案的伪代码表示。在实际编程中，可能需要使用具体的同步原语（如互斥锁、信号量等）来实现这些方案，并且可能需要考虑更多细节来确保系统的稳定性和公平性。</span></p><h2 id='59-管程'><span>5.9 管程</span></h2><p><span>管程（Monitor）是一种同步机制，用于解决并发编程中的同步问题。它是由布鲁斯·阿姆斯特朗（Bruch Jay Armstrong）在1973年提出的概念。管程提供了一种高级的抽象，允许程序员定义一个封装了共享资源的数据结构和一组操作这些数据结构的过程（或方法），并且保证在同一时刻只有一个线程可以执行这些过程之一。</span></p><h3 id='管程的主要特性'><span>管程的主要特性</span></h3><ol start='' ><li><strong><span>互斥访问</span></strong><span>：管程保证了共享资源在同一时间只能被一个线程访问，从而避免了并发访问导致的数据不一致问题。</span></li><li><strong><span>条件同步</span></strong><span>：管程支持条件变量和相关的等待（wait）和通知（signal/notify）操作，允许线程在特定条件下挂起或被唤醒。</span></li><li><strong><span>封装性</span></strong><span>：管程将共享资源和操作这些资源的过程封装在一起，隐藏了同步的细节，使得并发程序更容易理解和维护。</span></li></ol><h3 id='管程的基本组成'><span>管程的基本组成</span></h3><ul><li><strong><span>共享资源</span></strong><span>：需要被多个线程访问的数据结构或变量。</span></li><li><strong><span>过程/方法</span></strong><span>：定义了对共享资源进行操作的方法，这些方法可以原子性地执行。</span></li><li><strong><span>条件变量</span></strong><span>：用于线程间的同步，通常与等待和通知操作结合使用。</span></li><li><strong><span>入口队列</span></strong><span>：当多个线程尝试进入管程时，它们将被放入入口队列中，按照某种策略（如FIFO）等待进入管程。</span></li></ul><h3 id='管程的操作'><span>管程的操作</span></h3><ul><li><strong><span>进入（Enter）</span></strong><span>：线程请求进入管程时，如果管程空闲，则线程可以立即进入；如果管程已被占用，线程将被阻塞，直到管程空闲。</span></li><li><strong><span>等待（Wait）</span></strong><span>：线程在管程内部执行等待操作，释放管程的互斥锁，并挂起自己，直到被其他线程通过通知操作唤醒。</span></li><li><strong><span>通知（Signal/Notify）</span></strong><span>：线程在管程内部执行通知操作，唤醒一个或多个在条件变量上等待的线程。</span></li><li><strong><span>退出（Exit）</span></strong><span>：线程完成对共享资源的操作后，退出管程，释放互斥锁，允许其他线程进入。</span></li></ul><h3 id='示例'><span>示例</span></h3><p><span>以下是一个使用管程解决生产者-消费者问题的简单示例：</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="java" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="java"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 67.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 38px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>31</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -38px; width: 38px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">monitor</span> <span class="cm-variable">ProducerConsumerMonitor</span> {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">condition</span> <span class="cm-variable">full</span>, <span class="cm-variable">empty</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">MAX</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">procedure</span> <span class="cm-variable">producer</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">count</span> <span class="cm-operator">==</span> <span class="cm-variable">MAX</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">wait</span>(<span class="cm-variable">full</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 生产一个产品</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">count</span><span class="cm-operator">++</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">count</span> <span class="cm-operator">==</span> <span class="cm-number">1</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">signal</span>(<span class="cm-variable">empty</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">procedure</span> <span class="cm-variable">consumer</span>() {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span> (<span class="cm-atom">true</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">count</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">wait</span>(<span class="cm-variable">empty</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 消费一个产品</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">count</span><span class="cm-operator">--</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">count</span> <span class="cm-operator">==</span> <span class="cm-variable">MAX</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">signal</span>(<span class="cm-variable">full</span>);</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 29px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -38px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 29px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 884px;"></div><div class="CodeMirror-gutters" style="height: 884px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 37px;"></div></div></div></div></pre><p><span>在这个示例中，</span><code>ProducerConsumerMonitor</code><span>是一个管程，它包含了共享资源</span><code>count</code><span>和条件变量</span><code>full</code><span>、</span><code>empty</code><span>。</span><code>producer</code><span>和</span><code>consumer</code><span>是操作共享资源的过程，它们通过等待和通知操作来实现同步。</span></p><p><span>需要注意的是，不同的编程语言和操作系统可能提供了不同的管程实现。例如，Java语言中的</span><code>synchronized</code><span>关键字和</span><code>Object</code><span>类的</span><code>wait()</code><span>、</span><code>notify()</code><span>、</span><code>notifyAll()</code><span>方法可以用来实现管程。</span></p><h2 id='5-10死锁'><span>5. 10死锁</span></h2><p><span>死锁（Deadlock）是并发控制中的一种情况，其中两个或多个线程永久性地阻塞，每个线程等待其他线程释放资源。由于线程在等待永远不会发生的条件，所以它们无法继续执行。这通常发生在多个线程竞争同一组资源时，每个线程已经持有一部分资源，但又等待获取其他线程持有的资源。</span></p><h3 id='1死锁的四个必要条件'><span>1.死锁的四个必要条件</span></h3><p><span>死锁的发生通常依赖于以下四个条件同时成立，这些条件由艾兹格·迪科斯彻（Edsger Dijkstra）提出：</span></p><ol start='' ><li><strong><span>互斥条件</span></strong><span>：资源不能被多个线程同时使用。</span></li><li><strong><span>持有和等待条件</span></strong><span>：线程至少持有一个资源，并且正在等待获取额外的资源，而该资源又被其他线程持有。</span></li><li><strong><span>非抢占条件</span></strong><span>：线程持有的资源在未使用完毕前不能被其他线程强行抢占。</span></li><li><strong><span>循环等待条件</span></strong><span>：存在一个线程与资源的循环等待链，每个线程都在等待下一个线程所持有的资源。</span></li></ol><h3 id='2死锁示例'><span>2.死锁示例</span></h3><p><span>假设有两个线程A和B，以及两个资源R1和R2：</span></p><ul><li><span>线程A持有资源R1，等待获取资源R2。</span></li><li><span>线程B持有资源R2，等待获取资源R1。</span></li></ul><p><span>由于线程A和B都不愿意放弃它们已经持有的资源，并且都在等待对方持有的资源，因此它们陷入了死锁。</span></p><h3 id='3死锁的处理方法'><span>3.死锁的处理方法</span></h3><p><span>处理死锁的方法主要有以下几种：</span></p><ol start='' ><li><p><strong><span>预防死锁</span></strong><span>：通过破坏死锁的四个必要条件之一来预防死锁的发生。例如，可以通过资源分配策略来避免循环等待条件。</span></p></li><li><p><strong><span>避免死锁</span></strong><span>：在资源的动态分配过程中，避免系统进入不安全状态。银行家算法是一个著名的避免死锁的算法。</span></p></li><li><p><strong><span>检测死锁</span></strong><span>：允许死锁发生，但通过检测来识别死锁，然后采取措施解除死锁。例如，可以通过资源分配图来检测循环等待条件。</span></p></li><li><p><strong><span>解除死锁</span></strong><span>：当检测到死锁发生时，采取措施解除死锁。常用的解除死锁的方法有：</span></p><ul><li><strong><span>剥夺资源</span></strong><span>：从某个线程中剥夺资源，将其分配给其他线程。</span></li><li><strong><span>终止线程</span></strong><span>：终止一个或多个线程，从而释放它们持有的资源。</span></li></ul></li></ol><h3 id='4死锁的解除策略'><span>4.死锁的解除策略</span></h3><p><span>以下是一些常见的死锁解除策略：</span></p><ul><li><strong><span>资源剥夺</span></strong><span>：挂起一些进程，并抢占它们的资源，将这些资源分配给其他进程。</span></li><li><strong><span>终止进程</span></strong><span>：强制终止一个或多个进程，从而释放它们持有的资源。</span></li><li><strong><span>回滚操作</span></strong><span>：某些情况下，可以将进程回滚到安全状态，然后重新开始执行。</span></li></ul><h3 id='5避免死锁的策略'><span>5.避免死锁的策略</span></h3><ul><li><strong><span>资源有序分配</span></strong><span>：规定每个线程必须按照一定的顺序请求资源，从而避免循环等待。</span></li><li><strong><span>请求资源时一次性分配</span></strong><span>：线程在开始执行前一次性请求所有需要的资源，要么全部满足，要么不执行。</span></li><li><strong><span>限制线程持有资源的时间</span></strong><span>：通过设置超时时间，如果线程在规定时间内未能获得所有资源，则放弃已获得的资源。</span></li></ul><p><span>死锁是并发编程中的一个复杂问题，解决死锁通常需要对系统的具体需求和环境有深入的理解。</span></p><h1 id='第六章-内存'><span>第六章 内存</span></h1><h2 id='61-内存的基本知识'><span>6.1 内存的基本知识</span></h2><h3 id='1什么是内存有什么作用'><span>1.什么是内存，有什么作用？</span></h3><p><span>内存（Memory），也称为主存储器，是计算机中用于暂时存储数据和指令的硬件设备。内存的主要作用包括：</span></p><ul><li><strong><span>存储执行中的程序</span></strong><span>：操作系统和正在运行的应用程序需要存储在内存中才能被CPU访问和执行。</span></li><li><strong><span>数据缓存</span></strong><span>：内存用于临时存储处理过程中的数据，以便快速读写。</span></li><li><strong><span>交换空间</span></strong><span>：内存可以作为与其他存储设备（如硬盘）交换数据的缓冲区。</span></li></ul><h3 id='2-进程运行的基本原理'><span>2. 进程运行的基本原理</span></h3><h4 id='指令的工作原理'><span>指令的工作原理</span></h4><p><span>进程的运行基于一系列指令，这些指令是CPU执行的基本操作。指令的工作原理如下：</span></p><ol start='' ><li><strong><span>取指令</span></strong><span>：CPU从内存中取出下一条指令。</span></li><li><strong><span>解码</span></strong><span>：CPU解码指令，确定需要执行的操作。</span></li><li><strong><span>执行</span></strong><span>：CPU执行指令指定的操作，这可能包括算术计算、数据传输或控制操作。</span></li><li><strong><span>重复</span></strong><span>：CPU重复上述步骤，直到程序结束。</span></li></ol><h4 id='逻辑地址vs物理地址'><span>逻辑地址VS物理地址</span></h4><ul><li><strong><span>逻辑地址</span></strong><span>：也称为虚拟地址，是由CPU生成的地址，是程序员视角下的地址空间。逻辑地址空间是连续的，不受物理内存大小的限制。</span></li><li><strong><span>物理地址</span></strong><span>：是内存单元的实际地址，是数据实际存储在内存中的位置。</span></li></ul><h4 id='如何实现地址转换'><span>如何实现地址转换</span></h4><p><span>地址转换通常通过以下步骤实现：</span></p><ol start='' ><li><strong><span>分段</span></strong><span>：将逻辑地址空间分为多个段，如代码段、数据段等。</span></li><li><strong><span>分页</span></strong><span>：将每个段进一步划分为固定大小的页。</span></li><li><strong><span>地址映射</span></strong><span>：操作系统维护一个页表，将逻辑地址（段号+页号+偏移量）映射到物理地址（帧号+偏移量）。</span></li><li><strong><span>转换</span></strong><span>：CPU访问内存时，内存管理单元（MMU）根据页表进行地址转换。</span></li></ol><h4 id='从写程序到程序运行的过程'><span>从写程序到程序运行的过程</span></h4><ol start='' ><li><strong><span>编写代码</span></strong><span>：程序员使用高级编程语言编写源代码。</span></li><li><strong><span>编译</span></strong><span>：源代码通过编译器转换成机器代码，生成可执行文件。</span></li><li><strong><span>加载</span></strong><span>：操作系统将可执行文件从硬盘加载到内存中。</span></li><li><strong><span>地址映射</span></strong><span>：操作系统为程序分配逻辑地址空间，并设置页表以进行地址转换。</span></li><li><strong><span>执行</span></strong><span>：CPU开始执行程序的指令，程序进入运行状态。</span></li><li><strong><span>调度</span></strong><span>：操作系统根据调度算法决定何时让程序运行，以及何时切换到其他程序。</span></li><li><strong><span>结束</span></strong><span>：程序执行完毕或被终止，操作系统回收分配给程序的资源。</span></li></ol><p><span>整个过程涉及到操作系统的内存管理、进程管理、文件系统等多个组件的协同工作。</span></p><h2 id='62-内存管理的概念'><span>6.2 内存管理的概念</span></h2><h3 id='1内存空间的分配与回收'><span>1.内存空间的分配与回收</span></h3><p><span>内存空间的分配与回收是由操作系统负责的，主要过程如下：</span></p><h4 id='分配'><span>分配</span></h4><ol start='' ><li><strong><span>请求分配</span></strong><span>：当进程需要内存时，它会向操作系统发出内存分配请求。</span></li><li><strong><span>查找空闲内存</span></strong><span>：操作系统通过内存管理算法查找足够的空闲内存块来满足进程的请求。</span></li><li><strong><span>分配内存</span></strong><span>：操作系统将找到的空闲内存块分配给进程，并更新内存分配表。</span></li><li><strong><span>初始化</span></strong><span>：分配给进程的内存空间通常会被初始化，以确保数据的一致性。</span></li></ol><h5 id='连续分配管理方式'><span>连续分配管理方式</span></h5><ul><li><p><span>单一连续分配是最简单的内存分配方式，它的特点如下：</span></p><ul><li><strong><span>整个物理内存</span></strong><span>：在单一连续分配方式下，整个物理内存被一个进程独占。</span></li></ul><ul><li><strong><span>无内存浪费</span></strong><span>：由于整个内存被一个进程使用，因此没有内部碎片。</span></li></ul><ul><li><strong><span>系统简单</span></strong><span>：适用于单用户单任务操作系统，如早期的DOS系统。</span></li></ul><ul><li><strong><span>限制性</span></strong><span>：无法同时运行多个程序，系统的资源利用率低。</span></li></ul></li></ul><ul><li><p><span>固定分区分配将物理内存划分为若干个固定大小的分区，每个分区可以分配给一个进程。其特点包括：</span></p><ul><li><strong><span>多个分区</span></strong><span>：内存被划分为若干个固定大小的分区，每个分区大小相等或根据不同的需求设置不同大小。</span></li></ul><ul><li><strong><span>减少内存浪费</span></strong><span>：与单一连续分配相比，可以同时运行多个进程。</span></li></ul><ul><li><strong><span>内部碎片</span></strong><span>：每个分区的大小是固定的，如果进程需要的内存小于分区大小，会导致内部碎片。</span></li></ul><ul><li><strong><span>管理简单</span></strong><span>：操作系统只需维护一个空闲分区表，当有进程请求内存时，只需在表中查找合适的分区分配。</span></li></ul></li></ul><ul><li><p><span>动态分区分配是在进程请求内存时，根据进程的大小动态地分配内存块。这种方式的特点包括：</span></p><ul><li><strong><span>按需分配</span></strong><span>：分配给进程的内存块大小正好等于进程需求的大小，减少了内部碎片。</span></li></ul><ul><li><strong><span>外部碎片</span></strong><span>：随着时间的推移，内存中可能会出现许多小的空闲块，导致无法分配给需要较大内存空间的进程。</span></li></ul><ul><li><strong><span>复杂的管理</span></strong><span>：操作系统需要维护空闲内存块链表，并实现内存分配和回收的算法，如首次适应、最佳适应、最坏适应等。</span></li></ul><ul><li><strong><span>内存紧凑</span></strong><span>：可能需要通过内存紧凑（或称为碎片整理）来减少外部碎片，但这通常是一个耗时的过程。</span></li></ul></li></ul><h5 id='非连续分配管理方式'><span>非连续分配管理方式</span></h5><ul><li><p><span>基本分页存储管理（Paging）</span></p><ul><li><strong><span>原理</span></strong><span>：将物理内存和逻辑内存划分为固定大小的块，称为页（Page）和页框（Page Frame）。操作系统为每个进程维护一个页表，记录逻辑页与物理页框的映射关系。</span></li></ul><ul><li><p><span>特点：</span></p><ul><li><strong><span>固定大小</span></strong><span>：页的大小是固定的，通常是2的幂。</span></li><li><strong><span>地址映射</span></strong><span>：逻辑地址被分为页号和页内偏移。通过页表将逻辑页映射到物理页框。</span></li><li><strong><span>无需连续</span></strong><span>：物理内存不需要连续，只要页表中有相应的映射即可。</span></li><li><strong><span>内部碎片</span></strong><span>：由于页的大小固定，可能会产生内部碎片，即页框中未使用的空间。</span></li><li><span>页表只需要记录真实的其实地址。</span></li></ul></li></ul></li><li><p><span>基本分段存储管理（Segmentation）</span></p><ul><li><strong><span>原理</span></strong><span>：将逻辑地址空间划分为若干个大小不等的段（Segment），每个段代表程序的一部分，如代码段、数据段等。每个段有一个段名和大小，操作系统为每个进程维护一个段表，记录段的基地址和长度。</span></li></ul><ul><li><p><span>特点：</span></p><ul><li><strong><span>可变大小</span></strong><span>：每个段的大小可以不同，根据程序的需要而定。</span></li><li><strong><span>地址映射</span></strong><span>：逻辑地址由段号和段内偏移组成。通过段表将逻辑段映射到物理内存。</span></li><li><strong><span>信息保护</span></strong><span>：可以很容易地实现段的保护和共享。</span></li><li><strong><span>外部碎片</span></strong><span>：由于段的大小不同，可能会产生外部碎片，即内存中无法被利用的小空闲块。</span></li><li><span>记录段长和基址</span></li></ul></li></ul></li><li><p><span>段页式存储管理（Segmented Paging）</span></p><ul><li><strong><span>原理</span></strong><span>：结合了分页和分段的特点，先将逻辑地址空间划分为段，每个段再划分为固定大小的页。每个段有一个段表，每个页有一个页表，形成两级映射。</span></li></ul><ul><li><p><span>特点：</span></p><ul><li><strong><span>两级映射</span></strong><span>：先通过段表找到页表，再通过页表找到物理地址。</span></li><li><strong><span>减少碎片</span></strong><span>：通过分页减少了内部碎片，通过分段减少了外部碎片。</span></li><li><strong><span>灵活性和保护</span></strong><span>：分段提供了灵活性和保护机制，分页提供了简单的地址映射。</span></li><li><strong><span>复杂性</span></strong><span>：管理较复杂，需要维护两级映射表，增加了内存管理的开销。</span></li></ul></li></ul></li></ul><h4 id='回收'><span>回收</span></h4><ol start='' ><li><strong><span>释放请求</span></strong><span>：当进程不再需要内存时，或者进程结束时，它会释放内存。</span></li><li><strong><span>更新内存表</span></strong><span>：操作系统更新内存分配表，将释放的内存标记为空闲。</span></li><li><strong><span>合并空闲块</span></strong><span>：操作系统可能需要合并相邻的空闲内存块，以减少内存碎片。</span></li></ol><h3 id='2内存空间的扩充'><span>2.内存空间的扩充</span></h3><p><span>内存空间的扩充可以通过以下方式实现：</span></p><h4 id='覆盖技术一般不用了）'><span>覆盖技术（一般不用了）</span></h4><ul><li><span>将程序分为多个段（多个模块）。常用的段常驻内存，不常用的段在需要时调入内存。</span></li><li><span>内存中分为一个“固定区”和若干个“覆盖区”。</span></li><li><span>需要常驻内存的段放在“固定区”中，调入就不再调出（除非运行结束）</span></li><li><span>不常用的段放在“覆盖区”，需要用到时调入内存，用不到时调出内存。</span></li></ul><h4 id='虚拟内存'><span>虚拟内存</span></h4><ul><li><strong><span>分页</span></strong><span>：操作系统使用分页技术，将物理内存扩展到硬盘上的交换空间。</span></li><li><strong><span>交换(Swapping)</span></strong><span>：操作系统将不常用的页从物理内存交换到硬盘上的交换文件，以释放物理内存。(保留PCB信息，换出进程！)</span></li><li><span>具有对换功能的操作系统中，通常把磁盘空间分为文件区和对换区两部分。</span><strong><span>文件区</span></strong><span>主要用于存放文件，主要</span><strong><span>追求存储空间的利用率</span></strong><span>，因此对文件空间的管理采用</span><strong><span>离散分配方式</span></strong><span>；对换区空间只占磁盘空间很小的一部分。被换出的进程数据就存放在对换区。由于兑换的速度直接影响到系统的整体速度，因此</span><strong><span>对换区</span></strong><span>空间的管理主要</span><strong><span>追求换入换出速度</span></strong><span>，因此对换区采用</span><strong><span>连续分配方式</span></strong><span>。</span></li></ul><h4 id='硬件扩充'><span>硬件扩充</span></h4><ul><li><strong><span>增加内存条</span></strong><span>：通过增加更多的内存条来物理上增加内存容量。</span></li><li><strong><span>内存映射</span></strong><span>：使用内存映射技术，将外部存储设备映射到内存地址空间。</span></li></ul><h3 id='3-地址转换'><span>3. 地址转换</span></h3><p><span>地址转换是由内存管理单元（MMU）完成的，过程如下：</span></p><ol start='' ><li><p><strong><span>逻辑地址到线性地址</span></strong><span>：如果使用了分段，首先将逻辑地址（段:偏移）转换为线性地址。</span></p></li><li><p><span>线性地址到物理地址：通过页表将线性地址转换为物理地址。这通常涉及以下步骤：</span></p><ul><li><strong><span>查找页表</span></strong><span>：根据线性地址中的页号查找页表。</span></li><li><strong><span>获取帧号</span></strong><span>：从页表中获取对应的帧号。</span></li><li><strong><span>计算物理地址</span></strong><span>：将帧号与线性地址中的页内偏移结合，形成物理地址。</span></li></ul></li><li><p><strong><span>地址重定位</span></strong></p><ul><li><strong><span>绝对装入</span></strong><span>：编译时产生绝对地址。（单道程序阶段）</span></li><li><strong><span>可重定位装入</span></strong><span>：装入时将逻辑地址转换为物理地址。（多道批处理）</span></li><li><strong><span>动态运行时装入</span></strong><span>：运行时将逻辑地址转换为物理地址，需设置重定位寄存器。（现代操作系统）</span></li></ul></li><li><p><span>快表</span></p><ul><li><span>快表，又称联想寄存器（TLB， translation lookaside buffer）,是一种访问速度比内存快很多的高速缓存（TLB不是内存！），用来存放最近访问的页表项的副本，可以加速地址变换的速度。与此对应的页表称为慢表。</span></li></ul></li><li><p><span>两级页表</span></p><ul><li><p><span>单级页表问题：</span></p><ul><li><span>页表必须连续存放，因此当夜表很大时，需要占用很多个连续的页框。</span></li><li><span>没有必要让整个页表常驻内存，因为进程在一段时间内可以只需要访问某个特定的页面。</span></li></ul></li><li><p><span>将进程地址空间分页，并为其建立一张页表，记录各页面的存放位置。</span></p></li><li><p><span>注意</span></p><ul><li><span>多级页表中，各级页表的大小不能超过一个页面。若两级页表不够，可以分更多级。</span></li><li><span>多级页表的访存次数（假设没有快表机构）--N级页表访问一个逻辑地址需要N+1次访存。</span></li></ul></li></ul></li></ol><h3 id='存储保护'><span>存储保护</span></h3><p><span>存储保护是操作系统确保每个进程只能访问它被授权访问的内存区域的过程。以下是几种常见的存储保护机制：</span></p><h4 id='两种方式'><span>两种方式</span></h4><ul><li><span>设置上下限寄存器。</span></li><li><span>利用重定位寄存器，界地址寄存器进行判断。</span></li></ul><h4 id='访问控制-1'><span>访问控制</span></h4><ul><li><strong><span>访问权限</span></strong><span>：操作系统为每个内存页设置访问权限（读、写、执行）。</span></li><li><strong><span>用户/内核模式</span></strong><span>：CPU运行在用户模式或内核模式，以限制对系统资源的访问。</span></li></ul><h4 id='地址空间隔离'><span>地址空间隔离</span></h4><ul><li><strong><span>虚拟内存</span></strong><span>：每个进程都有自己的虚拟地址空间，相互隔离。</span></li><li><strong><span>页表保护</span></strong><span>：页表中的条目可以设置保护位，以防止对内存页的未授权访问。</span></li></ul><h4 id='异常处理'><span>异常处理</span></h4><ul><li><strong><span>内存访问违规</span></strong><span>：当进程尝试访问未被授权的内存时，MMU会产生一个异常，操作系统会捕获这个异常并采取行动，通常是终止进程。</span></li></ul><p><span>通过这些机制，操作系统可以保护内存免受错误程序或恶意软件的破坏，确保系统的稳定性和安全性。</span></p><h2 id='63-动态分区分配算法'><span>6.3 动态分区分配算法</span></h2><p><span>动态分区分配算法是操作系统在动态分配内存时使用的策略，以决定如何从空闲内存块中选择一个分区来满足进程的内存请求。以下是四种常见的动态分区分配算法：</span></p><h3 id='1首次适应算法first-fit）'><span>1.首次适应算法（First Fit）</span></h3><ul><li><strong><span>原理</span></strong><span>：操作系统从空闲内存块的开始位置查找，直到找到一个足够大的空闲块来满足进程的请求。</span></li><li><strong><span>操作</span></strong><span>：维护一个空闲内存块的链表，按地址递增的顺序排列。分配时从链表头开始查找。</span></li><li><strong><span>优点</span></strong><span>：简单，快速，因为通常在链表的前端就能找到合适的空闲块。</span></li><li><strong><span>缺点</span></strong><span>：可能导致内存的低端区域出现很多小的空闲块，造成外部碎片。</span></li></ul><h3 id='2最佳适应算法best-fit）'><span>2.最佳适应算法（Best Fit）</span></h3><ul><li><strong><span>原理</span></strong><span>：操作系统查找所有足够大的空闲块，并选择最小的那个来分配给进程，以尽可能减少剩余空闲块的大小。</span></li><li><strong><span>操作</span></strong><span>：维护一个所有空闲块的链表，按大小递增的顺序排列。分配时查找链表，找到最小且足够大的块。</span></li><li><strong><span>优点</span></strong><span>：最小化剩余空闲块的大小，减少了外部碎片。</span></li><li><strong><span>缺点</span></strong><span>：可能导致很多小的空闲块，增加了管理开销，并且可能会因为频繁的分割和合并操作导致性能下降。</span></li></ul><h3 id='3最坏适应算法worst-fit）'><span>3.最坏适应算法（Worst Fit）</span></h3><ul><li><strong><span>原理</span></strong><span>：与最佳适应算法相反，操作系统查找所有足够大的空闲块，并选择最大的那个来分配给进程。</span></li><li><strong><span>操作</span></strong><span>：维护一个所有空闲块的链表，按大小递减的顺序排列。分配时查找链表，找到最大且足够大的块。</span></li><li><strong><span>优点</span></strong><span>：可能会减少分割操作，因为剩余的空闲块通常较大。</span></li><li><strong><span>缺点</span></strong><span>：可能导致非常大的空闲块被分割，造成较大的外部碎片。</span></li></ul><h3 id='4临近适应算法next-fit）'><span>4.临近适应算法（Next Fit）</span></h3><ul><li><strong><span>原理</span></strong><span>：这是首次适应算法的一个变种，不同之处在于它不是从链表头开始查找，而是从上次分配结束的地方开始查找。</span></li><li><strong><span>操作</span></strong><span>：维护一个空闲内存块的链表，按地址递增的顺序排列。分配时从上次分配结束的下一个空闲块开始查找。</span></li><li><strong><span>优点</span></strong><span>：可以减少查找时间，因为不会重复检查已经检查过的空闲块。</span></li><li><strong><span>缺点</span></strong><span>：可能导致内存分配的不均匀，因为搜索可能集中在内存的某个区域。</span></li></ul><p><span>每种算法都有其特定的使用场景和权衡。例如，首次适应算法通常比最佳适应算法快，但可能产生更多的碎片。最佳适应算法可以最小化碎片，但可能需要更多的时间来维护和搜索空闲块。最坏适应算法可能产生很多小空闲块，但剩余的大空闲块有助于后续分配较大的内存请求。临近适应算法在实现上简单，但可能不如首次适应算法那样高效。</span></p><p>&nbsp;</p><h2 id='64-虚拟内存'><span>6.4 虚拟内存</span></h2><h3 id='1基本概念-2'><span>1.基本概念</span></h3><h4 id='传统存储管理方式的特征和缺点'><span>传统存储管理方式的特征和缺点</span></h4><h5 id='特征-1'><span>特征</span></h5><ul><li><strong><span>连续性</span></strong><span>：程序在内存中占用连续的地址空间。</span></li><li><strong><span>单一性</span></strong><span>：在单一连续分配方式中，整个内存被一个进程独占。</span></li><li><strong><span>固定分配</span></strong><span>：在固定分区分配方式中，内存被划分为若干固定大小的区域。</span></li></ul><h5 id='缺点'><span>缺点</span></h5><ul><li><strong><span>内部碎片</span></strong><span>：在固定分区分配中，分配的内存可能比实际需要的大，导致内存浪费。</span></li><li><strong><span>外部碎片</span></strong><span>：在动态分区分配中，内存碎片化可能导致无法分配给需要较大连续内存空间的进程。</span></li><li><strong><span>低效的内存利用</span></strong><span>：由于碎片的存在，内存的利用率可能不高。</span></li><li><strong><span>限制进程大小</span></strong><span>：进程的大小受限于物理内存的大小。</span></li></ul><h4 id='局部性原理'><span>局部性原理</span></h4><h5 id='时间局部性'><span>时间局部性</span></h5><ul><li><strong><span>概念</span></strong><span>：如果一个信息项被访问，那么它在不久的将来很可能再次被访问。</span></li><li><strong><span>应用</span></strong><span>：利用缓存技术，如CPU缓存，来存储最近访问的数据和指令。</span></li></ul><h5 id='空间局部性'><span>空间局部性</span></h5><ul><li><strong><span>概念</span></strong><span>：如果一个信息项被访问，那么与它相邻的信息项也很可能被访问。</span></li><li><strong><span>应用</span></strong><span>：在缓存中存储连续的数据块，因为程序倾向于顺序访问内存。</span></li></ul><h5 id='高速缓存技术'><span>高速缓存技术</span></h5><ul><li><strong><span>原理</span></strong><span>：使用小而快速的存储器（缓存）来存储最近或频繁访问的数据，以减少对慢速主存储器的访问。</span></li><li><strong><span>类型</span></strong><span>：指令缓存、数据缓存、统一缓存等。</span></li></ul><h4 id='虚拟内存的定义和特征'><span>虚拟内存的定义和特征</span></h4><h5 id='定义'><span>定义</span></h5><p><span>虚拟内存是一种内存管理技术，它允许一个程序在逻辑上使用比实际物理内存更大的地址空间。</span></p><h5 id='特征-2'><span>特征</span></h5><ul><li><strong><span>地址空间分离</span></strong><span>：每个进程都有自己的虚拟地址空间，与物理内存分离。</span></li><li><strong><span>动态内存分配</span></strong><span>：内存按需分配，不需要在程序启动时分配全部内存。</span></li><li><strong><span>内存保护</span></strong><span>：防止一个进程访问另一个进程的内存空间。</span></li><li><strong><span>内存映射</span></strong><span>：虚拟地址到物理地址的映射由操作系统和硬件（如内存管理单元MMU）管理。</span></li></ul><h4 id='如何实现虚拟内存技术'><span>如何实现虚拟内存技术</span></h4><h5 id='分页paging）'><span>分页（Paging）</span></h5><ul><li><strong><span>原理</span></strong><span>：将虚拟内存和物理内存划分为固定大小的页。</span></li><li><strong><span>实现</span></strong><span>：操作系统维护页表，MMU负责将虚拟页映射到物理页框。</span></li></ul><h5 id='段页式segmented-paging）'><span>段页式（Segmented Paging）</span></h5><ul><li><strong><span>原理</span></strong><span>：结合分段和分页，先将进程逻辑地址空间分段，再对每段进行分页。</span></li><li><strong><span>实现</span></strong><span>：维护段表和页表，进行两级地址转换。</span></li></ul><h5 id='页面置换page-replacement）'><span>页面置换（Page Replacement）</span></h5><ul><li><strong><span>算法</span></strong><span>：当物理内存不足以存放所有虚拟页时，使用页面置换算法（如LRU、FIFO）来决定哪个页被换出。</span></li><li><strong><span>实现</span></strong><span>：操作系统负责选择页面置换策略，并在需要时执行页的换入和换出。</span></li></ul><h5 id='硬件支持'><span>硬件支持</span></h5><ul><li><strong><span>MMU</span></strong><span>：内存管理单元负责地址转换和内存保护。</span></li><li><strong><span>磁盘存储</span></strong><span>：用作虚拟内存的后备存储，通常称为交换空间或分页文件。</span></li></ul><h3 id='2-页面置换算法'><span>2. 页面置换算法</span></h3><h4 id='opt最优页面置换算法optimal-page-replacement）'><span>OPT（最优页面置换算法，Optimal Page Replacement）</span></h4><ul><li><strong><span>原理</span></strong><span>：替换掉最长时间内不会被访问的页面，这是一种理想化的算法，因为它需要未来的访问信息，实际上是不可实现的。</span></li><li><strong><span>特征</span></strong><span>：没有页面错误，但仅用于理论上的性能比较。</span></li></ul><h4 id='fifo先进先出页面置换算法first-in-first-out）'><span>FIFO（先进先出页面置换算法，First In, First Out）</span></h4><ul><li><strong><span>原理</span></strong><span>：替换掉最先进驻内存的页面，即替换驻留时间最长的页面。</span></li><li><strong><span>特征</span></strong><span>：实现简单，但可能会产生Belady异常（增加分配的帧数反而增加了缺页中断的次数）。</span></li></ul><h4 id='lru最近最少使用页面置换算法least-recently-used）'><span>LRU（最近最少使用页面置换算法，Least Recently Used）</span></h4><ul><li><strong><span>原理</span></strong><span>：替换掉最近最少被访问的页面。</span></li><li><strong><span>特征</span></strong><span>：性能接近OPT，但需要额外的硬件或软件来记录每个页面的访问历史。</span></li></ul><h4 id='clock时钟页面置换算法）'><span>CLOCK（时钟页面置换算法）</span></h4><ul><li><strong><span>原理</span></strong><span>：使用一个简单的时钟指针在页面的引用位（使用位）和修改位（脏位）之间循环，选择下一个符合条件的页面进行替换。</span></li><li><strong><span>特征</span></strong><span>：简单高效，不需要记录大量的历史信息。</span></li></ul><h4 id='改进型的时钟置换算法'><span>改进型的时钟置换算法</span></h4><ul><li><p><strong><span>原理</span></strong><span>：在基本CLOCK算法的基础上进行改进，以更好地利用页面的访问模式。</span></p></li><li><p><span>几种改进：</span></p><ul><li><strong><span>第二次机会算法</span></strong><span>：在CLOCK算法的基础上，给每个页面一个额外的引用位，如果一个页面被访问过，即使它的引用位是0，也给予第二次机会。</span></li><li><strong><span>增强时钟算法</span></strong><span>：考虑页面的修改位，优先替换未被修改的页面，以减少磁盘写操作。</span></li><li><strong><span>扫描算法</span></strong><span>：结合了FIFO和CLOCK算法的特点，分为两个方向扫描，一个是FIFO方向，另一个是逆FIFO方向。</span></li></ul></li></ul><h3 id='3页面分配策略'><span>3.页面分配策略</span></h3><h4 id='驻留集resident-set）'><span>驻留集（Resident Set）</span></h4><ul><li><strong><span>定义</span></strong><span>：驻留集是指在任何给定时间点，进程在物理内存中占用的页框集合。</span></li><li><strong><span>作用</span></strong><span>：决定了进程能够访问的内存大小，以及可能发生的缺页中断的频率。</span></li></ul><h4 id='页面分配置换策略'><span>页面分配、置换策略</span></h4><h5 id='固定分配局部置换fixed-allocation-with-local-replacement）'><span>固定分配局部置换（Fixed Allocation with Local Replacement）</span></h5><ul><li><strong><span>原理</span></strong><span>：为每个进程分配固定数量的页框，当需要更多页框时，只能在进程的驻留集中进行页面置换。</span></li><li><strong><span>特点</span></strong><span>：简单，但可能导致内存浪费或频繁的页面置换。</span></li></ul><h5 id='可变分配全局置换variable-allocation-with-global-replacement）'><span>可变分配全局置换（Variable Allocation with Global Replacement）</span></h5><ul><li><strong><span>原理</span></strong><span>：根据系统当前的内存使用情况，动态地为进程分配页框，当需要更多页框时，可以在整个物理内存中进行页面置换。</span></li><li><strong><span>特点</span></strong><span>：提高了内存利用率，但可能增加管理复杂度。</span></li></ul><h5 id='可变分配局部置换variable-allocation-with-local-replacement）'><span>可变分配局部置换（Variable Allocation with Local Replacement）</span></h5><ul><li><strong><span>原理</span></strong><span>：结合了固定分配和可变分配的特点，为进程分配一个最小驻留集，并根据需要动态增加页框，但页面置换仍然在进程的驻留集中进行。</span></li><li><strong><span>特点</span></strong><span>：平衡了内存利用率和置换开销。</span></li></ul><h4 id='调入页面的时机'><span>调入页面的时机</span></h4><ul><li><strong><span>需求调页（Demand Paging）</span></strong><span>：仅在进程访问一个不在物理内存中的页面时，才将其调入内存。</span></li><li><strong><span>预调页（Prepaging）</span></strong><span>：在进程实际需要之前，就预先将一些页面调入内存。</span></li></ul><h4 id='从何处调页'><span>从何处调页</span></h4><ul><li><strong><span>磁盘上的交换区（Swap Space）</span></strong><span>：通常在磁盘上划分一个区域用于存储被置换出去的页面。</span></li><li><strong><span>文件系统</span></strong><span>：对于共享库和可执行文件，页面可以直接从文件系统中读取。</span></li></ul><h4 id='抖动现象thrashing）'><span>抖动现象（Thrashing）</span></h4><ul><li><strong><span>定义</span></strong><span>：当系统花费大量时间在页面置换上，而实际的工作进展很少时，系统处于抖动状态。</span></li><li><strong><span>原因</span></strong><span>：进程的驻留集太小，导致频繁的缺页中断和页面置换。</span></li></ul><h4 id='工作集working-set）'><span>工作集（Working Set）</span></h4><ul><li><strong><span>定义</span></strong><span>：工作集是指在一定时间内，进程访问的页面的集合。</span></li><li><strong><span>作用</span></strong><span>：用于确定进程的驻留集大小，以减少缺页中断和抖动现象。</span></li></ul><p>&nbsp;</p><h3 id='4内存映射文件'><span>4.内存映射文件</span></h3><ul><li><p><span>特性</span></p><ul><li><span>进程可以使用系统调用，请求操作系统将文件映射到进程的虚拟地址空间。</span></li><li><span>以访问内存的方式读写文件</span></li><li><span>进程关闭文件时，操作系统负责将文件数据写回磁盘，并解除内存映射。</span></li><li><span>多个进程可以映射同一个文件，方便共享。</span></li></ul></li><li><p><span>优点：</span></p><ul><li><span>程序员编程更简单，已建立映射的文件，只需按访问内存的方式读写即可。</span></li><li><span>文件数据的读入/写出完全由操作系统负责，I/O效率可以由操作系统负责优化。</span></li></ul></li></ul><h1 id='第七章-文件管理'><span>第七章 文件管理</span></h1><h2 id='71基本概念'><span>7.1基本概念</span></h2><h3 id='1文件的属性'><span>1.文件的属性</span></h3><ol><li><strong><span>文件名</span></strong><span>：文件名是用于识别文件的字符串。它通常由字母、数字、下划线和某些特殊字符组成，并且反映了文件的内容或用途。</span></li><li><strong><span>标识符</span></strong><span>：在操作系统中，每个文件都有一个唯一的标识符，通常称为inode号（在类Unix系统中）或文件索引（在Windows系统中）。这个标识符用于系统内部跟踪文件。</span></li><li><strong><span>类型</span></strong><span>：文件类型指示文件的内容和格式。它可以是文本文件、二进制文件、图像文件、视频文件等。</span></li><li><strong><span>位置</span></strong><span>：文件位置指的是文件在文件系统中的路径，即从根目录到文件所在目录的完整路径。</span></li><li><strong><span>大小</span></strong><span>：文件大小表示文件占用的存储空间量，通常以字节为单位。较大的文件可能以KB（千字节）、MB（兆字节）或GB（千兆字节）为单位。</span></li><li><strong><span>创建时间</span></strong><span>：这是文件在文件系统中创建的日期和时间。</span></li><li><strong><span>上次修改时间</span></strong><span>：这是文件内容最后一次被修改的日期和时间。</span></li><li><strong><span>文件所有者信息</span></strong><span>：文件所有者信息包括拥有该文件的用户和用户组的名称。在多用户系统中，这用于确定谁可以访问或修改文件。</span></li><li><strong><span>保护信息</span></strong><span>：保护信息通常以权限的形式存在，它决定了用户和用户组对文件的访问级别。这包括读（read）、写（write）和执行（execute）权限。</span></li></ol><h3 id='2文件的存储逻辑结构'><span>2.文件的存储逻辑结构</span></h3><ol><li><p><strong><span>无结构文件（无格式文件）</span></strong><span>：</span></p><ul><li><span>这种文件没有固定的结构，数据以连续的字节流形式存储。</span></li><li><span>适用于文本文件和二进制文件，其中数据只是简单地顺序写入文件，没有特定的格式或组织。</span></li><li><span>读取时需要知道数据的格式和长度，通常由应用程序来解释。</span></li></ul></li><li><p><strong><span>有结构文件</span></strong><span>： 有结构文件具有定义良好的数据格式和组织方式，可以进一步分为以下几种类型：</span></p><ul><li><p><strong><span>顺序文件</span></strong><span>：</span></p><ul><li><span>数据记录按照一定的顺序排列，通常是按照记录的插入顺序。</span></li><li><span>适用于记录固定长度的数据，如数据库的某些类型。</span></li><li><span>访问时通常需要从头开始，顺序读取直到找到所需记录，效率较低。</span></li></ul></li><li><p><strong><span>索引文件</span></strong><span>：</span></p><ul><li><span>文件包含一个索引部分和一个数据部分。</span></li><li><span>索引部分包含指向数据记录的指针，允许快速访问任何记录。</span></li><li><span>适用于随机访问大量数据记录的情况。</span></li><li><span>索引文件可以提高查找效率，但会增加额外的存储开销用于索引。</span></li></ul></li><li><p><strong><span>索引顺序文件</span></strong><span>：</span></p><ul><li><span>结合了顺序文件和索引文件的特性。</span></li><li><span>数据记录按顺序存储，但同时也维护了一个索引来快速定位记录。</span></li><li><span>适用于需要频繁顺序访问和偶尔随机访问的场合。</span></li><li><span>通过索引可以快速定位到记录所在的块，然后顺序访问该块以找到具体记录。</span></li></ul></li></ul></li></ol><h2 id='72文件目录'><span>7.2.文件目录</span></h2><h3 id='文件目录的实现'><span>文件目录的实现</span></h3><p><span>文件目录通常通过以下方式实现：</span></p><ol><li><strong><span>目录表</span></strong><span>：一个包含文件名和对应文件控制块（FCB）指针的表。</span></li><li><strong><span>文件控制块（FCB）</span></strong><span>：包含文件属性（如文件大小、创建时间、最后修改时间、文件权限等）的数据结构。</span></li></ol><h3 id='目录结构'><span>目录结构</span></h3><p><span>文件目录的结构主要有以下几种类型：</span></p><ol><li><p><strong><span>单级目录结构</span></strong><span>：</span></p><ul><li><span>在单级目录结构中，所有的文件都存储在系统的根目录下。</span></li><li><span>每个文件都有一个唯一的文件名。</span></li><li><span>简单但只适合文件数量较少的系统。</span></li></ul></li><li><p><strong><span>两级目录结构</span></strong><span>：</span></p><ul><li><span>在两级目录结构中，系统有一个根目录，根目录下可以创建多个子目录。</span></li><li><span>用户可以将文件存储在根目录或任何子目录下。</span></li><li><span>提高了文件管理的灵活性，但仍然有限制。</span></li></ul></li><li><p><strong><span>多级（树形）目录结构</span></strong><span>：</span></p><ul><li><span>多级目录结构类似于树状结构，其中根目录位于顶部，每个子目录可以包含更多的子目录和文件。</span></li><li><span>提供了良好的文件组织和管理能力。</span></li><li><span>允许用户创建复杂的目录层次结构。</span></li></ul></li><li><p><strong><span>无环图目录结构</span></strong><span>：</span></p><ul><li><span>在无环图目录结构中，目录可以像无环图一样组织，允许文件和目录之间存在多个链接。</span></li><li><span>这种结构更为灵活，但管理起来也更复杂。</span></li><li><span>现代文件系统中，如NTFS，通过硬链接和软链接实现了类似无环图的结构。</span></li></ul></li></ol><h3 id='索引节点'><span>索引节点</span></h3><p><span>索引节点（inode）是文件系统中的一个概念，用于存储文件的元数据，包括以下信息：</span></p><ul><li><span>文件的大小</span></li><li><span>文件的创建时间、最后修改时间、最后访问时间</span></li><li><span>文件的权限和所有权信息</span></li><li><span>文件的数据块指针（直接指针、间接指针）</span></li></ul><p><span>索引节点通常具有以下特点：</span></p><ul><li><span>每个文件或目录都有一个唯一的索引节点。</span></li><li><span>索引节点通常存储在磁盘上的特定区域。</span></li><li><span>索引节点不包含文件名，文件名与索引节点的关联在目录项中维护。</span></li></ul><p>&nbsp;</p><h2 id='73物理结构'><span>7.3.物理结构</span></h2><h3 id='1-连续分配contiguous-allocation）'><span>1. 连续分配（Contiguous Allocation）</span></h3><p><span>连续分配是最简单的文件物理结构，在这种结构中，每个文件在磁盘上占据一段连续的磁盘空间。</span></p><h4 id='特点-1'><span>特点：</span></h4><ul><li><strong><span>优点</span></strong><span>：访问速度快，因为读取连续块时不需要额外的寻址操作。</span></li><li><strong><span>缺点</span></strong><span>：可能导致外部碎片，即磁盘空间中有足够的空间，但不是连续的，因此无法分配给文件。</span></li></ul><h4 id='实现方式-1'><span>实现方式：</span></h4><ul><li><span>文件的起始块号和长度记录在目录项中。</span></li><li><span>当文件需要扩展时，如果后续空间不足，可能需要移动文件以找到足够大的连续空间。</span></li></ul><h3 id='2-链式分配linked-allocation）'><span>2. 链式分配（Linked Allocation）</span></h3><p><span>链式分配使用磁盘块中的指针来链接文件的各个块。</span></p><h4 id='特点-2'><span>特点：</span></h4><ul><li><strong><span>优点</span></strong><span>：不会有外部碎片，因为每个文件块可以分散在磁盘的任何位置。</span></li><li><strong><span>缺点</span></strong><span>：访问速度较慢，因为每次访问都需要读取一个块以获取下一个块的地址。</span></li></ul><h4 id='实现方式-2'><span>实现方式：</span></h4><ul><li><span>每个磁盘块包含文件数据和指向下一个块的指针。</span></li><li><span>文件的目录项包含指向文件第一个块的指针。</span></li></ul><h3 id='3-索引分配indexed-allocation）'><span>3. 索引分配（Indexed Allocation）</span></h3><p><span>索引分配为每个文件维护一个索引块，该索引块包含指向文件各个数据块的指针。</span></p><h4 id='特点-3'><span>特点：</span></h4><ul><li><strong><span>优点</span></strong><span>：解决了外部碎片问题，并且允许快速随机访问文件。</span></li><li><strong><span>缺点</span></strong><span>：对于小文件，索引块可能会造成内部碎片，因为索引块的大小可能远大于存储文件实际数据所需的磁盘空间。</span></li></ul><h4 id='实现方式-3'><span>实现方式：</span></h4><ul><li><span>文件的目录项包含一个指向索引块的指针。</span></li><li><span>索引块包含一系列的指针，每个指针指向文件的一个数据块。</span></li><li><span>索引分配可以是直接索引、一级间接索引、二级间接索引，甚至三级间接索引，以支持大文件。</span></li></ul><h3 id='4对比总结'><span>4.对比总结：</span></h3><ul><li><strong><span>连续分配</span></strong><span>：适合顺序访问，但不灵活，容易产生碎片。</span></li><li><strong><span>链式分配</span></strong><span>：灵活，避免了外部碎片，但访问效率低。</span></li><li><strong><span>索引分配</span></strong><span>：提供了灵活性和快速访问，但可能对小文件造成内部碎片。</span></li></ul><p><span>在选择文件物理结构时，需要根据文件系统的具体需求和应用场景来决定最合适的结构。例如，对于需要快速访问的大文件，索引分配可能是最佳选择；而对于频繁更新和扩展的小文件，链式分配可能更合适。</span></p><h2 id='74文件存储空间管理'><span>7.4文件存储空间管理</span></h2><h3 id='存储空间的划分与初始化'><span>存储空间的划分与初始化</span></h3><ol><li><p><strong><span>文件卷（逻辑卷）的概念</span></strong><span>：</span></p><ul><li><span>文件卷是文件系统中的一个逻辑存储单元，它可以是一个磁盘分区、一个完整的磁盘或者是一个由多个物理磁盘组成的逻辑单元。</span></li><li><span>文件卷通常包含一个文件系统的所有数据，包括文件数据、目录结构和元数据。</span></li></ul></li><li><p><strong><span>目录区与文件区</span></strong><span>：</span></p><ul><li><strong><span>目录区</span></strong><span>：用于存储文件系统的目录结构信息，包括目录项和文件控制块（FCB）。</span></li><li><strong><span>文件区</span></strong><span>：用于存储文件的实际数据块。</span></li></ul></li></ol><h3 id='存储空间的管理方法'><span>存储空间的管理方法</span></h3><ol><li><p><strong><span>空闲表</span></strong><span>：</span></p><ul><li><span>空闲表是一个数据结构，用于记录哪些磁盘块是空闲的。</span></li><li><span>系统启动时，空闲表被初始化，记录所有空闲的磁盘块。</span></li><li><span>当文件需要存储空间时，文件系统会从空闲表中查找足够大小的连续空闲块进行分配。</span></li></ul></li><li><p><strong><span>空闲链表</span></strong><span>：</span></p><ul><li><strong><span>空闲盘块链</span></strong><span>：将所有空闲的磁盘块链接成一个链表。分配时从链表头部取下一个或多个块，回收时将块添加到链表头部。</span></li><li><strong><span>空闲盘区链</span></strong><span>：与空闲盘块链类似，但是链表中的元素是连续的磁盘块区域，而不是单个块。</span></li></ul></li><li><p><strong><span>位示图</span></strong><span>：</span></p><ul><li><span>位示图是一个位向量，其中每个位代表磁盘上的一个块，用于指示该块是否空闲。</span></li><li><span>0表示空闲，1表示已分配。</span></li><li><span>位示图可以快速定位空闲块，适用于大容量存储设备。</span></li></ul></li><li><p><strong><span>成组链接</span></strong><span>：</span></p><ul><li><span>成组链接是一种管理空闲磁盘空间的方法，它将空闲块分组，并在每个组的最后一个空闲块中存储指向下一个组的指针。</span></li><li><span>这样，不需要在内存中维护整个空闲表或链表，只需要知道第一组的起始块号和该组中的空闲块数量。</span></li><li><span>当文件系统启动时，它会读取第一组的最后一个块来获取下一组的信息。</span></li></ul></li></ol><p><span>每种管理方法都有其优缺点，适用于不同的场景：</span></p><ul><li><strong><span>空闲表</span></strong><span>：适合于小规模系统，但可能导致外部碎片。</span></li><li><strong><span>空闲链表</span></strong><span>：减少了外部碎片，但可能需要额外的空间来存储链表指针。</span></li><li><strong><span>位示图</span></strong><span>：适合于快速查找空闲块，但可能需要较大的内存空间来存储位示图。</span></li><li><strong><span>成组链接</span></strong><span>：减少了内存使用，但可能增加查找空闲块的时间。</span></li></ul><h2 id='75-文件的基本操作'><span>7.5 文件的基本操作</span></h2><ol><li><p><strong><span>创建文件（Create）</span></strong><span>：</span></p><ul><li><span>在文件系统中创建一个新的文件，通常会涉及到分配一个文件控制块（FCB）来存储文件的元数据，如文件名、创建时间、最后修改时间、文件大小等。</span></li></ul></li><li><p><strong><span>删除文件（Delete）</span></strong><span>：</span></p><ul><li><span>从文件系统中移除一个文件。删除操作会释放该文件所占用的存储空间，并移除其在目录中的引用。</span></li></ul></li><li><p><strong><span>打开文件（Open）</span></strong><span>：</span></p><ul><li><span>在对文件进行读写操作之前，需要先打开文件。打开文件操作会读取文件的元数据，并可能涉及到设置文件指针的位置。</span></li><li><span>打开文件后，会返回一个文件描述符或文件句柄，后续的操作可以通过这个标识符来引用文件。</span></li></ul></li><li><p><strong><span>关闭文件（Close）</span></strong><span>：</span></p><ul><li><span>完成文件操作后，应该关闭文件。关闭文件会释放与文件句柄关联的资源，并确保所有缓冲的数据都被写入存储介质。</span></li></ul></li><li><p><strong><span>读取文件（Read）</span></strong><span>：</span></p><ul><li><span>从文件中读取数据。读取操作通常需要指定读取的起始位置和读取的数据量。</span></li></ul></li><li><p><strong><span>写入文件（Write）</span></strong><span>：</span></p><ul><li><span>向文件中写入数据。写入操作同样需要指定写入的起始位置，并且可能涉及到文件的扩展，如果写入的数据超出了文件的当前大小。</span></li></ul></li><li><p><strong><span>截断文件（Truncate）</span></strong><span>：</span></p><ul><li><span>将文件的大小减小到指定的大小。如果指定的尺寸小于文件当前大小，则文件会被截断，释放额外的存储空间；如果指定尺寸大于当前大小，则文件会被扩展。</span></li></ul></li><li><p><strong><span>重命名文件（Rename）</span></strong><span>：</span></p><ul><li><span>更改文件的名称，但保留文件的内容和属性不变。</span></li></ul></li><li><p><strong><span>查看文件属性（Stat）</span></strong><span>：</span></p><ul><li><span>查询文件的元数据，如文件大小、创建时间、最后修改时间等，而不需要读取文件的内容。</span></li></ul></li><li><p><strong><span>设置文件属性（Chmod/Chown）</span></strong><span>：</span></p><ul><li><span>更改文件的权限（如读、写、执行权限）或所有者信息。</span></li></ul></li><li><p><strong><span>移动文件（Move）</span></strong><span>：</span></p><ul><li><span>将文件从一个目录移动到另一个目录，可能会涉及到跨文件系统的操作。</span></li></ul></li><li><p><strong><span>复制文件（Copy）</span></strong><span>：</span></p><ul><li><span>创建文件的一个副本，可能是在同一个文件系统内，也可能是在不同的文件系统之间。</span></li></ul></li></ol><h2 id='76-文件共享和保护'><span>7.6 文件共享和保护</span></h2><h3 id='文件共享'><span>文件共享</span></h3><h4 id='基于索引节点硬链接）'><span>基于索引节点（硬链接）</span></h4><p><span>硬链接（Hard Link）是文件系统中的一种特殊类型的文件，它指向另一个文件的位置。硬链接与原始文件共享相同的索引节点（inode），这意味着它们实际上是文件系统中相同文件内容的两个不同名称。以下是硬链接的特点：</span></p><ul><li><span>硬链接不能跨文件系统创建。</span></li><li><span>删除硬链接或原始文件中的一个不会影响另一个，只有当所有的硬链接和原始文件都被删除时，文件的数据才会被真正删除。</span></li><li><span>硬链接不会链接目录，以防止形成循环的文件系统结构。</span></li></ul><h4 id='基于符号链软连接）'><span>基于符号链（软连接）</span></h4><p><span>软链接（Symbolic Link），也称为符号链接或symlink，是另一种类型的文件，它指向另一个文件的位置，但与硬链接不同，它不直接指向索引节点，而是包含了一个路径名，指向目标文件或目录。以下是软链接的特点：</span></p><ul><li><span>软链接可以跨文件系统创建。</span></li><li><span>如果删除了软链接指向的原始文件，链接将变成“悬挂链接”。</span></li><li><span>软链接可以链接目录。</span></li></ul><h3 id='文件保护'><span>文件保护</span></h3><h4 id='口令保护'><span>口令保护</span></h4><p><span>口令保护是通过设置密码来限制对文件的访问。用户在访问文件之前需要输入正确的密码。这种方法相对简单，但安全性较低，因为密码可能会被共享或猜测。</span></p><h4 id='加密保护'><span>加密保护</span></h4><p><span>加密保护是通过加密算法对文件内容进行加密，只有拥有正确密钥的用户才能解密并访问文件内容。加密提供了更高的安全性，但需要妥善管理密钥。</span></p><p><span>加密可以采取以下几种形式：</span></p><ul><li><span>对称加密：使用相同的密钥进行加密和解密。</span></li><li><span>非对称加密：使用一对密钥（公钥和私钥），公钥用于加密，私钥用于解密。</span></li></ul><h4 id='访问控制-2'><span>访问控制</span></h4><p><span>访问控制是通过定义用户和组的权限来限制对文件的访问。以下是几种常见的访问控制机制：</span></p><ul><li><span>文件权限：通过设置读（r）、写（w）、执行（x）权限来限制用户对文件的访问。</span></li><li><span>访问控制列表（ACL）：允许更细粒度的权限设置，可以为单个用户或组指定权限。</span></li><li><span>安全标签：在某些系统中，文件可以被打上安全标签，系统根据标签来决定谁可以访问文件。</span></li></ul><p><span>这些文件保护方法可以单独使用，也可以组合使用，以提供更高级别的安全性。</span></p><p>&nbsp;</p><h2 id='77-文件层次结构全局结构'><span>7.7 文件层次结构，全局结构</span></h2><ul><li><span>文件层次结构</span><img src="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.assets/image-20241025003842522-17297879251991.png" referrerpolicy="no-referrer" alt="image-20241025003842522"></li><li><span>全局结构</span></li><li><span>原始磁盘是指未经任何格式化处理的磁盘，它包含了磁盘制造商在生产过程中设置的原始数据结构，但并不适合直接存储文件数据。为了能够在磁盘上存储和管理数据，需要进行格式化处理，这通常分为两个步骤：物理格式化和逻辑格式化。</span></li></ul><h3 id='物理格式化'><span>物理格式化</span></h3><p><span>物理格式化（Low-Level Formatting）是磁盘准备的第一个步骤，它涉及到在磁盘表面创建实际的磁道和扇区。这个过程通常由磁盘制造商在出厂时完成，以下是物理格式化的主要任务：</span></p><ul><li><strong><span>初始化磁道和扇区</span></strong><span>：在磁盘表面创建用于数据存储的磁道和扇区，并为每个扇区分配唯一的地址。</span></li><li><strong><span>写入扇区标识</span></strong><span>：在每个扇区的开始位置写入扇区标识信息，比如同步标记、扇区地址等。</span></li><li><strong><span>检测坏扇区</span></strong><span>：检查磁盘表面是否有损坏的扇区，并将这些坏扇区标记出来，以便在后续的数据存储过程中避免使用。</span></li></ul><p><span>物理格式化通常不需要用户手动执行，因为现代磁盘在出厂时已经完成了这一步骤。而且，多次物理格式化可能会缩短磁盘的使用寿命。</span></p><h3 id='逻辑格式化'><span>逻辑格式化</span></h3><p><span>逻辑格式化（High-Level Formatting）是创建文件系统并准备磁盘以供操作系统使用的步骤。这个过程通常在磁盘首次使用时进行，或者在磁盘需要重新初始化时执行。以下是逻辑格式化的主要任务：</span></p><ul><li><strong><span>创建文件系统</span></strong><span>：在磁盘上创建文件系统结构，如文件分配表（FAT）、主文件表（MFT）等，这取决于所选的文件系统类型（如FAT32、NTFS、EXT4等）。</span></li><li><strong><span>分配空间</span></strong><span>：为文件系统分配磁盘空间，确定数据存储区域。</span></li><li><strong><span>设置引导记录</span></strong><span>：在磁盘的引导扇区写入引导记录（如MBR或GPT），以便操作系统可以启动。</span></li></ul><p><span>逻辑格式化通常由操作系统提供的格式化工具来完成，例如Windows中的格式化命令或Linux中的mkfs命令。</span></p><h3 id='虚拟文件系统vfs）'><span>虚拟文件系统（VFS）</span></h3><p><span>虚拟文件系统是操作系统的一个抽象层，它为用户空间的应用程序提供统一的文件操作接口，同时允许不同的文件系统类型在操作系统中共存。以下是VFS的一些主要特点：</span></p><ul><li><strong><span>抽象层</span></strong><span>：VFS为上层应用程序提供统一的文件操作接口，而不管底层实际使用的是哪种文件系统。</span></li><li><strong><span>通用性</span></strong><span>：VFS支持多种文件系统，如FAT32、NTFS、EXT4、XFS等，它们都可以通过VFS提供的接口进行操作。</span></li><li><strong><span>模块化</span></strong><span>：不同的文件系统以模块的形式存在于操作系统中，可以根据需要加载或卸载。</span></li><li><strong><span>透明性</span></strong><span>：应用程序无需关心底层文件系统的具体实现细节，它们只需要通过VFS提供的接口进行文件操作。</span></li></ul><p><span>VFS的主要组件包括：</span></p><ul><li><strong><span>超级块（Superblock）</span></strong><span>：包含文件系统的全局信息，如块大小、inode数量等。</span></li><li><strong><span>inode</span></strong><span>：代表文件系统中的一个文件或目录，包含元数据如文件大小、创建时间、权限等。</span></li><li><strong><span>文件操作</span></strong><span>：定义了对文件执行操作的方法，如打开、读取、写入、关闭等。</span></li><li><strong><span>目录操作</span></strong><span>：定义了对目录执行操作的方法，如创建、删除、列出目录内容等。</span></li></ul><h3 id='文件系统挂载'><span>文件系统挂载</span></h3><p><span>文件系统挂载是指将一个文件系统与操作系统的文件层次结构中的一个目录关联起来的过程。挂载后，用户可以通过访问这个目录来访问文件系统中的文件和目录。以下是文件系统挂载的关键点：</span></p><ul><li><strong><span>挂载点</span></strong><span>：挂载点是文件系统在操作系统目录树中的位置。在挂载之前，这个位置必须是一个已经存在的空目录。</span></li><li><strong><span>挂载操作</span></strong><span>：操作系统通过挂载操作将文件系统的根目录与挂载点连接起来。在Linux系统中，可以使用</span><code>mount</code><span>命令来挂载文件系统。</span></li><li><strong><span>卸载操作</span></strong><span>：当不再需要访问某个文件系统时，可以通过卸载操作将其从目录树中移除。在Linux系统中，使用</span><code>umount</code><span>命令来卸载文件系统。</span></li></ul><p><span>挂载文件系统时，通常需要以下信息：</span></p><ul><li><strong><span>设备文件</span></strong><span>：代表存储设备的文件，如</span><code>/dev/sda1</code><span>或</span><code>/dev/nvme0n1p1</code><span>。</span></li><li><strong><span>文件系统类型</span></strong><span>：要挂载的文件系统类型，如</span><code>ext4</code><span>、</span><code>ntfs</code><span>、</span><code>vfat</code><span>等。</span></li><li><strong><span>挂载选项</span></strong><span>：指定挂载时的一些选项，如读写权限、是否允许执行文件等。</span></li></ul><p><span>例如，以下是一个在Linux系统中挂载ext4文件系统的命令：</span></p><pre class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" spellcheck="false" lang="bash"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 32.25px; left: 58.1953px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -29px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mount <span class="cm-attribute">-t</span> ext4 /dev/sda1 /mnt/mydisk</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 29px;"></div><div class="CodeMirror-gutters" style="height: 29px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><p><span>这个命令将设备</span><code>/dev/sda1</code><span>上的ext4文件系统挂载到目录</span><code>/mnt/mydisk</code><span>。</span></p><h1 id='第八章-设备管理'><span>第八章 设备管理</span></h1><h2 id='81-io设备的概念和分类'><span>8.1 I/O设备的概念和分类</span></h2><h3 id='什么是io设备'><span>什么是I/O设备？</span></h3><p><span>I/O设备（输入/输出设备）是计算机系统与外部世界进行通信的硬件组件。它们用于输入数据和输出处理结果。I/O设备可以包括键盘、鼠标、显示器、打印机、硬盘驱动器、网络适配器等。</span></p><h3 id='按使用特性分类'><span>按使用特性分类</span></h3><p><span>I/O设备可以根据其使用特性分为以下几类：</span></p><ol><li><p><strong><span>输入设备</span></strong><span>：</span></p><ul><li><span>键盘</span></li><li><span>鼠标</span></li><li><span>扫描器</span></li><li><span>网络摄像头</span></li><li><span>条形码读取器</span></li></ul></li><li><p><strong><span>输出设备</span></strong><span>：</span></p><ul><li><span>显示器</span></li><li><span>打印机</span></li><li><span>喇叭</span></li><li><span>项目报告器</span></li></ul></li><li><p><strong><span>输入/输出设备</span></strong><span>：</span></p><ul><li><span>硬盘驱动器</span></li><li><span>USB闪存驱动器</span></li><li><span>网络适配器</span></li><li><span>触摸屏</span></li></ul></li></ol><h3 id='按传输速率分类'><span>按传输速率分类</span></h3><p><span>I/O设备可以根据数据传输速率分为以下几类：</span></p><ol><li><p><strong><span>低速设备</span></strong><span>：</span></p><ul><li><span>键盘</span></li><li><span>鼠标</span></li><li><span>打印机</span></li><li><span>条形码读取器</span></li></ul></li><li><p><strong><span>中速设备</span></strong><span>：</span></p><ul><li><span>网络摄像头</span></li><li><span>网络适配器（在特定条件下）</span></li><li><span>磁盘驱动器（如HDD）</span></li></ul></li><li><p><strong><span>高速设备</span></strong><span>：</span></p><ul><li><span>固态硬盘（SSD）</span></li><li><span>显卡（与显示器通信）</span></li><li><span>高速网络适配器（如10 Gbps以太网）</span></li></ul></li></ol><h3 id='按信息交换的单位分类'><span>按信息交换的单位分类</span></h3><p><span>I/O设备可以根据信息交换的单位进行分类：</span></p><ol><li><p><strong><span>字符设备</span></strong><span>：</span></p><ul><li><span>这些设备通常以字符或字节为单位进行数据传输，如键盘、打印机等。</span></li><li><span>传输数据时，通常不需要缓冲，或者只需要很小的缓冲区。</span></li></ul></li><li><p><strong><span>块设备</span></strong><span>：</span></p><ul><li><span>块设备以固定大小的数据块（通常是512字节或更大）为单位进行数据传输，如硬盘驱动器。</span></li><li><span>这些设备通常有较大的缓冲区，可以优化数据传输速度。</span></li></ul></li><li><p><strong><span>网络设备</span></strong><span>：</span></p><ul><li><span>网络设备通常以数据包为单位进行数据传输，如网络适配器。</span></li><li><span>数据包可以包含多个字符或多个块，其大小取决于网络协议和数据类型。</span></li></ul></li></ol><h2 id='82-io控制方式'><span>8.2 I/O控制方式</span></h2><h3 id='1-程序直接控制programmed-io）'><span>1. 程序直接控制（Programmed I/O）</span></h3><p><span>程序直接控制是最简单的I/O控制方式，它由CPU直接管理数据传输。</span></p><ul><li><strong><span>工作原理</span></strong><span>：CPU通过轮询（Polling）或等待状态来检查I/O设备是否准备好进行数据传输。如果设备准备好，CPU直接从设备读取数据或向设备写入数据。</span></li><li><strong><span>优点</span></strong><span>：实现简单，不需要特殊的硬件支持。</span></li><li><strong><span>缺点</span></strong><span>：效率低，因为CPU在等待I/O操作完成时，不能执行其他任务，这称为忙等待（Busy Waiting）。</span></li></ul><h3 id='2-中断驱动iointerrupt-driven-io）'><span>2. 中断驱动I/O（Interrupt-driven I/O）</span></h3><p><span>中断驱动I/O利用中断机制来提高CPU的效率。</span></p><ul><li><strong><span>工作原理</span></strong><span>：当I/O设备准备好数据传输时，它会向CPU发送一个中断信号。CPU响应中断，暂停当前任务，执行中断服务例程（ISR）来处理I/O操作，然后返回到原来的任务。</span></li><li><strong><span>优点</span></strong><span>：减少了CPU的空闲时间，提高了系统效率。</span></li><li><strong><span>缺点</span></strong><span>：中断处理可能会引入延迟，特别是当系统中有大量中断时。</span></li></ul><h3 id='3-直接内存访问dmadirect-memory-access）'><span>3. 直接内存访问（DMA，Direct Memory Access）</span></h3><p><span>DMA允许I/O设备直接与内存进行数据传输，而无需CPU的干预。</span></p><ul><li><strong><span>工作原理</span></strong><span>：DMA控制器接管数据传输的控制权，CPU只需初始化DMA操作。DMA控制器直接在内存和I/O设备之间传输数据块，传输完成后通知CPU。</span></li><li><strong><span>优点</span></strong><span>：大幅减少了CPU的负担，提高了数据传输的速率。</span></li><li><strong><span>缺点</span></strong><span>：需要额外的硬件支持（DMA控制器），并且对内存带宽有较高要求。</span></li></ul><h3 id='4-通道方式channel-io）'><span>4. 通道方式（Channel I/O）</span></h3><p><span>通道方式是DMA的一种更高级形式，通常用于大型计算机系统。</span></p><ul><li><strong><span>工作原理</span></strong><span>：通道是一个专门用于I/O操作的处理器，它能够执行一组有限的I/O指令。CPU将I/O任务交给通道，通道自主完成数据传输，然后通知CPU。</span></li><li><strong><span>优点</span></strong><span>：进一步减少了CPU的负担，允许CPU执行其他任务，提高了系统吞吐量。</span></li><li><strong><span>缺点</span></strong><span>：需要复杂的硬件支持，成本较高，通常只在大型系统中使用。</span></li></ul><p><span>每种I/O控制方式都有其适用的场景和优缺点。在选择I/O控制方式时，需要考虑系统的需求、成本、性能以及可用的硬件资源。随着技术的发展，例如非一致性内存访问（NUMA）和高速网络技术，I/O控制方式也在不断演进。</span></p><h2 id='83-假脱机技术'><span>8.3 假脱机技术</span></h2><h3 id='什么是假脱机技术及解决的问题'><span>什么是假脱机技术及解决的问题：</span></h3><p><strong><span>定义</span></strong><span>：假脱机技术是一种输入/输出技术，它通过使用磁盘空间作为输入/输出缓冲区（通常称为输入输出井），允许进程在执行其他任务的同时进行I/O操作。</span></p><p><strong><span>解决的问题</span></strong><span>：</span></p><ul><li><strong><span>设备冲突</span></strong><span>：在多道程序系统中，多个进程可能同时需要使用打印机、磁带机等独占设备，假脱机技术可以解决这种设备冲突问题。</span></li><li><strong><span>提高效率</span></strong><span>：它允许CPU在等待I/O操作完成时执行其他任务，减少了CPU的空闲时间。</span></li><li><strong><span>均衡速度差异</span></strong><span>：由于CPU的处理速度远高于I/O设备，假脱机技术可以平衡CPU与I/O设备之间的速度差异。</span></li></ul><h3 id='实现原理'><span>实现原理：</span></h3><ol><li><p><strong><span>输入输出井（Spool）</span></strong><span>：</span></p><ul><li><span>输入输出井是磁盘上的一个区域，用于暂存即将打印或输出的数据。</span></li><li><span>当一个进程请求打印时，它的输出不是直接发送到打印机，而是先写入到输出井中。</span></li></ul></li><li><p><strong><span>输入输出进程（Spooler）</span></strong><span>：</span></p><ul><li><span>输入输出进程是管理假脱机操作的软件部分，它负责将数据从输入井传输到输出井，以及从输出井传输到打印机或其他输出设备。</span></li><li><span>该进程也负责从输入设备读取数据并存储到输入井中。</span></li></ul></li><li><p><strong><span>缓冲区</span></strong><span>：</span></p><ul><li><span>缓冲区是内存中的一块区域，用于暂存正在处理的数据。</span></li><li><span>在假脱机技术中，缓冲区用于减少直接与磁盘交互的次数，提高数据传输的效率。</span></li></ul></li></ol><h3 id='共享打印机原理'><span>共享打印机原理：</span></h3><p><span>假脱机技术使得共享打印机成为可能，以下是共享打印机的原理：</span></p><ol><li><p><strong><span>打印请求排队</span></strong><span>：</span></p><ul><li><span>当多个进程请求打印时，它们的打印作业被发送到打印队列中，这个队列通常存储在磁盘的输出井中。</span></li></ul></li><li><p><strong><span>打印管理进程</span></strong><span>：</span></p><ul><li><span>打印管理进程（Spooler）根据队列中的顺序依次处理打印作业。</span></li><li><span>当打印机空闲时，打印管理进程从输出井中取出下一个打印作业，并将其发送到打印机。</span></li></ul></li><li><p><strong><span>打印作业处理</span></strong><span>：</span></p><ul><li><span>打印作业在打印机上完成后，打印管理进程会通知相应的进程打印作业已完成，并从队列中移除该作业。</span></li></ul></li><li><p><strong><span>无冲突使用</span></strong><span>：</span></p><ul><li><span>由于所有的打印作业都通过打印管理进程进行排队处理，因此即使多个进程同时请求打印，也不会发生冲突，每个进程都可以认为它独占使用了打印机。</span></li></ul></li></ol><h2 id='84-设备管理与回收'><span>8.4 设备管理与回收</span></h2><h3 id='设备分配'><span>设备分配：</span></h3><p><span>设备分配是指操作系统根据一定的策略将I/O设备分配给请求该设备的进程。设备分配策略主要分为以下几种：</span></p><ol><li><p><strong><span>静态分配</span></strong><span>：</span></p><ul><li><span>在系统启动时，某些设备被分配给特定的进程，并在整个系统运行期间保持这种分配状态。</span></li><li><span>这种方法适用于对设备使用有严格要求的专用系统。</span></li></ul></li><li><p><strong><span>动态分配</span></strong><span>：</span></p><ul><li><span>设备在进程请求时才被分配，一旦使用完毕，设备可以被其他进程请求使用。</span></li><li><span>动态分配更加灵活，能够提高设备的利用率。</span></li></ul></li></ol><p><span>设备分配的策略通常包括：</span></p><ul><li><strong><span>独占分配</span></strong><span>：设备在分配给一个进程后，直到该进程完成使用并释放设备，其他进程才能使用。</span></li><li><strong><span>共享分配</span></strong><span>：多个进程可以同时使用同一设备，如打印机可以允许多个进程排队打印。</span></li><li><strong><span>虚拟分配</span></strong><span>：通过假脱机技术等手段，将物理设备虚拟化为多个逻辑设备供多个进程使用。</span></li></ul><h3 id='设备分配的过程'><span>设备分配的过程：</span></h3><ol><li><strong><span>请求</span></strong><span>：进程通过系统调用请求使用某一类设备。</span></li><li><strong><span>分配</span></strong><span>：操作系统根据请求和当前设备的可用状态进行分配。</span></li><li><strong><span>映射</span></strong><span>：操作系统将分配的设备映射到请求进程的地址空间。</span></li><li><strong><span>控制</span></strong><span>：操作系统提供适当的接口供进程控制设备。</span></li></ol><h3 id='设备回收'><span>设备回收：</span></h3><p><span>设备回收是指当进程完成对I/O设备的使用后，操作系统将该设备从进程中释放并可能重新分配给其他进程的过程。以下是设备回收的步骤：</span></p><ol><li><strong><span>检测</span></strong><span>：操作系统检测到设备使用完毕，通常是通过中断或系统调用完成的信号。</span></li><li><strong><span>状态更新</span></strong><span>：操作系统更新设备的状态为“可用”。</span></li><li><strong><span>资源释放</span></strong><span>：操作系统释放进程与设备之间的映射关系，以及所占用的任何相关资源。</span></li><li><strong><span>通知</span></strong><span>：操作系统可能需要通知等待该设备的其他进程设备已可用。</span></li><li><strong><span>调度</span></strong><span>：如果存在等待该设备的进程队列，操作系统将根据调度策略分配设备给下一个进程。</span></li></ol><h3 id='设备分配与回收的策略'><span>设备分配与回收的策略：</span></h3><ul><li><strong><span>先请求先服务</span></strong><span>（FIFO）：按照请求的顺序分配设备。</span></li><li><strong><span>优先级分配</span></strong><span>：根据进程的优先级来分配设备。</span></li><li><strong><span>最短作业优先</span></strong><span>：优先分配给预计使用时间最短的进程。</span></li><li><strong><span>基于需求的分配</span></strong><span>：根据进程的需求和设备的特性进行分配。</span></li></ul><p><span>设备分配与回收是操作系统管理I/O设备的关键部分，合理的策略可以提高系统性能，减少设备等待时间，并提高设备的利用率。</span></p><h2 id='85-缓冲区管理'><span>8.5 缓冲区管理</span></h2><p><span>缓冲区管理是操作系统中的一个重要功能，它涉及到在内存中为输入/输出（I/O）操作设置缓冲区，以优化数据传输的性能和效率。以下是缓冲区管理的基本概念、目的、策略和实现方式：</span></p><h3 id='基本概念'><span>基本概念：</span></h3><ul><li><strong><span>缓冲区</span></strong><span>：是一块连续的内存空间，用于暂时存储数据，以便于不同速度的设备或进程之间进行数据交换。</span></li></ul><h3 id='目的'><span>目的：</span></h3><ol><li><strong><span>速度匹配</span></strong><span>：CPU的处理速度远高于I/O设备的速度，缓冲区可以减少CPU等待I/O操作的时间。</span></li><li><strong><span>流量控制</span></strong><span>：当数据产生速度与消费速度不匹配时，缓冲区可以起到调节作用。</span></li><li><strong><span>数据保护</span></strong><span>：缓冲区可以避免由于数据传输过程中的错误而直接影响到主存储器或处理器。</span></li><li><strong><span>数据集中</span></strong><span>：缓冲区可以将多次小量的I/O操作集中成一次大量操作，提高效率。</span></li></ol><h3 id='策略'><span>策略：</span></h3><ol><li><p><strong><span>单缓冲</span></strong><span>：为每个设备或进程分配一个缓冲区。</span></p><ul><li><span>简单但效率较低，因为在数据被处理或传输时，缓冲区是空闲的。</span></li></ul></li><li><p><strong><span>双缓冲</span></strong><span>：使用两个缓冲区，当一个缓冲区正在被处理时，另一个缓冲区可以接收新的数据。</span></p><ul><li><span>提高了缓冲区的利用率，但需要额外的机制来同步两个缓冲区。</span></li></ul></li><li><p><strong><span>循环缓冲</span></strong><span>：多个缓冲区组成一个环，用于连续的数据流处理。</span></p><ul><li><span>适用于数据流不断且需要连续处理的情况。</span></li></ul></li><li><p><strong><span>缓冲池</span></strong><span>：系统维护一组缓冲区，供多个进程共享使用。</span></p><ul><li><span>提高了缓冲区的使用效率，适用于多进程环境。</span></li></ul></li></ol><h3 id='实现方式-4'><span>实现方式：</span></h3><ol><li><p><strong><span>缓冲区分配</span></strong><span>：</span></p><ul><li><span>静态分配：在系统启动时分配固定大小的缓冲区。</span></li><li><span>动态分配：根据需要动态地分配和释放缓冲区。</span></li></ul></li><li><p><strong><span>缓冲区同步</span></strong><span>：</span></p><ul><li><span>使用信号量、互斥锁等同步机制来控制对缓冲区的访问。</span></li><li><span>生产者-消费者问题：通过同步机制确保生产者不会覆盖未处理的数据，消费者不会读取空缓冲区。</span></li></ul></li><li><p><strong><span>缓冲区操作</span></strong><span>：</span></p><ul><li><strong><span>填充</span></strong><span>：将数据从输入设备读入缓冲区。</span></li><li><strong><span>清空</span></strong><span>：将缓冲区中的数据写入输出设备。</span></li><li><strong><span>传输</span></strong><span>：在缓冲区之间或缓冲区与用户空间之间传输数据。</span></li></ul></li><li><p><strong><span>缓冲区管理算法</span></strong><span>：</span></p><ul><li><strong><span>先进先出（FIFO）</span></strong><span>：最先进入缓冲区的数据最先被处理。</span></li><li><strong><span>优先级调度</span></strong><span>：根据数据的优先级来处理缓冲区中的数据。</span></li></ul></li></ol><h3 id='缓冲区管理的挑战'><span>缓冲区管理的挑战：</span></h3><ul><li><strong><span>缓冲区溢出</span></strong><span>：当数据输入速度超过缓冲区处理速度时，可能导致数据丢失。</span></li><li><strong><span>缓冲区饿死</span></strong><span>：低优先级的数据长时间得不到处理。</span></li><li><strong><span>同步问题</span></strong><span>：确保生产者和消费者正确地访问缓冲区，避免竞态条件。</span></li></ul><p><span>缓冲区管理是提高系统I/O性能的关键技术，合理地设计和实现缓冲区管理策略可以显著提升系统的整体性能。</span></p><h2 id='8-6-磁盘结构调度算法和管理'><span>8. 6 磁盘结构、调度算法和管理</span></h2><p><span>磁盘是计算机系统中最常用的外部存储设备之一，其结构和调度算法对于系统的性能有着重要的影响。以下是磁盘的结构、调度算法和管理的详细描述：</span></p><h3 id='磁盘结构'><span>磁盘结构：</span></h3><ol><li><strong><span>磁头（Head）</span></strong><span>：用于读写磁盘表面的磁性介质。</span></li><li><strong><span>盘片（Platter）</span></strong><span>：一个磁盘通常由多个圆形的盘片组成，每个盘片都有两面可以存储数据。</span></li><li><strong><span>磁道（Track）</span></strong><span>：每个盘片表面由一组同心圆组成，每个圆称为一个磁道。</span></li><li><strong><span>扇区（Sector）</span></strong><span>：磁道被划分为多个扇区，每个扇区是磁盘读写的最小单位。</span></li><li><strong><span>柱面（Cylinder）</span></strong><span>：所有盘片上相同编号的磁道组成一个柱面。</span></li><li><strong><span>接口（Interface）</span></strong><span>：磁盘与计算机系统连接的部分，如SATA、SAS、SCSI等。</span></li></ol><h3 id='磁盘调度算法'><span>磁盘调度算法：</span></h3><p><span>磁盘调度算法决定了对磁盘I/O请求的处理顺序，以下是一些常见的磁盘调度算法：</span></p><ol><li><p><strong><span>先来先服务（FCFS）</span></strong><span>：</span></p><ul><li><span>按照请求到达的顺序服务。</span></li><li><span>可能会导致磁盘头频繁移动，从而造成“饥饿”现象。</span></li></ul></li><li><p><strong><span>最短寻找时间优先（SSTF）</span></strong><span>：</span></p><ul><li><span>选择与当前磁头位置最近的请求进行服务。</span></li><li><span>减少了磁头的移动距离，但可能导致某些请求长期得不到服务。</span></li></ul></li><li><p><strong><span>扫描算法（SCAN）</span></strong><span>：</span></p><ul><li><span>磁头在一个方向上移动，直到到达该方向的最后一个请求，然后反向移动。</span></li><li><span>也称为电梯算法，因为其工作方式类似于电梯的运动。</span></li></ul></li><li><p><strong><span>循环扫描算法（C-SCAN）</span></strong><span>：</span></p><ul><li><span>类似于SCAN，但是磁头只在一个方向上移动，到达磁盘末端后直接跳转到另一端开始。</span></li></ul></li><li><p><strong><span>LOOK和C-LOOK算法</span></strong><span>：</span></p><ul><li><span>是SCAN和C-SCAN的变种，当磁头移动到没有请求的位置时，会立即改变方向。</span></li></ul></li></ol><h3 id='磁盘管理'><span>磁盘管理：</span></h3><p><span>磁盘管理涉及到对磁盘空间的有效分配和使用，以下是一些管理任务：</span></p><ol><li><p><strong><span>分区</span></strong><span>：</span></p><ul><li><span>将一个物理磁盘划分为多个逻辑磁盘，每个逻辑磁盘称为一个分区。</span></li></ul></li><li><p><strong><span>格式化</span></strong><span>：</span></p><ul><li><span>在磁盘上创建文件系统，以便操作系统可以存储和检索数据。</span></li></ul></li><li><p><strong><span>文件系统管理</span></strong><span>：</span></p><ul><li><span>管理磁盘上的文件和目录结构，包括分配和回收存储空间。</span></li></ul></li><li><p><strong><span>磁盘配额</span></strong><span>：</span></p><ul><li><span>限制用户或组可以使用的磁盘空间量。</span></li></ul></li><li><p><strong><span>磁盘碎片整理</span></strong><span>：</span></p><ul><li><span>通过重新排列磁盘上的文件和空闲空间，减少磁盘碎片，提高磁盘访问速度。</span></li></ul></li><li><p><strong><span>错误检测与修复</span></strong><span>：</span></p><ul><li><span>使用磁盘上的冗余信息来检测和修复错误。</span></li></ul></li><li><p><strong><span>磁盘镜像与备份</span></strong><span>：</span></p><ul><li><span>创建磁盘的镜像副本，用于数据恢复和备份。</span></li></ul></li><li><p><strong><span>磁盘阵列（RAID）</span></strong><span>：</span></p><ul><li><span>通过组合多个磁盘驱动器来提高数据传输率和/或可靠性。</span></li></ul></li></ol><p><span>磁盘的结构、调度算法和管理对于计算机系统的性能和可靠性至关重要。有效的磁盘管理可以确保数据的安全，提高系统的响应速度和吞吐量。</span></p><p>&nbsp;</p><h2 id='87-固态硬盘'><span>8.7 固态硬盘</span></h2><p><span>固态硬盘（Solid State Drive，简称SSD）是一种使用固态电子存储芯片阵列制成的硬盘，与传统的机械硬盘（HDD）相比，它没有活动的机械部件。以下是固态硬盘SSD的一些关键特点：</span></p><h3 id='ssd的结构'><span>SSD的结构：</span></h3><ol><li><strong><span>控制器</span></strong><span>：控制器是SSD的大脑，负责管理数据传输、错误校正、坏块映射、垃圾回收等操作。</span></li><li><strong><span>NAND闪存芯片</span></strong><span>：这是SSD存储数据的地方，通常使用NAND型闪存，包括SLC、MLC、TLC和QLC等不同类型。</span></li><li><strong><span>缓存</span></strong><span>：许多SSD使用DRAM或SRAM作为缓存，以提高读写性能。</span></li><li><strong><span>接口</span></strong><span>：SSD使用SATA、NVMe over PCIe、SAS等接口与计算机系统连接。</span></li></ol><h3 id='ssd的优点'><span>SSD的优点：</span></h3><ol><li><strong><span>速度</span></strong><span>：SSD的读写速度远高于HDD，这意味着系统启动、文件传输和应用程序加载时间更短。</span></li><li><strong><span>耐用性</span></strong><span>：由于没有机械运动，SSD更耐震动和冲击。</span></li><li><strong><span>静音</span></strong><span>：SSD在运行时几乎不发出声音，因为它没有旋转的磁盘和移动的读写头。</span></li><li><strong><span>功耗低</span></strong><span>：SSD的功耗通常低于HDD，有助于延长笔记本电脑的电池寿命。</span></li></ol><h3 id='ssd的缺点'><span>SSD的缺点：</span></h3><ol><li><strong><span>成本</span></strong><span>：SSD的单位存储成本高于HDD，但随着技术的发展，这一差距正在缩小。</span></li><li><strong><span>存储容量</span></strong><span>：尽管SSD的容量在不断增加，但HDD在提供大容量存储方面仍然具有优势。</span></li><li><strong><span>写入寿命</span></strong><span>：NAND闪存单元有有限的写入次数，虽然现代SSD通过技术如wear leveling来延长寿命，但仍然是一个考虑因素。</span></li></ol><h3 id='ssd的类型'><span>SSD的类型：</span></h3><ol><li><strong><span>SATA SSD</span></strong><span>：使用SATA接口，速度受限于SATA接口的速度，通常在500MB/s至600MB/s。</span></li><li><strong><span>NVMe SSD</span></strong><span>：使用NVMe（Non-Volatile Memory Express）协议，通过PCIe接口，速度可以达到数GB/s。</span></li><li><strong><span>mSATA SSD</span></strong><span>：尺寸较小的SATA SSD，适用于小型设备。</span></li><li><strong><span>M.2 SSD</span></strong><span>：尺寸和形状标准化的SSD，可以支持SATA或NVMe接口。</span></li></ol><h3 id='ssd的管理'><span>SSD的管理：</span></h3><ol><li><strong><span>垃圾回收</span></strong><span>：SSD需要定期执行垃圾回收来清理已删除的数据，并整理空间以保持性能。</span></li><li><strong><span>TRIM命令</span></strong><span>：操作系统通过TRIM命令告诉SSD哪些数据块不再需要，以便SSD可以提前擦除这些块。</span></li><li><strong><span>坏块管理</span></strong><span>：SSD控制器需要管理坏块，确保数据不会写入损坏的区域。</span></li></ol><p><span>由于SSD的诸多优势，它们已经逐渐成为计算机系统的主要存储设备，尤其是在追求高性能和移动性的场合。随着技术的进步，SSD的成本正在下降，而容量和性能则在不断提升。</span></p></div></div>

<script>(function(){var e=document.body.parentElement,t=[],n=null,i=document.body.classList.contains("typora-export-collapse-outline"),r=function(e,t,n){document.addEventListener(e,function(e){if(!e.defaultPrevented)for(var i=e.target;i&&i!=this;i=i.parentNode)if(i.matches(t)){!1===n.call(i,e)&&(e.preventDefault(),e.stopPropagation());break}},!1)};function o(){return e.scrollTop}r("click",".outline-expander",function(e){var t=this.closest(".outline-item-wrapper").classList;return t.contains("outline-item-open")?t.remove("outline-item-open"):t.add("outline-item-open"),d(),!1}),r("click",".outline-item",function(e){var t=this.querySelector(".outline-label");if(location.hash="#"+t.getAttribute("href"),i){var n=this.closest(".outline-item-wrapper").classList;n.contains("outline-item-open")||n.add("outline-item-open"),c(),n.add("outline-item-active")}});var a,s,l=function(){var e=o();n=null;for(var i=0;i<t.length&&t[i][1]-e<60;i++)n=t[i]},c=function(){document.querySelectorAll(".outline-item-active").forEach(e=>e.classList.remove("outline-item-active")),document.querySelectorAll(".outline-item-single.outline-item-open").forEach(e=>e.classList.remove("outline-item-open"))},d=function(){if(n){c();var e=document.querySelector('.outline-label[href="#'+(CSS.escape?CSS.escape(n[0]):n[0])+'"]');if(e)if(i){var t=e.closest(".outline-item-open>ul>.outline-item-wrapper");if(t)t.classList.add("outline-item-active");else{for(var r=(e=e.closest(".outline-item-wrapper")).parentElement.closest(".outline-item-wrapper");r;)r=(e=r).parentElement.closest(".outline-item-wrapper");e.classList.add("outline-item-active")}}else e.closest(".outline-item-wrapper").classList.add("outline-item-active")}};window.addEventListener("scroll",function(e){a&&clearTimeout(a),a=setTimeout(function(){l(),d()},300)});var u=function(){s=setTimeout(function(){!function(){t=[];var e=o();document.querySelector("#write").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(n=>{var i=n.getAttribute("id");t.push([i,e+n.getBoundingClientRect().y])})}(),l(),d()},300)};window.addEventListener("resize",function(e){s&&clearTimeout(s),u()}),u()})();</script></body>
</html>